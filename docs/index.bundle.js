!function(){function O(){return new Promise(function(e,t){var n=document.createElement("input");n.type="file",document.body.append(n),n.style.display="none",n.click(),n.onchange=function(){e(n.files),n.remove()}})}o=[];var o,n,N,C,j,z=function(){var i=o.length;return o.push({}),{addEventListener:function(e,t){return o[i][e]||(o[i][e]=[]),o[i][e].push(t),!0},removeEventListener:function(e,t){if(o[i][e])for(var n=0;n<o[i][e].length;n++)if(o[i][e][n]===t)return o[i][e].splice(n,1),!0;return!1},doevent:function(e,t){if(!o[i][e])return!1;for(var n=0;n<o[i][e].length;n++)o[i][e][n].apply(null,t);return!0}}},M={joinObj:function(){var e=arguments,t=e[0];for(var n=1;n<e.length;n++)t=function(e,t){for(var n in t)e[n]=t[n];return e}(t,e[n]);return t},loadimg:function(e,t){var n=new Image;n.src=e,n.onload=function(){t(!0)},n.onerror=function(){t(!1)}},element:function(e,t={}){var n,i=document.createElement(e);for(n in t)i.setAttribute(n,t[n]);return i},query:function(e,t,n){return e["querySelector"+(n?"All":"")](t)},getFavicon:function(e,n){var i=0,o="",s=(!function(e){for(var t=new URL(e).host,n=["google.com","goog.le","chrome.com","youtube.com","youtu.be","facebook.com","fb.com","twitter.com","t.co","reddit.com","instagram.com","pinterest.com","linkedin.com"],i=0;i<n.length;i++)if(-1<t.indexOf(n[i]))return 1;return}(e)||(i=1),this);!function t(){if(0==i)o=new URL(e).origin+"/favicon.ico";else if(1==i)o="https://api.xinac.net/icon/?url="+new URL(e).origin;else if(2==i)return void n(!1);s.loadimg(o,function(e){e?(n(o),window.swReg&&window.swReg.active.postMessage({type:"add",url:o})):(i++,t())})}()},createIcon:function(e){var t=document.createElement("canvas"),n=(t.width=64,t.height=64,t.getContext("2d"));return n.fillStyle=this.getRandomColor(),n.font="bold 32px Arial",n.fillText(e,20,40),t.toDataURL()},getRandomColor:function(){return"#"+Math.random().toString(16).substring(2,8).toUpperCase()},fangdou:function(t,n){var i=null;return function(){i&&clearTimeout(i);var e=this;i=setTimeout(function(){t.apply(e,arguments)},n)}},jsonp:function(e,t,n){var i="a"+Math.random().toString(36).slice(2),o=this.element("script",{src:function(e,t,n){e=new URL(e);return e.searchParams.set(t,n),e.href}(e,n||"callback",i)});document.body.appendChild(o),window[i]=function(e){t(e),document.body.removeChild(o),delete window[i]}},xhr:function(e,t,n){var i=new XMLHttpRequest;return i.onreadystatechange=function(){4==i.readyState&&200==i.status&&t(i.responseText)},i.onerror=function(){n&&n({status:i.status,statusText:i.statusText,readyState:i.readyState,responseText:i.responseText})},i.open("GET",e,!0),i.send(),{abort:function(){i.abort()}}},checkSession:function(e){return e.isSession&&"Hvm_session_token_eoi1j2j"===e.session_token},getRandomHashCache:function(){return Math.random().toString(36).slice(2)+Date.now().toString(36)},copyText:function(e){var t;navigator.clipboard?navigator.clipboard.writeText(e):((t=document.createElement("input")).value=e,t.style.display="none",document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)),r.show("复制成功")},getGoogleIcon:function(e,t){return'<span class="material-symbols-outlined'+(t&&t.type?" "+t.type:"")+'">&#x'+e+";</span>"},checkDetailsCorrect:function(e,t){for(var n=0;n<t.length;n++)if(0==e.hasOwnProperty(t[n]))return!1;return!0}},r=(n=M.element("div",{class:"toast"}),C=N=null,M.query(document,"body").append(n),{show:function(e,t){n.innerHTML=e,n.classList.add("show"),n.style.animation="toastin .3s",clearTimeout(N),clearTimeout(C),N=setTimeout(function(){n.style.animation="toastout .3s",C=setTimeout(function(){n.classList.remove("show")},298)},t||2e3)}}),U=(j={tl:M.query(document,".topper .left"),tr:M.query(document,".topper .right"),bl:M.query(document,".bottomer .left"),br:M.query(document,".bottomer .right")},$.prototype={getIcon:function(){return this.element},setIcon:function(e){this.content=e,this.element.innerHTML=this.content},setWidth:function(e){this.width=e,this.width&&(ic.style.width=this.width+"px")},getWidth:function(){return this.width},show:function(){this.element.style.display="block"},hide:function(){this.element.style.display="none"}},{icon:$});function $(e){this.content=e.content,this.width=e.width;var t=M.element("div",{class:"item"+(e.class?" "+e.class:"")+(e.important?" important":"")});j[e.offset].append(t),t.innerHTML=this.content,this.element=t,this.width&&(t.style.width=this.width+"px")}localStorage.quik2||(localStorage.quik2="{}"),F=localforage._getSupportedDrivers([localforage.INDEXEDDB])[0]==localforage.INDEXEDDB,l={get:function(e,t){localforage.getItem(e).then(t)},set:function(e,t){var n="^"+M.getRandomHashCache();localforage.setItem(n,e).then(function(){t(n)})},delete:function(e,t){localforage.removeItem(e).then(t)}},J={},Y.checkIDB=function(){return F};var F,l,J,{storage:p,getStorageList:W,getAllStorage:K,dbTool:Q}={storage:Y,getStorageList:function(){return J},getAllStorage:function(){return JSON.parse(localStorage.getItem("quik2"))},dbTool:l};function Y(o,e){function s(e,t,n){if(!t)return c()[o][e];if(!F)throw new Error("indexedDB is not support in this browser");l.get(c()[o][e],function(e){n(e)})}function c(){return JSON.parse(localStorage.getItem("quik2"))}function a(e){var t=c();t[o]=e,localStorage.setItem("quik2",JSON.stringify(t))}if("string"==typeof o)return JSON.parse(localStorage.getItem("quik2"))[o]||a({}),J[o]=e,{get:s,set:function(n,e,t,i){if(t){if(!F)throw new Error("indexedDB is not support in this browser");s(n)&&l.delete(s(n)),l.set(e,function(e){var t=c();t[o][n]=e,a(t[o]),i(e)})}else{t=c();t[o][n]=e,a(t[o])}},remove:function(t,e,n){var i=c();if(e){if(!F)throw new Error("indexedDB is not support in this browser");l.delete(i[o][t],function(){var e=c();delete e[o][t],a(e),n()})}else delete i[o][t],a(i[o])},list:function(){return Object.keys(c()[o])},getAll:function(){return c()[o]}};throw new Error("ck is not a string")}X=[],s.SHOW_TYPE_FULLSCREEN=1,s.SHOW_TYPE_DIALOG=2,s.iframeDialogBuilder=function(e,t=1){var n=new s({content:`<div class="material-symbols-outlined closebtn">&#xE5CD;</div><iframe src="${e}" class="dialog-iframe"></iframe>`,class:"iframe-dialog",mobileShowtype:t}),e=n.getDialogDom();return M.query(e,".closebtn").onclick=function(){n.close()},this.closed=!0,n},s.prototype={open:function(){this.element.classList.add("show"),this.closed=!1,this.onopen&&this.onopen(),M.query(this.element,"img[data-src]",!0).forEach(function(e){e.src=e.getAttribute("data-src"),e.removeAttribute("data-src")})},close:function(){this.element.classList.remove("show"),this.closed=!0,this.onclose&&this.onopen()},destory:function(){this.element.remove(),X.splice(X.indexOf(this),1)},getDialogDom:function(){return M.query(this.element,".d-c")}};var X,H=s;function s(e){this.options=e;var t=M.element("div",{class:"dialog"}),n=(t.innerHTML=`<div class="d-b"></div><div class="d-c">${e.content}</div>`,M.query(document,"main").append(t),M.query(t,".d-c"));e.class&&n.classList.add(e.class),1==e.mobileShowtype&&t.classList.add("mobile-show-full"),this.element=t,this.id=M.getRandomHashCache(),t.setAttribute("data-id",this.id),t.querySelector(".d-b").addEventListener("click",function(){var t,n;window.innerWidth<=650&&(t=this.parentElement.getAttribute("data-id"),n=null,X.forEach(function(e){e.id==t&&(n=e)}),n.close())}),X.push(this)}Z.prototype={show:function(){this.element.classList.add("show"),this.element.style.height="auto";var e=this.element.getBoundingClientRect().height,t=(this.element.style.height="0px",this.element.style.transition="height .2s",this);setTimeout(function(){t.element.style.height=e+"px"})},hide:function(){this.element.style.height="0px";var e=this;setTimeout(function(){e.element.style.transition="none",e.element.classList.remove("show")},200)},isShow:function(){return this.element.classList.contains("show")},destory:function(){this.element.remove()},setOffset:function(e){this.options.offset=e;var e=this.options,t=this.element;t.style.top="",t.style.left="",t.style.bottom="",t.style.right="",e.offset&&("number"==typeof e.offset.top?t.style.top=e.offset.top+"px":t.style.bottom=e.offset.bottom+"px","number"==typeof e.offset.left?t.style.left=e.offset.left+"px":t.style.right=e.offset.right+"px")},setList:function(e){this.options.list=e;var e=this.options,n=this.element;n.innerHTML="",e.list.forEach(function(e){var t=M.element("div",{class:"item"});t.innerHTML=`<div class="icon">${e.icon}</div><div class="title">${e.title}</div>`,t.onclick=function(){e.click()},n.appendChild(t)})}},document.addEventListener("click",function(){document.querySelectorAll(".contextMenu").forEach(function(e){e.style.height="0px",setTimeout(function(){e.style.transition="none",e.classList.remove("show")},200)})});var V=Z;function Z(e){this.options=e;var n=M.element("div",{class:"contextMenu"});e.offset&&(n.style.top=e.offset.top+"px",n.style.left=e.offset.left+"px",n.style.bottom=e.offset.bottom+"px",n.style.right=e.offset.right+"px"),e.list.forEach(function(e){var t=M.element("div",{class:"item"});t.innerHTML=`<div class="icon">${e.icon}</div><div class="title">${e.title}</div>`,t.onclick=function(){e.click()},n.appendChild(t)}),document.body.appendChild(n),this.element=n}var ee,te,ne=function(){var e=new U.icon({class:"main_menu",content:M.getGoogleIcon("e5d2"),offset:"tr"}),n=[],i=[],o=new V({list:[],offset:{top:40,right:15}});e.getIcon().onclick=function(e){e.stopPropagation(),o.show()};return{pushMenu:function(e,t){(1==t?i:n).push(e),o.setList(n.concat(i))},MAIN_MENU_BOTTOM:1,MAIN_MENU_TOP:0}}(),e=(ie.prototype={addNewGroup:function(e){this.groups.push(e);var n=this;e.on("change",function(t,e){n._dochange({type:t.type,details:t.details,id:t.id}),"it"==t.type?n._dochangeGroup(e,t.details):"add"==t.type?n._drawItem(e,e.items[e.items.length-1]):"change"==t.type&&("reinit"==t.details.attr?n._reinitItem(e,e.items.find(e=>e.id==t.id),t.details):"reget"==t.details.attr?n._regetItem(e.items.find(e=>e.id==t.id),t.details):n._dochangeItem(e,e.items.find(e=>e.id==t.id),t.details))}),n._dochange({type:"addgroup"}),n._drawGroup(e)},setTitle:function(e){this.title=e,M.query(this.dialogDom,".actionbar h1").innerText=e,_._dochange({type:"changetitle",title:e})},open:function(){this.dialog.open()},close:function(){this.dialog.close()},on:function(e,t){this._events[e]&&this._events[e].push(t)},_dochange:function(t){var n=this;this._events.change.forEach(function(e){e(t,n)})},_drawGroup:function(t){for(var n=this,e=M.element("li",{class:"setting-group","data-index":t.index,"data-id":t.id}),i=(e.innerHTML='<div class="setting-group-title"></div><ul class="setting-tree"></ul>',M.query(this.dialogDom,".setting-root")),o=i.children,s=!0,c=0;c<o.length;c++)if(parseInt(o[c].getAttribute("data-index"))>t.index){i.insertBefore(e,o[c]),s=!1;break}s&&i.appendChild(e),M.query(e,".setting-group-title").innerText=t.title,t.items.forEach(function(e){n._drawItem(t,e)})},_drawItem:function(e,i){for(var t=M.element("li",{class:"setting-item","data-index":i.index,"data-id":i.id}),n=(t.innerHTML='<div class="setting-item-left"><div class="setting-item-title"></div><div class="setting-item-message"></div></div><div class="setting-item-right"></div>',M.query(this.dialogDom,".setting-group[data-id="+e.id+"] .setting-tree")),o=n.children,s=!0,c=0;c<o.length;c++)if(parseInt(o[c].getAttribute("data-index"))>i.index){n.insertBefore(t,o[c]),s=!1;break}s&&n.appendChild(t),M.query(t,".setting-item-title").innerText=i.title,i.message?M.query(t,".setting-item-message").innerText=i.message:t.classList.add("no-message");var a=M.query(t,".setting-item-right"),r=function(){};function l(){var e;"null"!=i.type&&((e=i.get())instanceof Promise?e.then(r):r(e))}({string:function(){a.innerHTML='<input type="text" class="setting-item-input">',r=function(e){M.query(a,".setting-item-input").value=e}},number:function(){a.innerHTML='<input type="number" class="setting-item-input">',r=function(e){M.query(a,".setting-item-input").value=e}},boolean:function(){a.innerHTML='<div class="check-box"><div class="check-box-inner"></div><input type="checkbox" class="setting-item-input"></div>',r=function(e){(M.query(a,".setting-item-input").checked=e)&&M.query(a,".check-box").classList.add("checked"),M.query(a,".check-box").addEventListener("click",function(){M.query(a,".setting-item-input").click(),M.query(a,".setting-item-input").checked?this.classList.add("checked"):this.classList.remove("checked")})}},range:function(){a.innerHTML='<input type="range" class="setting-item-input">',r=function(e){M.query(a,".setting-item-input").value=e};var e=i.init();function t(e){M.query(a,".setting-item-input").max=e[1],M.query(a,".setting-item-input").min=e[0]}e instanceof Promise?e.then(t):t(e)},select:function(){a.innerHTML='<select class="setting-item-input"></select>',r=function(e){t=e};var t,e=i.init();function n(n){M.query(a,".setting-item-input").innerHTML=(()=>{var e,t="";for(e in n)t+=`<option value="${e}">${n[e]}</option>`;return t})(),r=function(e){M.query(a,".setting-item-input").value=e},t&&r(t)}e instanceof Promise?e.then(n):n(e)},null:function(){a.innerHTML=`<div class="setting-item-input null-click">${M.getGoogleIcon("e5e1")}</div>`,t.classList.add("just-callback-item"),t.onclick=function(){i.callback()}}})[i.type](),l(),i.getacb=l,M.query(a,".setting-item-input").addEventListener("range"==i.type?"input":"null"==i.type?"click":"change",function(e){var t;this.classList.contains("null-click")||(t="checkbox"==this.type?this.checked:this.value,"function"!=typeof i.check||i.check(t)?i.callback(t):l())})},_dochangeGroup:function(e,t){var n=M.query(this.dialogDom,".setting-group[data-id="+e.id+"]");if("title"==t.attr)M.query(n,".setting-group-title").innerText=t.content;else if("index"==t.attr){n.setAttribute("data-index",t.content);for(var i=M.query(this.dialogDom,".setting-root"),o=i.children,s=!0,c=0;c<o.length;c++)if(!o[c].isSameNode(n)&&parseInt(o[c].getAttribute("data-index"))>t.content){i.insertBefore(n,o[c]),s=!1;break}s&&i.appendChild(n)}else"show"==t.attr&&(n.style.display=t.content?"block":"none")},_dochangeItem:function(e,t,n){var i=M.query(this.dialogDom,".setting-group[data-id="+e.id+"] .setting-item[data-id="+t.id+"]");if("title"==n.attr)M.query(i,".setting-group-title").innerText=n.content;else if("message"==n.attr)n.content?(M.query(i,".setting-item-message").innerText=n.content,i.classList.remove("no-message")):i.classList.add("no-message");else if("index"==n.attr){i.setAttribute("data-index",n.content);for(var o=M.query(this.dialogDom,".setting-group[data-id="+e.id+"] .setting-tree"),s=o.children,c=!0,a=0;a<s.length;a++)if(!s[a].isSameNode(i)&&parseInt(s[a].getAttribute("data-index"))>n.content){o.insertBefore(i,s[a]),c=!1;break}c&&o.appendChild(i)}else"show"==n.attr&&(i.style.display=n.content?"block":"none")},_reinitItem:function(e,t){var n,e=M.query(this.dialogDom,".setting-group[data-id="+e.id+"] .setting-item[data-id="+t.id+"]"),i=M.query(e,".setting-item-right");if("range"==t.type)n=function(e){M.query(i,".setting-item-input").max=e[1],M.query(i,".setting-item-input").min=e[0]};else{if("select"!=t.type)return;n=function(n){M.query(i,".setting-item-input").innerHTML=(()=>{var e,t="";for(e in n)t+=`<option value="${e}">${n[e]}</option>`;return t})(),cb=function(e){M.query(i,".setting-item-input").value=e},guaqi&&cb(guaqi)}}e=t.init();e instanceof Promise?e.then(n):n(e)},_regetItem:function(e){e.getacb()}},e=ie,oe.prototype={addNewItem:function(e){this.items.push(e);var n=this;e.on("change",function(e,t){n._dochange({type:"change",details:e,id:t.id})}),n._dochange({type:"add"})},setTitle:function(e){this.title=e,this._dochange({type:"it",details:{attr:"title",content:e}})},setIndex:function(e){this.index=e,this._dochange({type:"it",details:{attr:"index",content:e}})},on:function(e,t){this._events[e]&&this._events[e].push(t)},show:function(){this.show=!0,this._dochange({type:"it",details:{attr:"show",content:!0}})},hide:function(){this.show=!1,this._dochange({type:"it",details:{attr:"show",content:!1}})},_dochange:function(t){var n=this;this._events.change.forEach(function(e){e(t,n)})}},pe=oe,se.prototype={reInit:function(){this._dochange({attr:"reinit"})},reGet:function(){this._dochange({attr:"reget"})},setTitle:function(e){this.title=e,this._dochange({attr:"title",content:e})},setIndex:function(e){this.index=e,this._dochange({attr:"index",content:e})},setMessage:function(e){this.message=e,this._dochange({attr:"message",content:e})},show:function(){this._show=!0,this._dochange({attr:"show",content:!0})},hide:function(){this._show=!1,this._dochange({attr:"show",content:!1})},on:function(e,t){this._events[e]&&this._events[e].push(t)},_dochange:function(t){var n=this;this._events.change.forEach(function(e){e(t,n)})}},L=se,ee=new e({title:"设置"}),ne.pushMenu({icon:M.getGoogleIcon("e8b8",{type:"fill"}),title:"主设置",click:function(){ee.open()}},ne.MAIN_MENU_TOP),te=ee,new U.icon({content:M.getGoogleIcon("e8b8",{type:"fill"}),offset:"bl"}).getIcon().onclick=function(){te.open()},T=new pe({title:"通用",index:0}),te.addNewGroup(T),{Setting:e,SettingGroup:pe,SettingItem:L,mainSetting:te,tyGroup:T});function ie(e){this.title=e.title,this.dialog=new H({content:`<div class="actionbar"><h1>设置</h1><div class="closeBtn">${M.getGoogleIcon("e5cd")}</div></div><ul class="setting-root"></ul>`,class:"setting_dia",mobileShowtype:H.SHOW_TYPE_FULLSCREEN}),this.dialogDom=this.dialog.getDialogDom(),M.query(this.dialogDom,".closeBtn").addEventListener("click",()=>{this.dialog.close()}),M.query(this.dialogDom,".actionbar h1").innerText=this.title,this.groups=[],this._events={change:[]}}function oe(e){this.title=e.title,this.index=e.index,this.index<0&&(this.index=0),this.items=[],this.id="seg_"+M.getRandomHashCache(),this._events={change:[]}}function se(e){this.title=e.title,this.index=e.index,this.type=e.type,this.init=e.init,this.check=e.check,this.callback=e.callback,this.message=e.message,this.get=e.get,this._show=!0,this.id="sei_"+M.getRandomHashCache(),this._events={change:[]}}var c,a,ce,d,u,g,ae,re,le,de,ue,ge,fe,he,f,me=e.Setting,G=e.SettingGroup,P=e.SettingItem,v=e.mainSetting,pe=e.tyGroup,ve=function(){var c,t,a,s,r,n,{addEventListener:e,removeEventListener:i,doevent:g}=z(),f=new G({title:"搜索框",index:1}),h=(v.addNewGroup(f),c={SA:[],enter:[]},t=p("omnibox",{sync:!0,title:"搜索框",desc:"搜索框相关设置"}),a=[],s=function(){var i,e,n,o,s,t;if(p)return i=p("search",{sync:!0,title:"搜索引擎",desc:"搜索引擎配置",compare:function(e,t,n){var i=s();for(t in n.typelist)i[t]=n.typelist[t];n.typelist=i,e[t]=n}}),t={bing:"https://cn.bing.com/search?q="+(e="%keyword%"),baidu:"https://www.baidu.com/s?wd="+e,so:"https://so.com/s?q="+e,sogou:"https://sogou.com/web?query="+e,google:"https://google.com/search?q="+e},i.get("typelist")||i.set("typelist",t),i.get("type")||i.set("type","bing"),n={},o=function(e,t){n[e]&&n[e].forEach(function(e){e.apply(null,t)})},t={getSearchType:function(){return i.get("typelist")[i.get("type")]},addEventListener:function(e,t){n[e]?n[e].push(t):n[e]=[t]},setSearchList:function(e){if(0==Object.keys(e).length)throw new Error("newList is empty");i.set("typelist",e);var t=i.get("typelist"),n=(o("typelistchange"),i.get("type"));t[n]!=e[n]&&o("nowtypechange")},getSearchTypeList:s=function(){return i.get("typelist")},setSearchType:function(e){i.set("type",e),o("nowtypechange")},getSearchTypeIndex:function(){return i.get("type")}},Object.defineProperty(t,"keywordText",{get:function(){return e}}),t}(),l({check:function(){return!0},enter:function(e){open(s.getSearchType().replace(s.keywordText,e))},icon:":searchtype",submit:M.getGoogleIcon("E8B6")}),l({check:u,enter:function(e){-1==e.indexOf("://")&&(e="http://"+e),open(e)},icon:M.getGoogleIcon("E80B"),submit:M.getGoogleIcon("E89E")}),d({check:function(e){return!!e},get:function(e,t){t=t();return t.unshift({icon:M.getGoogleIcon("E8B6"),text:e,click:function(){open(s.getSearchType().replace(s.keywordText,e))}}),t}}),r=null,d({check:function(e){return!!e},get:function(i,o){return new Promise(function(t,e){var n=o();r=M.jsonp("https://www.baidu.com/sugrec?pre=1&p=3&ie=utf-8&json=1&prod=pc&from=pc_web&wd="+i,function(e){r=null,e.g&&e.g.forEach(function(e){n.push({icon:M.getGoogleIcon("E8B6"),text:e.q,click:function(){open(s.getSearchType().replace(s.keywordText,e.q))}})}),t(n)},"cb")})},interrupt:function(){r&&(r.abort(),r=null)}}),d({check:u,get:function(i,o){return new Promise(function(e,t){var n=o();n.unshift({icon:M.getGoogleIcon("E80B"),text:i,click:function(){-1==i.indexOf("://")&&(i="http://"+i),open(i)}}),e(n)})}}),n=new P({title:"搜索框仅搜索",index:1,type:"boolean",message:"打开后，搜索框将失去打开链接的功能",get:function(){return!!t.get("justsearch")},callback:function(e){return t.set("justsearch",e),!0}}),f.addNewItem(n),{getSA:function(e,n){0<a.length&&a.forEach(function(e){c.SA[e].interrupt()});for(var i,o=[],t=c.SA.length,s=0;s<t;s++)c.SA[s].check(e)&&((i=c.SA[s].get(e,function(){return o}))instanceof Promise?(a.push(s),function(t){i.then(function(e){o=e,a.splice(a.indexOf(t),1),n(o)})}(s)):n(o=i))},enter:function(e){g("beforeenter",[e]),o(e).enter(e),g("afterenter",[e])},getType:o,addNewType:l,addNewSA:d,searchUtil:s,initsto:t,setJustSearch:function(e){t.set("justsearch",e),n.reGet()}});function o(e){for(var t=0;t<c.enter.length;t++)if(c.enter[t].check(e))return c.enter[t]}function l(e){c.enter.unshift(e)}function d(e){c.SA.push(e)}function u(e){return!t.get("justsearch")&&/^(https?:\/\/)?([a-zA-Z0-9\.\-]+(\:[a-zA-Z0-9\.&%\$\-]+)*@)?((25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9])\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[0-9])|([a-zA-Z0-9\-]+\.)*[a-zA-Z0-9\-]+\.[a-zA-Z]{2,4})(\:[0-9]+)?(\/[^\/][a-zA-Z0-9\.\,\?\'\\\/\+&%\$#\=~_\-@]*)*(\/)?$/.test(e)}var m=function(){"use strict";var e=M.element("div",{class:"searchbox"}),t=M.element("div",{class:"cover searchcover"}),n=M.element("div",{class:"searchpadding"}),i=(e.innerHTML='<div class="box"><div class="icon"></div><div class="input"><input type="text" placeholder="搜索或输入网址"></div><div class="submit"></div></div><ul class="sas"></ul>',M.query(document,"main").append(e),M.query(document,"main").append(t),M.query(document,"main .center").append(n),M.query(e,"div.icon")),o=M.query(e,"div.input input"),s=M.query(e,"div.submit"),c=M.query(e,"ul.sas");function a(e){var t,e=h.getType(e);":"==e.icon[0]?(i.setAttribute("data-teshu",e.icon),(t=":searchtype"==e.icon?new Promise(function(t,e){M.getFavicon(h.searchUtil.getSearchType(),function(e){t(e?'<img src="'+e+'"/>':'<img src="'+M.createIcon("s")+'"/>')})}):"")instanceof Promise?t.then(function(e){i.innerHTML=e}):i.innerHTML=t):(i.innerHTML=e.icon,i.removeAttribute("data-teshu")),":"==e.submit[0]?(s.setAttribute("data-teshu",e.submit),s.innerHTML=(e.submit,"")):(s.innerHTML=e.submit,s.removeAttribute("data-teshu"))}function r(){a(this.value.trim()),c.innerHTML="",h.getSA(this.value.trim(),function(e){var t=(t=M.query(c,"li.active"))&&{icon:M.query(t,"div.saicon").innerHTML,text:M.query(t,"div.sa_text").innerHTML};c.innerHTML="",e.forEach(function(e){var t=M.element("li");t.innerHTML=`<div class="saicon">${e.icon}</div><div class="sa_text">${e.text}</div>`,c.append(t),t.onclick=e.click}),t&&M.query(c,"li",!0).forEach(function(e){M.query(e,"div.saicon").innerHTML&&M.query(e,"div.sa_text").innerHTML==t.text&&e.classList.add("active")})}),g("input",[o.value])}o.oninput=M.fangdou(r,300),o.onkeydown=function(e){var t;"Enter"==e.key?(t=M.query(c,"li.active"))?t.click():h.enter(this.value):"ArrowUp"==e.key?(e.preventDefault(),(t=M.query(c,"li.active"))&&(t.classList.remove("active"),t.previousElementSibling)&&t.previousElementSibling.classList.add("active")):"ArrowDown"==e.key?(e.preventDefault(),(t=M.query(c,"li.active"))?t.nextElementSibling&&(t.classList.remove("active"),t.nextElementSibling.classList.add("active")):M.query(c,"li").classList.add("active")):"ArrowRight"==e.key&&(t=M.query(c,"li.active"))&&(o.value=M.query(t,".sa_text").innerText,r.call(this))},o.addEventListener("focus",function(){t.classList.add("active"),e.classList.add("active"),g("focus",[o])}),o.addEventListener("blur",function(){setTimeout(function(){t.classList.remove("active"),e.classList.remove("active"),g("blur",[o])},5)}),s.onclick=function(){h.enter(o.value)};var l=M.element("div",{class:"searchtypeselector"});function d(){var e,t=M.query(l,"ul"),n=h.searchUtil.getSearchTypeIndex(),i=(t.innerHTML="",h.searchUtil.getSearchTypeList());for(e in i){var o=M.element("li");o.innerHTML="<img/>",!function(t,e){M.getFavicon(i[e],function(e){t.querySelector("img").src=e||M.createIcon("s")})}(o,e),o.setAttribute("data-type",e),t.append(o),e==n&&o.classList.add("active"),o.onclick=function(){var e=M.query(l,"ul li.active");e&&e.classList.remove("active"),this.classList.add("active"),h.searchUtil.setSearchType(this.getAttribute("data-type")),l.classList.remove("active")}}l.style.width=36*M.query(t,"li",!0).length+"px"}l.innerHTML="<ul></ul>",M.query(document,"main .center").append(l),i.addEventListener("click",function(){l.classList.contains("active")?l.classList.remove("active"):l.classList.add("active")}),h.searchUtil.addEventListener("nowtypechange",function(){":searchtype"==i.getAttribute("data-teshu")&&a(o.value)}),h.searchUtil.addEventListener("typelistchange",function(){d()}),d(),a(""),h.initsto.get("autofocus")&&setTimeout(function(){o.focus()});var u=new P({title:"自动聚焦",index:1,type:"boolean",message:"打开页面自动聚焦搜索框",get:function(){return!!h.initsto.get("autofocus")},callback:function(e){return h.initsto.set("autofocus",e),!0}});return f.addNewItem(u),{setValue:function(e){o.value=e,o.focus()},setAutoFocus:function(e){h.initsto.set("autofocus",e),u.reGet()}}}();return{value:m.setValue,addNewSug:h.addNewSA,addEventListener:e,removeEventListener:i,getSearchType:h.searchUtil.getSearchType,getSearchTypeList:h.searchUtil.getSearchTypeList,getSearchTypeIndex:h.searchUtil.getSearchTypeIndex,setSearchType:h.searchUtil.setSearchType,setSearchList:h.searchUtil.setSearchList,search:{addEventListener:h.searchUtil.addEventListener},sg:f,setAutoFocus:m.setAutoFocus,setJustSearch:m.setJustSearch}}(),ye=(c=p("link",{sync:!0,title:"链接",desc:"QUIK起始页链接数据",get:async function(){var e=c.getAll();return"db"==e["storage-mode"]&&(e.links=await localforage.getItem(e.links),e.cate=await localforage.getItem(e.cate)),delete e["storage-mode"],e},rewrite:function(n,i,o){return new Promise(function(t){o["storage-mode"]=c.get("storage-mode"),"db"==c.get("storage-mode")?c.remove("links",!0,function(){Q.set(o.links,function(e){o.links=e,c.remove("cate",!0,function(){Q.set(o.cate,function(e){o.cate=e,n[i]=o,t()})})})}):n[i]=o})},compare:function(n){return new Promise(function(t){n["storage-mode"]=c.get("storage-mode"),"db"==n["storage-mode"]?c.get("links",!0,function(e){c.remove("links",!0,function(){}),n.links=be(e,n.links),Q.set(n.links,function(e){n.links=e,c.get("cate",!0,function(e){c.remove("cate",!0,function(){}),n.cate=function(e,t){for(var n in e)t[n]?t[n]=be(e[n],t[n]):t[n]=e[n];return t}(e,n.cate),Q.set(n.cate,function(e){n.cate=e,ast[k]=n,t()})})})}):(n.links=be(c.get("links"),n.links),n.cate=be(c.get("cates"),n.cate),ast[k]=n)})}}),d={change:[]},f=p.checkIDB()?(c.set("storage-mode","db"),a=0,console.log(c.get("links"),c.get("cate")),c.get("links")?a++:c.set("links",[],!0,function(){2==++a&&ce()}),c.get("cate")?a++:c.set("cate",{},!0,function(){2==++a&&ce()}),ce=function(){},2==a&&ce(),{addLink:function(t,n=function(){}){if(2!=a)throw"初始化未完成";if(!M.checkDetailsCorrect(t,["title","url"]))throw"参数不正确";t.cate?c.get("cate",!0,function(e){e[t.cate]?(e[t.cate]=ke(t,e[t.cate]),c.set("cate",e,!0,function(){n({code:0,msg:"添加成功"}),h("change",{cate:t.cate,type:"add",detail:t})})):n({code:-1,msg:"分组不存在"})}):c.get("links",!0,function(e){e=ke(t,e),c.set("links",e,!0,function(){n({code:0,msg:"添加成功"}),h("change",{cate:null,type:"add",detail:t})})})},changeLink:function(n,i,o,s=function(){}){if(2!=a)throw"初始化未完成";if(!M.checkDetailsCorrect(o,["title","url"])||"number"!=typeof i)throw"参数错误";n?c.get("cate",!0,function(e){var t;e[n]?(t=we(i,o,e[n]))?(e[n]=t,c.set("cate",e,!0,function(){s({code:0,msg:"修改成功"}),h("change",{cate:n,index:i,type:"change",detail:o})})):s({code:-2,msg:"链接不存在"}):s({code:-1,msg:"分组不存在"})}):c.get("links",!0,function(e){var t=we(i,o,e);t?c.set("links",e=t,!0,function(){s({code:0,msg:"修改成功"}),h("change",{cate:null,index:i,type:"change",detail:o})}):s({code:-2,msg:"链接不存在"})})},deleteLink:function(t,n,i=function(){}){if(2!=a)throw"初始化未完成";t?c.get("cate",!0,function(e){e[t]?e[t][n]?(e[t].splice(n,1),c.set("cate",e,!0,function(){i({code:0,msg:"删除成功"}),h("change",{cate:t,index:n,type:"delete"})})):i({code:-2,msg:"链接不存在"}):i({code:-1,msg:"分组不存在"})}):c.get("links",!0,function(e){e[n]?(e.splice(n,1),c.set("links",e,!0,function(){i({code:0,msg:"删除成功"}),h("change",{cate:null,index:n,type:"delete"})})):i({code:-2,msg:"链接不存在"})})},addCate:function(t,n=function(){}){if(2!=a)throw"初始化未完成";c.get("cate",!0,function(e){e[t]?n({code:-1,msg:"分组已存在"}):(e[t]=[],c.set("cate",e,!0,function(){n({code:0,msg:"添加成功"}),h("change",{cate:t,type:"cateadd"})}))})},renameCate:function(t,n,i=function(){}){if(2!=a)throw"初始化未完成";c.get("cate",!0,function(e){e[t]?(e[n]&&i({code:-2,msg:"分组重名"}),e[n]=e[t],delete e[t],c.set("cate",e,!0,function(){i({code:0,msg:"修改成功"}),h("change",{cate:t,catename:n,type:"caterename"})})):i({code:-1,msg:"分组不存在"})})},deleteCate:function(n,i=function(){}){if(2!=a)throw"初始化未完成";c.get("cate",!0,function(t){t[n]?t[n].length<=1?(delete t[n],c.set("cate",t,!0,function(){i({code:0,msg:"删除成功"}),h("change",{cate:n,type:"catedelete"})})):It("确定要删除分组吗？无法恢复！",function(e){e?(delete t[n],c.set("cate",t,!0,function(){i({code:0,msg:"删除成功"}),h("change",{cate:n,type:"catedelete"})})):i({code:-2,msg:"用户取消删除"})}):i({code:-1,msg:"分组不存在"})})},getLinks:function(t,n=function(){}){if(2!=a)throw"初始化未完成";t?c.get("cate",!0,function(e){e[t]?n({code:0,msg:"获取成功",data:e[t]}):n({code:-1,msg:"分组不存在"})}):c.get("links",!0,function(e){n({code:0,msg:"获取成功",data:e})})},getCates:function(t=function(){}){c.get("cate",!0,function(e){console.log(Object.keys(e),c.get("cate")),t({code:0,msg:"获取成功",data:Object.keys(e)})})},getCateAll:function(t=function(){}){c.get("cate",!0,function(e){t({code:0,msg:"获取成功",data:e})})},ready:function(e){2==a?e():ce=e},addEventListener:function(e,t){d[e]?d[e].push(t):d[e]=[t]},removeEventListener:function(n,i){d[n]&&d[n].forEach(function(e,t){e===i&&d[n].splice(t,1)})}}):(console.warn("浏览器不支持indexedDB，将在限制模式下使用"),c.set("storage-mode","localstorage"),c.get("links")||c.set("links",[]),c.get("cate")||c.set("cate",{}),{addLink:function(e,t=function(){}){if(!M.checkDetailsCorrect(e,["title","url"]))throw"参数不正确";var n=qe(e);n&&t({code:-3,msg:"受限模式下，"+n+"长度过长",lm:n}),e.cate?(n=c.get("cate"))[e.cate]?100<n[e.cate].length?t({code:-4,msg:"受限模式下，分组下已超过100条链接，无法添加"}):(n[e.cate]=ke(e,n[e.cate]),c.set("cate",n),t({code:0,msg:"添加成功"}),doevents("change",{cate:e.cate,type:"add",detail:e})):t({code:-1,msg:"分组不存在"}):100<(n=c.get("links")).length?t({code:-4,msg:"受限模式下，分组下已超过100条链接，无法添加"}):(n=ke(e,n),c.set("links",n),t({code:0,msg:"添加成功"}),doevents("change",{cate:null,type:"add",detail:e}))},changeLink:function(e,t,n,i=function(){}){if(!M.checkDetailsCorrect(n,["title","url"])||"number"!=typeof t)throw"参数错误";var o,s=qe(n);s&&i({code:-3,msg:"受限模式下，"+s+"长度过长",lm:s}),e?(s=c.get("cate"))[e]?(o=we(t,n,s[e]))?(s[e]=o,c.set("cate",s),i({code:0,msg:"修改成功"}),doevents("change",{cate:e,index:t,type:"change",detail:n})):i({code:-2,msg:"链接不存在"}):i({code:-1,msg:"分组不存在"}):(o=we(t,n,c.get("links")))?(c.set("links",o),i({code:0,msg:"修改成功"}),doevents("change",{cate:null,index:t,type:"change",detail:n})):i({code:-2,msg:"链接不存在"})},deleteLink:function(e,t,n=function(){}){var i;e?(i=c.get("cate"))[e]?i[e][t]?(i[e].splice(t,1),c.set("cate",i),n({code:0,msg:"删除成功"}),doevents("change",{cate:e,index:t,type:"delete"})):n({code:-2,msg:"链接不存在"}):n({code:-1,msg:"分组不存在"}):(i=c.get("links"))[t]?(i.splice(t,1),c.set("links",i),n({code:0,msg:"删除成功"}),doevents("change",{cate:null,index:t,type:"delete"})):n({code:-2,msg:"链接不存在"})},addCate:function(e,t=function(){}){var n=c.get("cate");n[e]?t({code:-1,msg:"分组已存在"}):20<=Object.keys(n).length?t({code:-2,msg:"受限模式下，分组数量不能超过20个"}):(n[e]=[],c.set("cate",n),t({code:0,msg:"添加成功"}),doevents("change",{cate:e,type:"cateadd"}))},renameCate:function(e,t,n=function(){}){var i=c.get("cate");i[e]?(i[t]&&n({code:-2,msg:"分组重名"}),i[t]=i[e],delete i[e],c.set("cate",i),n({code:0,msg:"修改成功"}),doevents("change",{cate:e,catename:t,type:"caterename"})):n({code:-1,msg:"分组不存在"})},deleteCate:function(t,n=function(){}){var i=c.get("cate");i[t]?i[t].length<=1?(delete i[t],c.set("cate",i),n({code:0,msg:"删除成功"})):It("确定要删除分组吗？无法恢复！",function(e){e?(delete i[t],c.set("cate",i),n({code:0,msg:"删除成功"}),doevents("change",{cate:t,type:"catedelete"})):n({code:-2,msg:"用户取消删除"})}):n({code:-1,msg:"分组不存在"})},getLinks:function(e,t=function(){}){var n;e?(n=c.get("cate"))[e]?t({code:0,msg:"获取成功",data:n[e]}):t({code:-1,msg:"分组不存在"}):t({code:0,msg:"获取成功",data:n=c.get("links")})},getCates:function(e=function(){}){var t=c.get("cate");e({code:0,msg:"获取成功",data:Object.keys(t)})},getCateAll:function(e=function(){}){e({code:0,msg:"获取成功",data:c.get("cate")})},ready:function(e){e()},addEventListener:function(e,t){d[e]?d[e].push(t):d[e]=[t]},removeEventListener:function(n,i){d[n]&&d[n].forEach(function(e,t){e===i&&d[n].splice(t,1)})}}),u=M.element("div",{class:"links"}),M.query(document,"main .center").append(u),re=null,le=[],de=new V({list:[{icon:M.getGoogleIcon("e3c9"),title:"修改",click:function(){var e=Le(re,M.query(u,".link-list li",!0)),t=M.query(u,".cate-bar-items .cate-item.active");Se(e,t=t.classList.contains("mr")?null:t.innerText)}},{icon:M.getGoogleIcon("e92e"),title:"删除",click:function(){var e=Le(re,M.query(u,".link-list li",!0)),t=(t=M.query(u,".cate-bar-items .cate-item.active")).classList.contains("mr")?null:t.innerText;f.deleteLink(t,e,function(){r.show("删除成功")})}}]}),ue=null,ge=new V({list:[{icon:M.getGoogleIcon("e3c9"),title:"重命名",click:function(){Ee(ue.innerText)}},{icon:M.getGoogleIcon("e92e"),title:"删除",click:function(){var e=ue.innerText;f.deleteCate(e,function(e){0==e?r.show("删除成功"):r.show(e.msg)})}}]}),window.addEventListener("resize",function(){Te.call(M.query(u,".cate-bar-scrolls"))}),f.addEventListener("change",function(e){var t=M.query(u,".cate-bar-items .cate-item.active");if((e.cate==t.innerText||null==e.cate&&t.classList.contains("mr"))&&-1!=["add","change","delete"].indexOf(e.type)&&_e(e.cate),"cateadd"==e.type)xe(e.cate);else if("catedelete"==e.type){for(var n=M.query(u,".cate-bar-items .cate-item",!0),i=0;i<n.length;i++)if(n[i].innerText==e.cate){n[i].classList.contains("active")&&(_e(),M.query(u,".cate-bar-items .cate-item.mr").classList.add("active")),n[i].remove();break}}else if("caterename"==e.type)for(n=M.query(u,".cate-bar-items .cate-item",!0),i=0;i<n.length;i++)if(n[i].innerText==e.cate){n[i].innerText=e.catename;break}}),u.innerHTML='<div class="cate-bar"><div class="cate-bar-controls"><div class="cate-left-btn">{{cate-left}}</div></div><div class="cate-bar-scrolls"><div class="cate-bar-items"><div class="cate-item mr active">默认</div></div></div><div class="cate-bar-controls"><div class="cate-right-btn">{{cate-right}}</div><div class="cate-add-btn">{{cate-add}}</div></div></div><ul class="link-list"></ul>'.replace("{{cate-left}}",M.getGoogleIcon("e314")).replace("{{cate-right}}",M.getGoogleIcon("e315")).replace("{{cate-add}}",M.getGoogleIcon("e145")),f.ready(function(){function e(e){var t;return e<0?0:(t=M.query(u,".cate-bar-scrolls").scrollWidth-M.query(u,".cate-bar-scrolls").getBoundingClientRect().width)<e?t:void 0}f.getCates(function(e){e.data.forEach(function(e){xe(e)})}),M.query(u,".cate-item.mr").onclick=function(){try{M.query(u,".cate-bar-items .cate-item.active").classList.remove("active")}catch(e){}this.classList.add("active"),_e()},M.query(u,".cate-add-btn").onclick=function(){Ee()},M.query(u,".cate-left-btn").onclick=function(){M.query(u,".cate-bar-scrolls").scrollTo({left:e(M.query(u,".cate-bar-scrolls").scrollLeft-M.query(u,".cate-bar-scrolls").getBoundingClientRect().width/2),behavior:"smooth"})},M.query(u,".cate-right-btn").onclick=function(){M.query(u,".cate-bar-scrolls").scrollTo({left:e(M.query(u,".cate-bar-scrolls").scrollLeft+M.query(u,".cate-bar-scrolls").getBoundingClientRect().width/2),behavior:"smooth"})},M.query(u,".cate-bar-scrolls").onscroll=function(){Te.call(this)},Te.call(M.query(u,".cate-bar-scrolls")),De(c.get("enabledCate")),Ae(c.get("linksize"))}),new MutationObserver(function(){setTimeout(Ie,1)}).observe(M.query(u,".cate-bar-items"),{childList:!0}),void 0===c.get("enabledCate")&&c.set("enabledCate",!0),c.get("linksize")||c.set("linksize","m"),L=new G({title:"链接"}),fe=new P({type:"boolean",title:"链接分组",message:"启用链接分组功能来管理链接",get:function(){return c.get("enabledCate")},callback:function(e){c.set("enabledCate",e),De(e)}}),he=new P({type:"select",title:"链接大小",message:"修改链接显示的大小",init:function(){return{xs:"很小",s:"小",m:"中",l:"大",xl:"很大"}},get:function(){return c.get("linksize")},callback:function(e){c.set("linksize",e),Ae(e)}}),v.addNewGroup(L),L.addNewItem(fe),L.addNewItem(he),L={setShowCate:function(e){c.set("enabledCate",e),De(e),fe.reGet()},setLinkSize:function(e){-1!=["xs","s","m","l","xl"].indexOf(e)&&(c.set("linksize",e),Ae(e),he.reGet())},cateWidthShiPei:Ie},M.joinObj(f,L));function be(t,e){for(var n=0;n<t.length;n++)e.find(function(e){return e.title==t[n].title&&e.url==t[n].url})||e.push(t[n]);return e}function ke(e,t){var n={title:e.title,url:e.url};return"number"==typeof e.index&&0<=e.index?e.index>t.length?(console.warn("添加链接时，index超出范围，应在0-"+t.length+"之间"),t.push(n)):t.splice(e.index,0,n):t.push(n),t}function we(e,t,n){var i;return!!n[e]&&(i={title:t.title,url:t.url},n[e]=i,"number"==typeof t.index&&0<=t.index&&(t.index>=n.length?console.warn("修改链接时，index超出范围，应在0-"+(n.length-1)+"之间"):(i=n.splice(e,1)[0],n.splice(t.index,0,i))),n)}function qe(e){return 1e3<e.url.length?"url":60<e.title.length&&"title"}function h(e,t){d[e].forEach(function(e){e.apply(null,[t])})}function Le(e,t){for(var n=0;n<t.length;n++)if(t[n].isSameNode(e))return n;return-1}function xe(e){var t=M.element("div",{class:"cate-item"});t.innerText=e,M.query(u,".cate-bar-items").append(t),t.onclick=function(){_e(this)},t.oncontextmenu=function(e){e.preventDefault(),ue=this,ge.setOffset({top:e.pageY,left:e.pageX}),ge.show()}}function Te(){0==this.scrollLeft?M.query(u,".cate-left-btn").classList.add("disabled"):M.query(u,".cate-left-btn").classList.remove("disabled"),this.scrollLeft>=this.scrollWidth-this.getBoundingClientRect().width?M.query(u,".cate-right-btn").classList.add("disabled"):M.query(u,".cate-right-btn").classList.remove("disabled")}function Ie(){var e=M.query(u,".cate-bar-items .cate-item",!0),t=(M.query(u,".cate-bar-items").style.width="100000px",e[0].offsetHeight,0);e.forEach(function(e){t+=e.getBoundingClientRect().width+4}),M.query(u,".cate-bar-items").style.width=t+"px",Te.call(M.query(u,".cate-bar-scrolls"))}function _e(e){M.query(u,".link-list").innerHTML="";var t=null;if("string"==typeof e){try{M.query(u,".cate-bar-items .cate-item.active").classList.remove("active")}catch(e){}for(var n=M.query(u,".cate-bar-items .cate-item",!0),i=0;i<n.length;i++)if(!n[i].classList.contains("mr")&&n[i].innerText==e){n[i].classList.add("active");break}t=e}else if(e){try{M.query(u,".cate-bar-items .cate-item.active").classList.remove("active")}catch(e){}e.classList.add("active"),t=e.innerText}else{try{M.query(u,".cate-bar-items .cate-item.active").classList.remove("active")}catch(e){}M.query(u,".cate-bar-items .cate-item.mr").classList.add("active")}f.getLinks(t,function(e){le=e.data,e.data.forEach(function(t){var n=M.element("li");n.innerHTML=`<a href="${t.url}" target="_blank" rel="noopener noreferer"><img/><p></p></a>`,M.query(u,".link-list").append(n),M.query(n,"p").innerText=t.title,M.getFavicon(t.url,function(e){M.query(n,"img").src=e||M.createIcon(t.title[0])}),n.oncontextmenu=function(e){e.preventDefault(),re=this,de.setOffset({top:e.pageY,left:e.pageX}),de.show()}});e=M.element("li",{class:"link-add"});e.innerHTML='<a href="javascript:void(0)" class="material-symbols-outlined">&#xe145;</a>',M.query(u,".link-list").append(e),e.onclick=function(){var e=M.query(u,".cate-bar-items .cate-item.active");Se(-1,e=e.classList.contains("mr")?null:e.innerText)}})}function Se(o,s){var e;g||(e=(g=new H({class:"link-add-dialog",content:'<form><h1></h1><div class="content"><p>URL ：<input class="link-add-url" type="url" required placeholder="链接地址(必填)"></p><p>标题：<input class="link-add-title" type="text" required placeholder="链接标题(必填)"></p><p>位置：<input class="link-add-index" type="number" min="0" placeholder="链接位置"></p></div><div class="footer"><div class="cancel btn">取消</div><button class="ok btn"></button></div></form>'})).getDialogDom(),M.query(e,".cancel.btn").onclick=function(e){e.preventDefault(),g.close()}),setTimeout(function(){g.open();var a=g.getDialogDom(),i=le.length;function e(e,t,n,i,o,s,c){M.query(a,"h1").innerHTML=e,M.query(a,".ok.btn").innerHTML=t,M.query(a,"input.link-add-url").value=n,M.query(a,"input.link-add-title").value=i,M.query(a,"input.link-add-index").setAttribute("max",o),M.query(a,"input.link-add-index").value=s,M.query(a,"form").onsubmit=c}-1==o?e("添加链接","添加","","",i,i,function(e){e.preventDefault();var e=M.query(a,".link-add-url").value,t=M.query(a,".link-add-title").value,n=M.query(a,".link-add-index").value;f.addLink({url:e,title:t,index:""==n?i:+n,cate:s},function(){r.show("添加成功")}),g.close()}):e("修改链接","修改",le[o].url,le[o].title,i-1,o,function(e){e.preventDefault();var e=M.query(a,".link-add-url").value,t=M.query(a,".link-add-title").value,n=M.query(a,".link-add-index").value;f.changeLink(s,o,{url:e,title:t,index:""==n?o:+n},function(e){0!=e.code?r.show(e.msg):(r.show("修改成功"),g.close())})})})}function Ee(t){var n=(ae=ae||new H({class:"link-add-dialog",content:'<form><h1></h1><div class="content"><p>标题：<input class="cate-name" type="text" required placeholder="分组标题(必填)"></p></div><div class="footer"><div class="cancel btn">取消</div><button class="ok btn">确定</button></div></form>'})).getDialogDom();M.query(n,".cancel.btn").onclick=function(e){e.preventDefault(),ae.close()},setTimeout(function(){ae.open(),t?(M.query(n,"h1").innerHTML="修改分组",M.query(n,".cate-name").value=t,M.query(n,"form").onsubmit=function(e){e.preventDefault();e=M.query(n,".cate-name").value;f.renameCate(t,e,function(e){e.code<0?r.show(e.msg):(r.show("修改成功"),ae.close())})}):(M.query(n,"h1").innerHTML="添加分组",M.query(n,".cate-name").value="",M.query(n,"form").onsubmit=function(e){e.preventDefault();e=M.query(n,".cate-name").value;f.addCate(e,function(e){e.code<0?r.show(e.msg):(r.show("添加成功"),ae.close())})})})}function De(e){_e(),e?(M.query(u,".cate-bar").style.display="block",setTimeout(function(){Ie()})):M.query(u,".cate-bar").style.display="none"}function Ae(e){M.query(u,".link-list").className="link-list "+e}y=p("says",{sync:!0,title:"一言",desc:"QUIK起始页一言相关配置",get:async function(){var e=y.getAll(),t=quik.addon.getAddonBySessionId(e.saytype);return t&&(e.requireAddon=t.url),e},rewrite:function(i,o,s){return new Promise(function(t,e){var n;s.requireAddon?(n=quik.addon.getAddonByUrl(s.requireAddon))?(s.saytype=n.session.id,i[o]=s,t()):It("该一言数据需要安装插件以同步，是否安装？",function(e){e?quik.addon.installAddon(s.requireAddon).then(function(e){s.saytype=e.session.id,i[o]=s,t()}).catch(function(e){0==e?D("插件取消安装，同步取消",function(){t()}):D("插件安装失败，同步取消",function(){t()})}):D("已取消一言同步",function(){t()})}):(i[o]=s,t())})}}),t=M.element("div",{class:"says"}),M.query(document,"main").appendChild(t),t.innerHTML=`<div class="say-inner"></div><div class="say-control">${M.getGoogleIcon("e5d4")}</div>`,Ue=M.query(t,"div.say-inner"),He=M.query(t,"div.say-control"),Ge=new V({list:[]}),Pe=new H({content:`<div class="closeBtn">${M.getGoogleIcon("e5cd")}</div><ul></ul>`,class:"says_info"}),Be=Pe.getDialogDom(),M.query(Be,"div.closeBtn").onclick=function(){Pe.close()},b={},w={},Re((y.get("usersay")||y.set("usersay","海内存知己，天涯若比邻"),m=null,{key:"user",name:"用户自定义",callback:function(){return new Promise(function(e,t){e({say:y.get("usersay"),title:"点击修改"})})},click:function(){je()},menu:[{icon:M.getGoogleIcon("e3c9"),title:"修改",click:function(){je()}},{icon:M.getGoogleIcon("e14d"),title:"复制",click:function(){var e=w.say;M.copyText(e)}}]})),Re((Oe={load:function(t){var n=0;!function e(){M.xhr("https://tenapi.cn/v2/yiyan?format=json",function(e){t(JSON.parse(e).data)},function(){++n<=5&&e()})}()},cats:{a:"动画",b:"漫画",c:"游戏",d:"文学",e:"原创",f:"来自网络",g:"其他",h:"影视",i:"诗词",j:"网易云",k:"哲学",l:"抖机灵"}},{key:"hitokoto",name:"随机一言",callback:function(){return new Promise(function(t,e){Oe.load(function(e){t({say:e.hitokoto,from:e.source,uuid:e.id,cat:e.cat,from_who:e.author,title:"该一言来自"+e.source+"，由"+e.author+"上传"})})})},click:function(){Fe("hitokoto")},menu:[{icon:M.getGoogleIcon("e5d5"),title:"刷新",click:function(){Fe("hitokoto")}},{icon:M.getGoogleIcon("e14d"),title:"复制",click:function(){var e=w.say;M.copyText(e)}},{icon:M.getGoogleIcon("e88e"),title:"一言详情",click:function(){var e=Oe.cats[w.cat];Je({API:"Ten·API（tenapi.cn） | Hitokoto (hitokoto.cn)","内容":w.say,"来源":w.from,"上传者":w.from_who,"分类":e||"未知",UUID:w.uuid})}}]})),Re((Ne=p("jrsc"),Me="jinrishici-token",(Ce={}).load=function(t){var e=Ne.get(Me);return e?ze(t,"https://v2.jinrishici.com/one.json?client=browser-sdk/1.2&X-User-Token="+encodeURIComponent(e)):ze(function(e){y.set(Me,e.token),t(e)},"https://v2.jinrishici.com/one.json?client=browser-sdk/1.2")},{key:"jinrishici",name:"今日诗词",callback:function(){return new Promise(function(t,e){Ce.load(function(e){t({say:e.data.content,author:"("+e.data.origin.dynasty+")"+e.data.origin.author,p_title:"《"+e.data.origin.title+"》",tags:e.data.matchTags.join(" "),content:"<br>"+e.data.origin.content.join("<br>"),title:"摘自"+e.data.origin.dynasty+"·"+e.data.origin.author+"的《"+e.data.origin.title+"》"})})})},click:function(){Fe("jinrishici")},menu:[{icon:M.getGoogleIcon("e5d5"),title:"刷新",click:function(){Fe("jinrishici")}},{icon:M.getGoogleIcon("e14d"),title:"复制",click:function(){var e=w.say;M.copyText(e)}},{icon:M.getGoogleIcon("e88e"),title:"诗词详情",click:function(){Je({API:"今日诗词（jinrishici.com）","内容":w.say,"作者":w.author,"标题":w.p_title,"全部内容":w.content})}}]})),He.onclick=function(e){e.stopPropagation();e=He.getBoundingClientRect();Ge.setOffset({bottom:window.innerHeight-e.top,left:e.left-90+e.width}),Ge.show()},y.get("saytype")||y.set("saytype","user"),null==y.get("enabled")&&y.set("enabled",!0),T=new G({title:"一言",index:3}),q=new P({title:"一言类型",type:"select",index:1,message:"页面底部显示的一言类型",init:function(){var e,t={};for(e in b)t[e]=b[e].name;return t},callback:function(e){$e(e)},get:function(){return y.get("saytype")}}),e=new P({title:"显示一言",type:"boolean",message:"是否页面底部显示的一言",index:0,callback:function(e){y.set("enabled",e),e?($e(y.get("saytype")),t.style.display="",q.show()):(t.style.display="none",q.hide())},get:function(){return y.get("enabled")}}),v.addNewGroup(T),T.addNewItem(q),T.addNewItem(e),y.get("enabled")?$e(y.get("saytype")):(t.style.display="none",q.hide());var m,Oe,Ne,Ce,Me,y,t,Ue,He,Ge,Pe,Be,b,w,q,L={getNowSay:function(){return w},setSayType:$e,addSayType:function(e){if(M.checkSession(e.session))throw"错误的session";e.key=e.session.id,Re(e),q.reInit()}};function Re(e){b[e.key]={name:e.name,callback:e.callback,click:e.click||function(){},menu:e.menu||[{icon:M.getGoogleIcon("e14d"),title:"复制",click:function(){var e=w.say;M.copyText(e)}}]}}function je(){var t;m||(t=(m=new H({class:"sayseditordialog",content:'<h1>修改一言</h1><div class="content"><p><input class="says-input" type="text"/></p></div><div class="footer"><div class="cancel btn">取消</div><button class="ok btn">确定</button></div>'})).getDialogDom(),M.query(t,".cancel.btn").onclick=function(){m.close()},M.query(t,".ok.btn").onclick=function(){var e=M.query(t,".says-input").value;y.set("usersay",e),Fe("user"),m.close()}),setTimeout(function(){var e=m.getDialogDom();m.open(),M.query(e,".says-input").value=y.get("usersay")})}function ze(t,e){var n=new XMLHttpRequest;n.open("get",e),n.withCredentials=!1,n.send(),n.onreadystatechange=function(){var e;4===n.readyState&&("success"===(e=JSON.parse(n.responseText)).status?t(e):console.error("今日诗词API加载失败，错误原因："+e.errMessage))}}function $e(e,t){if(M.checkSession(e)&&(e=e.id),!b[e])throw"type不存在 type:"+e;y.set("saytype",e),Ge.setList(b[e].menu),Ue.onclick=b[e].click,Fe(e,t),q.reGet()}function Fe(e,t){if(M.checkSession(e)&&(e=e.id),!b[e])throw"key不存在";Ue.innerText="...",Ue.title="加载中",b[e].callback().then(function(e){Ue.innerText=e.say,Ue.setAttribute("title",e.title),w=e,t&&t()})}function Je(n){M.query(Be,"ul").innerHTML=function(){var e,t="";for(e in n)t+="<li><b>"+e+":</b> "+n[e]+"</li>";return t}(),Pe.open()}We=new G({title:"背景",index:3}),T=new P({title:"背景设置",message:"点击设置背景",index:0,type:"null",callback:function(){Xe.open()}}),v.addNewGroup(We),We.addNewItem(T),T=z(),e=T.addEventListener,Tt=T.removeEventListener,Ke=T.doevent,Qe=M.element("div",{class:"bgf"}),M.query(document,"body").appendChild(Qe),B=p("background",{sync:!0,get:function(){return new Promise(function(e,t){var n=B.getAll();delete n.upload,"default"!=n.bg.type?n.requireAddon=quik.addon.getAddonBySessionId(n.bg.type).url:"userbg"==n.bg.data.type&&n.userbg.useidb&&(n.bg={type:"default",data:{type:"color",light:"#fff",dark:"#333"}}),n.userbg.useidb?(delete n.userbg,D("不支持同步用户上传的背景",function(){e(n)})):e(n)})},rewrite:function(i,o,s){return new Promise(function(t,e){var n;s.requireAddon?(n=quik.addon.getAddonByUrl(s.requireAddon))?(s.bg.type=n.session.id,i[o]=s,t()):It("该背景数据需要安装插件以同步，是否安装？",function(e){e?quik.addon.installAddon(s.requireAddon).then(function(e){s.bg.type=e.session.id,i[o]=s,t()}).catch(function(e){0==e?D("插件取消安装，同步取消",function(){t()}):D("插件安装失败，同步取消",function(){t()})}):D("已取消背景同步",function(){t()})}):(i[o]=s,t())})},title:"背景",desc:"QUIK起始页背景相关配置"}),Ye=0,Xe=new H({content:`<div class="actionbar"><h1>背景设置</h1><div class="closeBtn">${M.getGoogleIcon("e5cd")}</div></div><div class="tab_con"></div><div class="scroll_con"></div>`,class:"bg_d",mobileShowtype:H.SHOW_TYPE_FULLSCREEN}),R=Xe.getDialogDom(),M.query(R,".closeBtn").onclick=function(){Xe.close()},Ve=M.query(R,"div.tab_con"),Ze=M.query(R,"div.scroll_con"),B.get("bg")||B.set("bg",{type:"default",data:{type:"color",light:"#fff",dark:"#333"}}),T=function(){B.get("usercolor")||B.set("usercolor",{dark:"#333333",light:"#ffffff"}),B.get("ivsetting")||B.set("ivsetting",{mb:50,isbr:!1,br:6,th:1});var o,s,c,a,i={getImg:function(t){var n="",n=window.innerWidth<=500?"https://img.loliapi.cn/i/pe/img"+(parseInt(3095*Math.random())+1)+".webp":"https://img.loliapi.cn/i/pc/img"+(parseInt(696*Math.random())+1)+".webp";M.loadimg(n,function(e){if(e)t({url:n,candownload:!0});else{if("siquan001.github.io"==window.location.host)return function(t){M.xhr("https://stear.cn/api/quik.php?m=bg&key=sys81a1g519lsokh0e8&host=siquan001.github.io",function(e){e=JSON.parse(e),t({url:e.url,candoanload:!0})},function(){n="https://loliapi.com/acg/?_="+Date.now(),M.loadimg(n,function(){t({url:n,candoanload:!1})})})};n="https://loliapi.com/acg/?_="+Date.now(),M.loadimg(n,function(){t({url:n,candoanload:!1})})}})}},r={getImg:function(t){var n="https://img.gumengya.com/api/fj/"+(parseInt(4e3*Math.random())+1)+".jpg";M.loadimg(n,function(e){e?t({url:n,candownload:!0}):(n="https://api.gumengya.com/Api/FjImg?format=image&_="+Date.now(),M.loadimg(n,function(){t({url:n,candoanload:!1})}))})}},l=[{thumbnail:"https://image.gumengya.com/thumbnails/06470348c93db185e44f8acd87c5b683.png",img:"https://image.gumengya.cn/i/2023/10/13/65294cf55ef7d.png"},{thumbnail:"https://image.gumengya.com/thumbnails/5e6200d4552394e722967ef96addd06a.png",img:"https://image.gumengya.cn/i/2023/10/13/65294c34841b4.jpg"},{thumbnail:"https://image.gumengya.com/thumbnails/7ee6991ee0f43be59c28d183597e0cca.png",img:"https://image.gumengya.cn/i/2023/10/13/65294c30563b7.jpg"},{thumbnail:"https://image.gumengya.com/thumbnails/ff674343879116e22e3cf713358f2cb5.png",img:"https://image.gumengya.com/thumbnails/ff674343879116e22e3f713358f2cb5.png"},{thumbnail:"https://image.gumengya.com/thumbnails/c9c187157ca050044a6589f230e8ddbf.png",img:"https://image.gumengya.cn/i/2023/10/13/65294c2d8aae1.png"}],d=new U.icon({content:M.getGoogleIcon("e86a"),offset:"br",important:!0}),u=(d.hide(),new U.icon({content:M.getGoogleIcon("f090"),offset:"br"}));function g(){var e=new Date;return{light:`rgb(${256-e.getHours()},${256-e.getMinutes()},${256-e.getSeconds()})`,dark:`rgb(${e.getHours()},${e.getMinutes()},${e.getSeconds()})`}}u.hide(),u.getIcon().onclick=function(){window.open(document.querySelector(".bgf img").src)},d.getIcon().onclick=function(){refreshFn.call(this)};e=new P({title:"背景图片/视频显示设置",message:"设置背景图片/视频显示的蒙版和模糊等",type:"null",callback:function(){t.open()}}),We.addNewItem(e),t=new me({title:"背景图片/视频显示设置"}),n=new G({title:"通用",index:0}),f=new P({title:"背景蒙版颜色主题",index:0,type:"select",init:function(){return{0:"跟随主题",1:"黑色",2:"白色"}},get:function(){return B.get("ivsetting").th||1},callback:function(e){var t=B.get("ivsetting");t.th=parseInt(e),B.set("ivsetting",t),b()}}),h=new P({title:"背景蒙版浓度",index:1,type:"range",init:function(){return[0,90]},get:function(){return B.get("ivsetting").mb},callback:function(e){var t=B.get("ivsetting");t.mb=e,B.set("ivsetting",t),b()}}),m=new P({title:"背景模糊",message:"可能会影响性能",type:"boolean",index:2,get:function(){return B.get("ivsetting").isbr},callback:function(e){e?p.show():p.hide();var t=B.get("ivsetting");t.isbr=e,B.set("ivsetting",t),b()}}),p=new P({title:"背景模糊程度",index:3,type:"range",init:function(){return[1,20]},get:function(){return B.get("ivsetting").br},callback:function(e){var t=B.get("ivsetting");t.br=e,B.set("ivsetting",t),b()}}),t.addNewGroup(n),n.addNewItem(f),n.addNewItem(h),n.addNewItem(m),n.addNewItem(p),B.get("ivsetting").isbr||p.hide(),b();var e,t,n,f,h,m,p,{ImgOrVideoSi:v,checkBgCoverStyle:y}={ImgOrVideoSi:e,checkBgCoverStyle:b};function b(){var e,t,n,i;(document.querySelector(".bgf .img-sp")||document.querySelector(".bgf .video-sp"))&&(e=B.get("ivsetting"),(t=document.querySelector("#ivbgse"))||((t=document.createElement("style")).id="ivbgse",document.head.append(t)),i=n="",1==e.th?(i="0,0,0",document.body.classList.add("t-dark")):2==e.th?(i="255,255,255",document.body.classList.remove("t-dark")):0==e.th&&(i=document.body.classList.contains("dark")?(document.body.classList.add("t-dark"),"0,0,0"):(document.body.classList.remove("t-dark"),"255,255,255")),n+=".img-sp .cover,.video-sp .cover{background-color:rgba("+i+","+e.mb/100+")}",e.isbr&&(n+=".img-sp .cover,.video-sp .cover{backdrop-filter:blur("+e.br+"px)}"),t.innerHTML=n)}var k,w,q=null,L={img:function(e,t){e.innerHTML='<div class="img-sp full"><div class="cover"></div><img src="'+t.url+'"/></div>',y(),v.show()},video:function(e,t){e.innerHTML='<div class="video-sp full"><div class="cover"></div><video src="" muted loop></video></div>',M.query(e,".video-sp video").src=t.url,M.query(e,".video-sp video").oncanplay=function(){this.play()},y(),v.show()},color:function(e,t){e.innerHTML='<div class="color-sp full"></div>',M.query(document.head,"style.colorSpControl")||((e=document.createElement("style")).className="colorSpControl",document.head.appendChild(e)),M.query(document.head,"style.colorSpControl").innerHTML=`.color-sp{background-color:${t.light};}body.dark .color-sp{background-color:${t.dark};}`},api:function(t,e){function n(e){d.show(),d.getIcon().classList.add("round-anim"),e.getImg(function(e){d.getIcon().classList.remove("round-anim"),L.img(t,{url:e.url}),e.candownload&&u.show()}),refreshFn=function(){d.getIcon().classList.add("round-anim"),i.getImg(function(e){d.getIcon().classList.remove("round-anim"),L.img(t,{url:e.url}),e.candownload&&u.show()})}}switch(e.api){case"acg":n(i);break;case"fj":n(r);break;case"bing":L.img(t,{url:"https://bing.shangzhenyang.com/api/1080p"}),u.show();break;case"time":q=setInterval(function(){L.color(t,g())},200)}},userbg:function(t,e){var n=B.get("userbg");n&&(document.body.classList.add("t-dark"),"video"==n.type?n.useidb?B.get("upload",!0,function(e){L.video(t,{url:URL.createObjectURL(e)})}):L.video(t,{url:n.url}):"image"==n.type&&(n.useidb?B.get("upload",!0,function(e){L.img(t,{url:URL.createObjectURL(e)})}):L.img(t,{url:n.url})))},zdy:function(e,t){M.query(e,".zdy-sp")||(e.innerHTML='<div class="zdy-sp full"></div>'),M.query(document.head,"style.zdySpControl")||((e=document.createElement("style")).className="zdySpControl",document.head.appendChild(e)),M.query(document.head,"style.zdySpControl").innerHTML=`.zdy-sp{background:${t.light};}body.dark .zdy-sp{background:${t.dark};}`}},{getUserUploadUrl:x,hasUploadedImg:T,iovuploader:I}=(k=new H({content:'<form><h1>上传背景</h1><div class="content"><p>背景类型：<input type="radio" class="uploadi" name="uploadiov" checked="checked"> 图片 <input type="radio" class="uploadv" name="uploadiov"> 视频</p><p>背景URL：<input type="url" placeholder="URL"></p><p>从本地选择文件：<input type="file"></p><p class="tip">URL和文件只需填写一个即可，优先选择本地文件</p></div><div class="footer"><div class="cancel btn">取消</div><button class="ok btn">确定</button></div></form>',class:"iovuploader"}),w=k.getDialogDom(),M.query(w,".cancel").onclick=function(e){e.preventDefault(),k.close()},M.query(w,"form").onsubmit=function(e){e.preventDefault();var e=M.query(w,".uploadi").checked?"image":"video",t=M.query(w,'input[type="url"]').value,n=M.query(w,'input[type="file"]').files[0];M.query(R,".zdy .left img").src="",n?(B.set("upload",n,!0,function(){k.close(),_(function(e){M.query(R,".zdy .left img").src=e}),s({type:"default",data:{type:"userbg"}})}),B.set("userbg",{type:e,useidb:!0})):(B.set("userbg",{type:e,url:t}),k.close(),_(function(e){M.query(o,".zdy .left img").src=e,s({type:"default",data:{type:"userbg"}})})),M.query(o,".noBg").style.display="none",M.query(o,".hasBg").style.display="block",M.query(o,".zdy .editbtn").style.display="block"},{hasUploadedImg:function(){return!!B.get("userbg")},getUserUploadUrl:_,getVideoCaptrue:S,iovuploader:k});function _(t){var e=B.get("userbg");if(e)if("video"==e.type)if(e.useidb)B.get("upload",!0,function(e){S(URL.createObjectURL(e),function(e){t(e)})});else try{S(e.url,function(e){t(e)})}catch(e){t(!1)}else"image"==e.type&&(e.useidb?B.get("upload",!0,function(e){t(URL.createObjectURL(e))}):t(e.url));else t(!1)}function S(e,n){var i=document.createElement("video");i.src=e,i.crossOrigin="anonymous",i.onloadedmetadata=function(){var e=document.createElement("canvas"),t=e.getContext("2d");e.width=i.videoWidth,e.height=i.videoHeight,i.currentTime=i.duration/4,i.oncanplay=function(){t.drawImage(i,0,0,e.width,e.height),n(e.toDataURL("image/png")),this.remove()}}}E=new H({content:'<form><h1>自定义背景颜色</h1><div class="content"><p>浅色模式：<input type="color" class="lightbgcolor"></p><p>深色模式：<input type="color" class="darkbgcolor"></p></div><div class="footer"><div class="cancel btn">取消</div><button class="ok btn">确定</button></div></form>'}),D=E.getDialogDom(),M.query(D,".cancel").onclick=function(e){e.preventDefault(),E.close()},M.query(D,"form").onsubmit=function(e){e.preventDefault();var e=M.query(D,".lightbgcolor").value,t=M.query(D,".darkbgcolor").value;B.set("color",{light:e,dark:t}),M.query(c,".zdy .color-left").style.backgroundColor=e,M.query(c,".zdy .color-right").style.backgroundColor=t,E.close(),s({type:"default",data:{type:"color",light:e,dark:t}})};var E,D,{colorchanger:A,colorchangerf:O}={colorchanger:E,colorchangerf:D};function N(e){M.query(o,".bgitem",!0).forEach(function(e){e.classList.remove("selected")}),M.query(c,".bgitem",!0).forEach(function(e){e.classList.remove("selected")}),"default"==e.type&&("img"==e.data.type?M.query(o,'.neizhi .bgitem[data-img="'+e.data.url+'"]').classList.add("selected"):"userbg"==e.data.type?M.query(o,".zdy .bgitem").classList.add("selected"):"api"==e.data.type?("time"==e.data.api?M.query(c,".api .bgitem"):M.query(o,'.api .bgitem[data-api="'+e.data.api+'"]')).classList.add("selected"):"color"==e.data.type&&M.query(c,".zdy .bgitem").classList.add("selected"))}function C(){document.body.classList.remove("t-dark"),d.hide(),refreshFn=function(){},clearInterval(q),u.hide(),v.hide()}return setTimeout(function(){N(quik.background.getbg()),quik.background.addEventListener("change",N)}),{type:"default",init:function(n){s=n.setbg,o=n.pushBgTab({tab:"图片/视频",content:'<div class="unit-item zdy"><div class="unit-title">自定义</div><div class="unit-content"><div class="bgitem full"><div class="left"><div class="hasBg"><img src="" alt=""></div><div class="noBg"><span class="material-symbols-outlined">&#xf09b;</span></div></div><div class="right"><div class="bg-title">用户自定义背景</div><div class="bg-message">上传任意你喜欢的图片/视频作背景</div></div><div class="editbtn"><div class="btn ok">重新上传</div></div></div></div></div><div class="unit-item neizhi"><div class="unit-title">内置</div><div class="unit-content"></div></div><div class="unit-item api"><div class="unit-title">API</div><div class="unit-content"><div class="bgitem half" data-api="bing"><div class="left"><img data-src="https://bing.shangzhenyang.com/api/1080p" alt="" loading="lazy"></div><div class="right"><div class="bg-title">必应壁纸</div><div class="bg-message">获取必应首页的壁纸作为背景</div></div></div><div class="bgitem half" data-api="acg"><div class="left"><img data-src="https://www.loliapi.com/acg/" alt="" loading="lazy"></div><div class="right"><div class="bg-title">随机二次元壁纸</div><div class="bg-message">获取随机二次元壁纸作为背景，背景提供：loliapi.com</div></div></div><div class="bgitem half" data-api="fj"><div class="left"><img data-src="https://api.gumengya.com/Api/FjImg?format=image" alt="" loading="lazy"></div><div class="right"><div class="bg-title">随机风景壁纸</div><div class="bg-message">获取随机风景壁纸作为背景，背景提供：imgapi.cn</div></div></div></div></div><div class="unit-item se"><div class="u-se"><p>背景图片显示设置</p><p class="material-symbols-outlined">&#xe5cc;</p></div></div>'}),T()?(M.query(o,".noBg").style.display="none",x(function(e){M.query(o,".zdy .left img").src=e})):(M.query(o,".hasBg").style.display="none",M.query(o,".zdy .editbtn").style.display="none"),M.query(o,".zdy .left").addEventListener("click",function(){T()?n.setbg({type:n.type,data:{type:"userbg"}}):I.open()}),M.query(o,".zdy .editbtn").addEventListener("click",function(){I.open();var e=B.get("userbg");e&&(M.query(iovuploaderf,'input[type="url"]').value=e.url,"image"==e.type?M.query(iovuploaderf,".uploadi").checked=!0:M.query(iovuploaderf,".uploadv").checked=!0)});var i=M.query(o,".neizhi .unit-content");l.forEach(function(e){var t=M.element("div",{class:"bgitem def","data-img":e.img});t.innerHTML='<div class="left"><img data-src="'+e.thumbnail+'" loading="lazy"/></div>',i.appendChild(t),M.query(t,".left").onclick=function(){n.setbg({type:n.type,data:{type:"img",url:t.getAttribute("data-img")}})}});M.query(o,".u-se").onclick=function(){v.callback()},M.query(o,".api.unit-item .left",!0).forEach(function(e){e.addEventListener("click",function(){n.setbg({type:n.type,data:{type:"api",api:e.parentElement.getAttribute("data-api")}})})}),c=n.pushBgTab({tab:"纯色",content:'<div class="unit-item zdy"><div class="unit-title">自定义颜色</div><div class="unit-content"><div class="bgitem full"><div class="left"><div class="color-left color"></div><div class="color-right color"></div></div><div class="right"><div class="bg-title">自定义纯色背景</div><div class="bg-message">将你喜欢的颜色做背景，分亮色和暗色（你也可以都设一个颜色或反着来，但不建议这么做）</div></div><div class="editbtn"><div class="btn ok">编辑</div></div></div></div></div><div class="unit-item api"><div class="unit-title">API</div><div class="unit-content"><div class="bgitem full" data-api="time"><div class="left"><div class="color-left color"></div><div class="color-right color"></div></div><div class="right"><div class="bg-title">时间的颜色</div><div class="bg-message">如果当前时间为12:34:56，那么时间的颜色就是rgb(12,34,56)，在亮色模式下就是rgb(255-12,255-34,255-56)</div></div></div></div></div>'});var e=B.get("usercolor"),e=(M.query(c,".zdy .color-left").style.backgroundColor=e.light,M.query(c,".zdy .color-right").style.backgroundColor=e.dark,M.query(c,".zdy .left").onclick=function(){var e=B.get("usercolor");n.setbg({type:n.type,data:{type:"color",light:e.light,dark:e.dark}})},M.query(c,".zdy .btn").onclick=function(){var e=B.get("usercolor");M.query(O,".lightbgcolor").value=e.light,M.query(O,".darkbgcolor").value=e.dark,A.open()},g()),e=(M.query(c,".api .color-left").style.backgroundColor=e.light,M.query(c,".api .color-right").style.backgroundColor=e.dark,M.query(c,".api .left").onclick=function(){n.setbg({type:n.type,data:{type:"api",api:this.parentElement.getAttribute("data-api")}})},a=n.pushBgTab({tab:"自定义",content:'<p>浅色模式：</p><br><textarea class="gjzdytlight textarea"></textarea><p>深色模式：</p><br><textarea class="gjzdytdark textarea"></textarea> <button class="gjzdysetbtn">设置</button><p class="tip">参见 <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/background" target="_blank">CSS | background属性</a></p>'}),B.get("custombglight")),t=B.get("custombgdark");M.query(a,".gjzdytlight").value=e||"",M.query(a,".gjzdytdark").value=t||"",M.query(a,".gjzdysetbtn").onclick=function(){B.set("custombglight",M.query(a,".gjzdytlight").value),B.set("custombgdark",M.query(a,".gjzdytdark").value),n.setbg({type:n.type,data:{type:"zdy",dark:M.query(a,".gjzdytdark").value,light:M.query(a,".gjzdytlight").value}}),quik.toast.show("设置成功")}},cancel:function(e){e.bgf.innerHTML="",C()},draw:function(e){var t=e.bgf,e=e.data;C(),L[e.type](t,e)}}}(),x=[T],ot(T),tt=et=null,st(B.get("bg")),it("0"),ne.pushMenu({icon:M.getGoogleIcon("e1bc"),title:"背景设置",click:function(){Xe.open()}},ne.MAIN_MENU_TOP);var We,Ke,Qe,B,Ye,Xe,R,Ve,Ze,x,et,tt,T={pushBgDrawer:function(e){var t=e.session;try{if(!M.checkSession(t))throw"session error"}catch(e){throw new Error("背景Drawer注册失败，Session校验错误。")}return t="bgdrawer-"+M.getRandomHashCache(),e.id=t,x.push(e),ot(e),e=e,et&&e.type==et.type&&x[i].draw({bgf:Qe,data:et.data}),t},getbg:function(){return B.get("bg")},setbg:ct,addEventListener:e,removeEventListener:Tt};function nt(e){var t=e.tab,n=M.element("div",{class:"tabitem","data-tab":Ye.toString()}),t=(Ve.appendChild(n),n.innerHTML=t,n.onclick=function(){it(this.getAttribute("data-tab"))},M.element("div",{class:"scrollitem","data-tab":Ye.toString()}));return Ze.appendChild(t),t.innerHTML=e.content,Ye++,t}function it(e){M.query(R,".tabitem",!0).forEach(function(e){e.classList.remove("active")}),M.query(R,".scrollitem",!0).forEach(function(e){e.style.display=""}),M.query(R,'.tabitem[data-tab="'+e+'"]').classList.add("active"),M.query(R,'.scrollitem[data-tab="'+e+'"]').style.display="block"}function ot(e){e.init({bgf:Qe,pushBgTab:nt,setbg:ct,type:e.type})}function st(e){for(var t=0;t<x.length;t++)if(e.type==x[t].type)return tt&&tt.type!=x[t].type&&(tt.cancel({bgf:Qe}),tt=x[t]),void x[t].draw({bgf:Qe,data:e.data});et=e}function ct(e){B.set("bg",e),st(e),Ke("change",[e])}(function(){var e,n=new H({content:'<div class="actionbar"><h1>自定义搜索引擎</h1><div class="closeBtn">{{close}}</div></div><div class="searchlist"></div><div class="footer"><button class="cancel btn">取消</button> <button class="ok btn">确定</button></div>'.replace("{{close}}",M.getGoogleIcon("e5cd")),mobileShowtype:H.SHOW_TYPE_FULLSCREEN,class:"search_editor"}),i=n.getDialogDom(),o=(M.query(i,".closeBtn").onclick=M.query(i,".cancel.btn").onclick=function(){n.close()},M.query(i,".ok.btn").onclick=M.query(i,".cancel.btn").onclick=function(){var t={};M.query(i,".searchlist .item",!0).forEach(function(e){t[e.dataset.k]=e.querySelector(".url input").value}),(o=t)[ve.getSearchTypeIndex()]||ve.setSearchType("bing"),ve.setSearchList(o),n.close(),r.show("设置成功")},ve.getSearchTypeList()),t="";for(e in o)t+='<div class="item" data-k="'+e+'"><div class="icon"><img/></div><div class="url"><input value="'+o[e]+'"/></div><div class="remove">'+M.getGoogleIcon("e5cd")+"</div></div>";function s(t){M.getFavicon(o[t.getAttribute("data-k")],function(e){M.query(t,".icon img").src=e||M.createIcon("s")}),M.query(t,".url input").oninput=function(){if("bing"==this.parentElement.parentElement.dataset.k)this.value=o.bing,r.show("该项只读");else try{var t=this.parentElement.parentElement.querySelector(".icon img");M.getFavicon(this.value,function(e){t.src=e||M.createIcon("s")})}catch(e){}},M.query(t,".remove").onclick=function(){"bing"==this.parentElement.dataset.k?(this.value=o.bing,r.show("该项不可删除")):this.parentElement.remove()}}t+=`<div class="addnewitem">${M.getGoogleIcon("e145")} 添加新的搜索引擎</div>`,M.query(i,".searchlist").innerHTML=t,M.query(i,".searchlist .item",!0).forEach(function(e){s(e)}),M.query(i,".searchlist .addnewitem").onclick=function(){var e=M.element("div",{class:"item","data-k":"user_"+Date.now().toString().slice(3)});e.innerHTML='<div class="icon"><img src="https://cn.bing.com/favicon.ico"/></div><div class="url"><input value="https://cn.bing.com/search?q=%keyword%"/></div><div class="remove">'+M.getGoogleIcon("e5cd")+"</div>",M.query(i,".searchlist").insertBefore(e,M.query(i,".searchlist .addnewitem")),s(e)};var c=new P({title:"自定义搜索引擎",index:2,type:"null",message:"",callback:function(e){n.open()}});ve.sg.addNewItem(c)})();at=document.querySelector(".notice-con"),rt=document.querySelector(".no-notice-tip"),lt='<div class="notice-actionbar"><div class="notice-title"></div><div class="notice-close-btn">{{close-btn}}</div></div><div class="notice-content"></div><div class="notice-progress"><div class="p"><div></div></div></div><div class="notice-btns"></div>',dt=document.querySelector(".focus-notice"),ht.prototype={show:function(e){rt.classList.remove("show"),gt.getIcon().classList.add("notice-hasnew-icon"),clearTimeout(this._timeouthide),this.el.classList.add("show"),this.el.addEventListener("click",function(e){e.stopPropagation()});var t=this;this.el.style.display="block",this.el.style.animation="noticein .3s",e&&setTimeout(function(){t.hide()},e)},hide:function(){this.el.classList.remove("show"),document.querySelector(".notice-con .notice-item.show")||(rt.classList.add("show"),gt.getIcon().classList.remove("notice-hasnew-icon")),this.el.style.animation="noticeout .3s";var e=this;this._timeouthide=setTimeout(function(){e.el.style.display="none"},300)},focus:function(){var e;this.show(),e=this,I.push(e),1==I.length&&function e(){var t=I[0];var n=t.el.cloneNode(!0);dt.appendChild(n);M.query(n,".notice-close-btn").onclick=function(){clearTimeout(ut),n.remove(),t.hide(),I.shift(),0<I.length&&e()};vt({el:n,btns:t.btns,hide:function(){t.hide(),clearTimeout(ut),n.remove()},show:function(){}});ut=setTimeout(function(){n.remove(),I.shift(),0<I.length&&e()},3e3)}()},destory:function(){this.hide();var e=this;setTimeout(function(){e.el.remove()},300)},setTitle:function(e){this.title=e,mt(this)},setContent:function(e){this.content=e,pt(this)},setBtn:function(e){this.btns=e,vt(this)},setProgress:function(e){!this.useprogress||1<e||e<0||(this.progress=e,yt(this))}},I=[],gt=new U.icon({content:M.getGoogleIcon("e7f4"),offset:"tl"}),window.addEventListener("resize",bt),gt.getIcon().addEventListener("click",function(){document.querySelector(".notice-sc").classList.add("show")}),document.querySelector(".notice-sc").addEventListener("click",function(){this.classList.remove("show")}),bt();var at,rt,lt,dt,ut,I,gt,ft=ht;function ht(e){var t;this.el=M.element("div",{class:"notice-item"}),at.appendChild(this.el),this.title=e.title,this.content=e.content,this.btns=e.btns||[],this.useprogress=e.useprogress,this.progress=0,(t=this).el.innerHTML=lt.replace("{{close-btn}}",M.getGoogleIcon("e5cd")),M.query(t.el,".notice-close-btn").onclick=function(){t.hide()},mt(t),pt(t),vt(t),yt(t)}function mt(e){M.query(e.el,".notice-title").innerHTML=e.title}function pt(e){M.query(e.el,".notice-content").innerHTML=e.content}function vt(e){var t=M.query(e.el,".notice-btns");t.innerHTML="";for(var n=0;n<e.btns.length;n++){var i=e.btns[n],o=M.element("div",{class:"btn"+(i.style?" "+i.style:"")});o.innerText=i.text,o.onclick=function(){i.click(e)},t.appendChild(o)}}function yt(e){e.useprogress?M.query(e.el,".notice-progress .p div").style.width=100*e.progress+"%":M.query(e.el,".notice-progress").style.display="none"}function bt(){600<window.innerWidth?gt.hide():gt.show()}e=z(),Tt=e.addEventListener,Dt=e.removeEventListener,S=e.doevent,E=p("theme",{sync:!0}),kt=null,E.get("theme")||E.set("theme","a"),wt=new P({index:0,title:"主题颜色",type:"select",message:"",get:function(){return E.get("theme")},callback:function(e){E.set("theme",e),Lt(e)},init:function(){return{a:"浅色",b:"深色",c:"跟随时间",d:"跟随系统"}}}),pe.addNewItem(wt),qt=3,Lt(E.get("theme"));var S,E,kt,wt,qt,e={setTheme:function(e){E.set("theme",e),Lt(e),wt.reGet()},addEventListener:Tt,removeEventListener:Dt,getTheme:function(){return kt}};function Lt(e){3!=qt&&(qt=!1),"b"==e?(document.body.classList.add("dark"),S("change",["dark"]),kt="dark"):"a"==e?(document.body.classList.remove("dark"),S("change",["light"]),kt="light"):"c"==e?kt=18<=(new Date).getHours()||(new Date).getHours()<6?(document.body.classList.add("dark"),S("change",["dark"]),"dark"):(document.body.classList.remove("dark"),S("change",["light"]),"light"):"d"==e&&(window.matchMedia?3==qt?(qt=!0,e=window.matchMedia("(prefers-color-scheme: dark)"),console.log(e),e.matches?document.body.classList.add("dark"):document.body.classList.remove("dark"),e.addEventListener("change",e=>{kt=e.matches?(document.body.classList.add("dark"),S("change",["dark"]),"dark"):(document.body.classList.remove("dark"),S("change",["light"]),"light")})):qt=!0:r("你的浏览器不支持此功能"))}var xt,Tt=function(){var o,s,c,a,{}=z(),r=(s={GET_CODE_FAILED:-1,GET_MANIFEST_FAILED:-2,NO_DB_SUPPORT:-3,MANIFEST_ERROR:-4,NO_ADDON_FOUND:-5,NO_UPDATE_SUPPORT:-6},c=p("addon",{sync:!0}),a=p("addonscript"),{installByOfficialMarket:async function(t,e){var n,i,e=e.progress||function(){};if(!p.checkIDB())throw new Error(JSON.stringify({msg:"浏览器不支持IndexedDB",code:s.NO_DB_SUPPORT}));if(e({progress:0,message:"加载插件市场数据..."}),o||await f(),o[t])return e({progress:.1,message:"获取插件数据..."}),{data:i,code:n}=await u(o[t].url),e({progress:.55,message:"安装插件..."}),i=await g(i,n,function(e){e.marketId=t}),e({progress:1,message:"安装完成"}),{msg:"OK",code:0,data:{id:i,marketId:t}};throw new Error(JSON.stringify({msg:"插件未找到",code:s.NO_ADDON_FOUND}))},installByUrl:async function(e,t){if(t=t.progress||function(){},!p.checkIDB())throw new Error(JSON.stringify({msg:"浏览器不支持IndexedDB",code:s.NO_DB_SUPPORT}));t({progress:.2,message:"加载插件数据..."});var{data:e,code:n}=await u(e),e=(t({progress:.65,message:"安装插件..."}),await g(e,n));return t({progress:1,message:"安装完成"}),{msg:"OK",code:0,data:{id:e}}},installByLocal:async function(e,t,n){if(n=n.progress||function(){},p.checkIDB())return n({progress:.5,message:"安装插件..."}),t=g({name:t,type:"local"},e),n({progress:1,message:"安装完成"}),{msg:"OK",code:0,data:{id:t}};throw new Error(JSON.stringify({msg:"浏览器不支持IndexedDB",code:s.NO_DB_SUPPORT}))},installByDev:async function(e){var t=M.getRandomHashCache();return c.set(t,{name:"DEVPORT:"+e,url:e,type:"dev"}),{msg:"OK",code:0,data:{id:t}}},uninstall:async function(t){if(c.get(t))return c.remove(t),await new Promise(e=>a.remove(t,!0,e)),{msg:"OK",code:0,data:{id:t}};throw new Error(JSON.stringify({msg:"插件未安装",code:s.NO_ADDON_FOUND}))},runAddon:async function(t){var e="dev"==(e=c.get(t)).type?await l(e.url+"index.js"):await new Promise(e=>a.get(t,!0,e)),n=document.createElement("script");n.innerHTML=`(function(){
      function Session(id){
        this.id="ext_"+id;
        this.session_token="Hvm_session_token_eoi1j2j";
        this.isSession=true;
      };
      var addonData={
        session:new Session('${t}')
      };
      (function(){
        ${e}
      })();
    })()`,document.body.appendChild(n)},checkAddonUpdate:async function(t){var n,e=c.get(t);if(!e)throw new Error(JSON.stringify({msg:"插件未安装",code:s.NO_ADDON_FOUND}));if(e.type)throw new Error(JSON.stringify({msg:"本地和开发端口插件不支持升级",code:s.NO_UPDATE_SUPPORT,data:{id:t}}));try{var i=await fetch(url+"manifest.json")}catch(e){throw new Error(JSON.stringify({msg:"获取插件manifest失败",code:s.GET_MANIFEST_FAILED,err:e}))}try{var o=await i.json()}catch(e){throw new Error(JSON.stringify({msg:"插件manifest格式错误",code:s.MANIFEST_ERROR,err:e}))}if(e.version&&o.version!=e.version){if(!o.main)throw new Error(JSON.stringify({msg:"插件manifest格式错误",code:s.MANIFEST_ERROR,err:"manifest.main 缺失"}));try{n=await l(o.main)}catch(e){throw new Error(JSON.stringify({msg:"获取插件代码失败",code:s.GET_CODE_FAILED,err:e}))}return o.rootPath=url,o.id=t,e.marketId&&(o.marketId=e.marketId),c.set(t,o),await new Promise(e=>a.set(t,n,!0,e)),{msg:"OK",code:0,data:{id:t,oldversion:e.version,newversion:o.version}}}return{msg:"插件已最新",code:1,data:{id:t}}},checkMarket:async function(e,t){return o||await f(),o[e].url==t},getAddonByUrl:d,getAddonBySessionId:function(e){return c.get(e)},getAddonList:function(){return c.list()}});async function l(e){return(await fetch(e)).text()}function d(e){var t,n=c.getAll();for(t in n)if(n[t].rootPath==e)return n[t]}async function u(e,t=!1){if(!t){t=d(e);if(t)return{msg:"OK",code:0,data:{id:t.id}}}e.endsWith("/")||(e+="/");try{var n=await fetch(e+"manifest.json")}catch(e){throw new Error(JSON.stringify({msg:"获取插件manifest失败",code:s.GET_MANIFEST_FAILED,err:e}))}try{var i=await n.json()}catch(e){throw new Error(JSON.stringify({msg:"插件manifest格式错误",code:s.MANIFEST_ERROR,err:e}))}var o;if(!i.main)throw new Error(JSON.stringify({msg:"插件manifest格式错误",code:s.MANIFEST_ERROR,err:"manifest.main 缺失"}));try{o=await l(i.main)}catch(e){throw new Error(JSON.stringify({msg:"获取插件代码失败",code:s.GET_CODE_FAILED,err:e}))}return i.rootPath=e,{data:i,code:o}}async function g(e,t,n){var i=M.getRandomHashCache();return await new Promise(function(e){a.set(i,t,!0,e)}),e.id=i,n&&n(e),c.set(i,e),i}async function f(){o={"000":{name:"插件名称",version:"1.0.0",description:"插件描述",author:"作者",icon:"插件图标",url:"插件下载链接"}}}var e=new H({content:'<div class="addon-bar"><h1>插件管理</h1><div class="r"><div class="add-btn">{{add-btn}}</div><div class="closeBtn">{{close-btn}}</div></div></div><ul class="addon-root"></ul>'.replace("{{close-btn}}",M.getGoogleIcon("e5cd")).replace("{{add-btn}}",M.getGoogleIcon("e145")),mobileShowtype:H.SHOW_TYPE_FULLSCREEN,class:"addon-dialog"}),t=e.getDialogDom(),n=(M.query(t,".closeBtn").addEventListener("click",()=>{e.close()}),new V({list:[{icon:M.getGoogleIcon("f1cc"),title:"从插件市场添加插件",click:function(){}},{icon:M.getGoogleIcon("e157"),title:"从第三方链接添加插件",click:function(){_t("请输入插件链接",function(t){var n;return!!t&&((n=new ft({title:"正在安装插件",content:"链接："+t+"\n",useprogress:!0,progress:0})).show(),r.installByUrl(t,{progress:function(e){n.setContent("链接："+t+"\n"+e.message),n.setProgress(e.progress)}}).then(function(e){n.destory(),D("安装成功"),console.log(e)}).catch(function(e){n.destory(),console.dir(e),D("安装失败，"+e.msg)}),!0)})}},{icon:M.getGoogleIcon("e66d"),title:"从第三方文件添加插件",click:function(){O().then(function(e){var e=e[0],t=e.name,n=new FileReader,i=new ft({title:"正在安装插件",content:"from：本地文件\n解析中...",useprogress:!0,progress:0});i.show(),n.onload=function(){r.installByLocal(n.result,t,{progress:function(e){i.setContent("from：本地文件\n"+e.message),i.setProgress(e.progress)}}).then(function(e){i.destory(),D("安装成功"),console.log(e)}).catch(function(e){i.destory(),console.dir(e),D("安装失败，"+JSON.parse(e.message).msg)})},n.readAsText(e)})}},{icon:M.getGoogleIcon("e86f"),title:"添加开发者端口",click:function(){_t("请输入开发者端口链接",function(e){return!!e&&(r.installByDev(e).then(function(e){D("安装成功"),console.log(e)}).catch(function(e){console.error(e),D("安装失败，"+JSON.parse(e.message).msg)}),!0)})}}],offset:{top:0,left:0}}));return M.query(t,".add-btn").addEventListener("click",function(e){e.stopPropagation();e=this.getBoundingClientRect();n.setOffset({top:e.top+e.height,right:window.innerWidth-e.left-e.width}),n.show()}),new U.icon({offset:"tr",content:M.getGoogleIcon("e87b",{type:"fill"})}).getIcon().onclick=function(){e.open()},r.getAddonList().forEach(function(e){r.runAddon(e)}),r}();xt='<div class="def_dialog"><h1>提示</h1><div class="content">$0</div><div class="footer">$1<button class="ok btn">确定</button></div></div>';let{alert:D,confirm:It,prompt:_t}={alert:function(e,t){t=t||St;var n=new H({content:xt.replace("$0","").replace("$1","")}),i=(setTimeout(function(){n.open()},10),n.getDialogDom());M.query(i,".content").innerText=e,M.query(i,".ok").onclick=function(){t(),n.close(),setTimeout(function(){n.destory()},299)}},confirm:function(e,t){t=t||St;var n=new H({content:xt.replace("$0","").replace("$1",'<button class="cancel btn">取消</button>')}),i=(setTimeout(function(){n.open()},10),n.getDialogDom());M.query(i,".content").innerText=e,M.query(i,".ok").onclick=function(){t(!0),n.close(),setTimeout(function(){n.destory()},299)},M.query(i,".cancel").onclick=function(){t(!1),n.close(),setTimeout(function(){n.destory()},299)}},prompt:function(e,t){t=t||St;var n=new H({content:xt.replace("$0",'<p class="c"></p><p><input type="text"/></p>').replace("$1",'<button class="cancel btn">取消</button>')}),i=(setTimeout(function(){n.open()},10),n.getDialogDom());M.query(i,".content .c").innerText=e,M.query(i,".ok").onclick=function(){t(M.query(i,".content input").value),n.close(),setTimeout(function(){n.destory()},299)},M.query(i,".cancel").onclick=function(){t(""),n.close(),setTimeout(function(){n.destory()},299)}}};function St(){}Et=M.query(document,".cards"),At.prototype={show:function(e){var t=this;this.el.style.display="block",e&&0<e&&(this.el.style.transition="all "+e+"ms",this.el.offsetHeight,setTimeout(function(){t.el.style.transition="none"},e)),this.el.style.opacity="1"},hide:function(e){var t=this;e&&0<e?(this.el.style.transition="all "+e+"ms",setTimeout(function(){t.el.style.transition="none",t.el.style.display="none"},e)):this.el.style.display="none",this.el.style.opacity="0"},destory:function(){this.el.remove()},getCardDom:function(){return this.el},getOffset:function(){return this.offset},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(e){this.width=e,this.el.style.width=e+"px"},setHeight:function(e){this.el.style.height=e+"px"},setOffset:function(e,t){var n=this;this.offset=e,t&&0<t&&(this.el.style.transition="all "+t+"ms",setTimeout(function(){n.el.style.transition="none"},t)),this.el.style.top="auto",this.el.style.left="auto",this.el.style.bottom="auto",this.el.style.right="auto","number"==typeof e.top?this.el.style.top=e.top+"px":"number"==typeof e.bottom&&(this.el.style.bottom=e.bottom+"px"),"number"==typeof e.left?this.el.style.left=e.left+"px":"number"==typeof e.right&&(this.el.style.right=e.right+"px")}};var Et,Dt=At;function At(e){this.width=e.width,this.height=e.height,this.offset=e.offset;var t=M.element("div",{class:"card"});t.innerHTML=e.content,t.style.width=e.width+"px",t.style.height=e.height+"px",e.class&&t.classList.add(e.class),e.offset&&("number"==typeof e.offset.top?t.style.top=e.offset.top+"px":"number"==typeof e.offset.bottom&&(t.style.bottom=e.offset.bottom+"px"),"number"==typeof e.offset.left?t.style.left=e.offset.left+"px":"number"==typeof e.offset.right&&(t.style.right=e.offset.right+"px")),this.el=t,Et.appendChild(t)}var Ot,A,Nt,Ct,Mt,Ut,Ht,Gt,Pt,Bt,Rt,jt,zt,$t=function(){var{getJSON:e,setJSON:t}={getJSON:async function(e){for(var t=W(),n=K(),i={},o=0;o<e.length;o++){var s=e[o];if(t[s]){i[s]={title:t[s].title||s,desc:t[s].desc||"",addon:t[s].addon,data:null};try{t[s]&&t[s].sync&&(t[s].get?(console.log("t"),i[s].data=await t[s].get()):(console.log("d"),i[s].data=await async function(e){var t,n={};for(t in e)if("string"==typeof e[t]&&"^"==e[t][0]){var i={"^_t":"db","^_k":e[t],"^_d":await localforage.getItem(e[t])};try{JSON.stringify(i),n[t]=i}catch(e){console.warn("非json支持格式存储不同步")}}else n[t]=e[t];return n}(n[s])))}catch(e){throw console.trace(),new Error("在获取 "+s+" 时遇到错误",e)}}else console.warn(s+" 存储区域不存在")}return i},setJSON:async function(e,t){var n,i=W(),o=K();for(n in e)if(t[n])if(i[n]){if("rewrite"==t[n])if("function"==typeof i[n].rewrite)await i[n].rewrite(o,n,e[n].data);else{s=r=a=c=void 0;var s,c=o,a=n,r=e[n].data;for(s in r)if("db"==r[s]["^_t"]&&r[s]["^_k"]){if(!quik.storage.checkIDB())throw new Error("Your browser is not support indexedDB,Please update your browser.");await localforage.setItem(r[s]["^_k"],r[s]["^_d"]),c[a][s]=r[s]["^_k"]}else c[a][s]=r[s];await 0}else if("compare"==t[n]){if("function"!=typeof i[n].compare)throw new Error(n+" 不支持compare");await i[n].compare(o,n,e[n].data)}}else e[n].addon?console.warn(n+" 存储区域不存在，但提示需先安装插件，插件URL: "+e[n].addon):console.warn(n+" 存储区域不存在");localStorage.quik2=JSON.stringify(o),D("数据导入成功，请重新加载页面",function(){location.reload()})}},n=new G({title:"数据",index:4}),i=new P({title:"导出数据",message:"导出数据到文件",type:"null",callback:function(){c.open();var e,t,n,i=W();for(e in i)i[e]&&i[e].sync&&(t=i[e],(n=document.createElement("div")).classList.add("item"),n.innerHTML=`<input type="checkbox"/><div class="message">
          <div class="title">${t.title||e}</div>
          <div class="desc">${t.desc||""}</div>
        </div>`,n.dataset.key=e,M.query(a,".exportslist").appendChild(n),M.query(n,"input").checked=!0)}}),o=new P({title:"导入数据",message:"从文件导入数据",type:"null",callback:function(){O().then(function(e){e=e[0];if(e)try{var t=new FileReader;t.onload=function(e){for(var t in s=JSON.parse(e.target.result),r.open(),s){var n=jl[t],i=document.createElement("div");i.classList.add("item"),i.innerHTML=`<input type="checkbox"/><div class="message">
                  <div class="title">${n.title||t}</div>
                  <div class="desc">${n.desc||""}</div>
                </div>`,i.dataset.key=t,M.query(l,".exportslist").appendChild(i),M.query(i,"input").checked=!0}},t.readAsText(e)}catch(e){D("读取文件有误！")}})}}),s=(n.addNewItem(i),n.addNewItem(o),v.addNewGroup(n),null),c=new H({content:`<div class="actionbar">
      <h1>导出数据</h1>
      <div class="closeBtn">${M.getGoogleIcon("e5cd")}</div>
    </div>
    <div class="exportslist">
    </div>
    <div class="btns">
      <div class="btn cancel">取消</div>
      <div class="btn ok">导出</div>
    </div>`,class:"sync-dialog",mobileShowtype:H.SHOW_TYPE_FULLSCREEN}),a=c.getDialogDom();M.query(a,".closeBtn").onclick=M.query(a,".cancel").onclick=function(){c.close()},M.query(a,".ok").onclick=function(){var t=[];M.query(a,".exportslist .item",!0).forEach(function(e){M.query(e,"input").checked&&t.push(e.dataset.key)}),e(t).then(function(e){var t,n;e=JSON.stringify(e),t="quik-2-exportdata.json",(n=document.createElement("a")).href=URL.createObjectURL(new Blob([e],{type:"application/json"})),n.download=t,n.click()}),c.close()};var r=new H({content:`<div class="actionbar">
      <h1>导入数据</h1>
      <div class="closeBtn">${M.getGoogleIcon("e5cd")}</div>
    </div>
    <div class="exportslist">
    </div>
    <div class="btns">
      <div class="btn cancel">取消</div>
      <div class="btn ok">导入</div>
    </div>`,class:"sync-dialog",mobileShowtype:H.SHOW_TYPE_FULLSCREEN}),l=r.getDialogDom();return M.query(l,".closeBtn").onclick=M.query(l,".cancel").onclick=function(){r.close()},{getJSON:e,setJSON:t}}();Ot=p("lite",{sync:!0}),A=new P({index:2,title:"极简模式",message:"隐藏所有图标和链接，点击LOGO显示",type:"boolean",get:function(){return!!Ot.get("lite")},callback:function(e){Ot.set("lite",e),Ft(e)}}),pe.addNewItem(A),document.querySelector("main .center .logo").addEventListener("click",function(){Ot.get("lite")&&(document.body.classList.contains("showall")?document.body.classList.remove("showall"):(document.body.classList.add("showall"),ye.cateWidthShiPei()))}),Ft(Ot.get("lite"));function Ft(e){document.body.classList.remove("showall"),e?document.body.classList.add("lite"):(document.body.classList.remove("lite"),ye.cateWidthShiPei())}function Jt(){zt||(zt=new H({content:`<h1>版本更新</h1><div class="version_item">
<div class="version_item_title">版本号：${window.version.version}</div>
<div class="version_item_update_time">发布时间：${window.version.updateTime}</div>
<div class="version_update">${function(e){for(var t="",n={new:"新增",del:"删除",fix:"修复",change:"修改",thanks:"感谢"},i=0;i<e.length;i++)t+='<div class="update_item"><div class="update_item_tag '+e[i].tag+'"><div>'+n[e[i].tag]+'</div></div><div class="update_item_content">'+e[i].content+"</div></div>";return t}(window.version.log)}</div>
</div><div class="footer"><div class="btn ok">我知道了</div></div>`,class:"update_dialog"}),M.query(zt.getDialogDom(),".btn.ok").onclick=function(){zt.close()}),setTimeout(function(){zt.open()})}A=new G({title:"关于",index:5}),v.addNewGroup(A),Nt=new P({type:"null",title:"关于QUIK起始页",index:1,callback:function(){Ht.open()}}),Ct=new P({type:"null",title:"更新日志",index:2,callback:function(){Bt.open()}}),Mt=new P({type:"null",title:"用户协议和隐私政策",index:3,callback:function(){Rt.open()}}),Ut=new P({type:"null",title:"特别鸣谢",index:4,callback:function(){jt.open()}}),A.addNewItem(Nt),A.addNewItem(Ct),A.addNewItem(Mt),A.addNewItem(Ut),ne.pushMenu({icon:M.getGoogleIcon("e88e"),title:"关于QUIK",click:function(){Ht.open()}},1),Ht=new H({content:'<div class="about-dialog"><div class="close">{{close-btn}}</div><div class="ab-logo"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 456 128"><circle cx="64" cy="64" r="40" stroke="black" stroke-width="3" fill="transparent"/><line x1="74" y1="74" x2="104" y2="104" style="stroke:rgb(0,0,0);stroke-width:3;"/><path d="M148 24L148 68Q148 104 180 104Q212 104 212 68L212 24" style="fill:transparent;stroke:rgb(0,0,0);stroke-width:3;"></path><path d="M276 24L306 24M291 24L291 104M276 104L306 104" style="fill:transparent;stroke:rgb(0,0,0);stroke-width:3;"></path><path d="M384 24L384 104M424 26L384 68M424 102L384 68" style="fill:transparent;stroke:rgb(0,0,0);stroke-width:3;"></path></svg></div><div class="t ver">当前版本: <span></span></div><div class="t intro">介绍: QUIK起始页是由前端爱好者<a href="https://siquan001.github.io/?ref=quik" target="_blank">陈思全</a>编写的一个简洁、实用的浏览器主页</div><div class="t license">版权声明: 本项目以GPL 3.0协议声明，版权归原作者所有。</div><div class="t thanks">感谢这些项目或可爱的人为QUIK起始页提供的支持: <a href="javascript:;">点击查看</a></div><div class="t feedback">反馈: chensiquan2023@qq.com</div></div>'.replace("{{close-btn}}",M.getGoogleIcon("e5cd")),mobileShowtype:H.SHOW_TYPE_FULLSCREEN}),Gt=Ht.getDialogDom(),M.query(Gt,".close").onclick=function(){Ht.close()},setTimeout(function(){M.query(Gt,".ver span").innerText=window.version.version}),Pt={"1.7.8":{updates:[{tag:"change",content:"UI第一次大优化"},{tag:"thanks",content:"感谢 川上星林 提供的反馈"}],time:"2023/9/24"},"1.7.5":{updates:[{tag:"change",content:"优化UI"},{tag:"new",content:"新增显示效果设置"},{tag:"fix",content:"修复若干问题，优化体验"},{tag:"thanks",content:"感谢 edgebook 提供的反馈"}],time:"2023/9/23"},"1.7.2":{updates:[{tag:"fix",content:"修复一言BUG"},{tag:"fix",content:"修复若干问题，优化体验"}],time:"2023/9/22"},"1.7.1":{updates:[{tag:"new",content:"一言添加今日诗词API"}],time:"2023/9/17"},1.7:{updates:[{tag:"change",content:"更新文档"},{tag:"fix",content:"进一步解决背景相关的BUG"},{tag:"change",content:"切换背景API为故梦API"},{tag:"new",content:"API背景支持下载到本地"},{tag:"new",content:"为休息模式的图片和一言和第一界面底部一言添加来源信息，休息模式的图片来源会显示在左上角，一言的来源在鼠标放在一言上时显示"},{tag:"new",content:"天气支持查看不同的城市（仅中国大陆）"},{tag:"fix",content:"修复若干问题，优化体验"}],time:"2023/9/10"},1.6:{updates:[{tag:"fix",content:"修复背景模糊的BUG"},{tag:"change",content:"底部一言修改方式改为直接点击"},{tag:"new",content:"添加一个彩蛋（我可不会告诉你）"}],time:"2023/9/2"},1.5:{updates:[{tag:"new",content:"添加搜索框内容翻译功能"},{tag:"new",content:"添加搜索框输入=计算"},{tag:"new",content:"天气预报添加空气质量"},{tag:"new",content:"新增问候功能"}],time:"2023/8/29"},"1.3.1":{updates:[{tag:"change",content:"修改QUIK起始页使用的图片相关API"},{tag:"change",content:"修改QUIK起始页使用的热榜相关API"}],time:"2023/8/22"},1.3:{updates:[{tag:"new",content:"添加休息模式(Beta)，Ctrl+Alt+B进入，Ctrl+Q退出，累了就休息一下吧~"},{tag:"change",content:"修改用户协议与隐私政策、新手文档等"}],time:"2023/8/20"},"1.2.1":{updates:[{tag:"fix",content:"修复已知BUG,优化用户体验"}],time:"2023/8/20"},1.2:{updates:[{tag:"new",content:"便笺:支持在第一界面就可以直接添加固定的便签，并在编辑页面添加固定按钮。"},{tag:"new",content:"搜索框:添加一个搜索框仅搜索的设置"},{tag:"new",content:"链接:下方链接可以支持大中小三个样式"},{tag:"new",content:"热点:支持把热点添加到首页"},{tag:"fix",content:"计算器:修复+/-键"}],time:"2023/8/18"},"1.0.1":{updates:[{tag:"fix",content:"修复已知BUG,优化用户体验"}],time:"2023/8/3"},"1.0.0":{updates:[{tag:"new",content:"梦开始的地方~"}],time:"2023/8/1"}},Bt=new H({content:`<div class="actionbar">
      <h1>更新日志</h1>
      <div class="closeBtn">${M.getGoogleIcon("e5cd")}</div>
    </div>
    <div class="version_list"></div>`,mobileShowtype:H.SHOW_TYPE_FULLSCREEN,class:"update_dia"}),Nt=Bt.getDialogDom(),M.query(Nt,".closeBtn").onclick=function(){Bt.close()},M.query(Nt,".version_list").innerHTML=function(){var e,t="";for(e in Pt)t+=function(e,t){for(var n="",i={new:"新增",del:"删除",fix:"修复",change:"修改",thanks:"感谢"},o=t.updates,s=0;s<o.length;s++)n+='<div class="update_item"><div class="update_item_tag '+o[s].tag+'"><div>'+i[o[s].tag]+'</div></div><div class="update_item_content">'+o[s].content+"</div></div>";return'<div class="version_item"><div class="version_item_title">'+e+'</div><div class="version_item_update_time">发布时间：'+t.time+'</div><div class="version_update">'+n+"</div></div>"}(e,Pt[e]);return t}(),Rt=new H({content:` <div class="close">${M.getGoogleIcon("e5cd")}</div><div class="lic-con"><h1>QUIK起始页用户协议与隐私政策</h1><p><b>请务必认真阅读！</b></p><h2>一、QUIK起始页简介</h2><p>QUIK起始页（以下简称本产品）是一个由个人开发者（<a href="https://siquan001.github.io/" target="_blank">陈思全</a>）编写的一个开源免费的纯前端项目，以GPL 3.0 license声明，版权归原作者所有</p><h2>二、用户使用须知</h2><p>1.使用本产品即代表您同意本条款的所有内容。</p><p>2.本产品中一言的“随机一言”功能由Ten·API提供，如若出现有关一言的“随机一言”的内容相关问题，请联系Ten·API，本产品不负责任</p><p>3.本产品中一言的“今日诗词”功能由jinrishici.com提供，如若出现有关一言的“今日诗词”的内容相关问题，请联系jinrishici.com，本产品不负责任</p><p>4.本产品中的搜索联想功能由百度提供，如若出现有关搜索联想的内容相关问题，请联系百度，本产品不负责任</p><p>5.本产品中背景的“必应壁纸”功能由bing.shangzhenyang.com和必应提供，如若出现有关背景的“必应壁纸”的图片内容相关问题，请联系bing.shangzhenyang.com和必应，本产品不负责任</p><p>6.本产品中背景的“随机二次元壁纸”功能由loliapi.com提供，如若出现有关背景的“随机二次元壁纸”的图片内容相关问题，请联系loliapi.com，本产品不负责任</p><p>7.本产品中背景的“随机风景壁纸”功能由api.gumengya.com提供，如若出现有关背景的“随机风景壁纸”的图片内容相关问题，请联系api.gumengya.com，本产品不负责任</p><p>8.本产品的随机背景API均支持下载壁纸，但这些壁纸仅能用做壁纸，禁止商业化使用</p><h2>三、插件使用须知</h2><p>1.本产品提供插件拓展功能，使用本产品的插件拓展功能即代表您知晓并同意本条款的所有内容。</p><p>2.安装官方提供的插件需要您同意插件的用户协议与隐私政策，若与本协议存在出入，以本协议为准</p><p>3.安装来自第三方的不明插件是十分不安全的行为，同时请保证您的设备未被病毒程序感染，<b>否则本产品不能保证您的数据安全和使用安全！</b></p><h2>四、隐私政策</h2><p>1.本产品本身属于纯前端项目，不会收集您的任何信息，您的所有数据都会存在本地</p><p>2.如您安装了插件，插件可能会收集您的一些信息，详见插件的用户协议与隐私政策。</p><p>3.本产品中使用的一些API和站点服务提供者可能会收集您的IP地址、Cookie等信息用于数据分析和安全防护等</p></div>`,mobileShowtype:H.SHOW_TYPE_FULLSCREEN,class:"lic-dialog"}),M.query(Rt.getDialogDom(),".close").onclick=function(){Rt.close()},jt=new H({content:`<div class="close">${M.getGoogleIcon("e5cd")}</div><div class="thank-con"><h1>特别鸣谢</h1><h2>感谢以下项目对QUIK的支持</h2><ul><li><a href="https://github.com/localForage/localForage" target="_blank">localforage</a> - 为indexedDB的管理提供一个方便的类似于localStorage的API</li><li><a href="https://github.com/siquan001/rem/" target="_blank">REM</a> - 简单的模块化工具（我做的）</li></ul><h2>感谢以下服务对QUIK的支持</h2><ul><li><a href="https://loliapi.com/" target="_blank">loliapi</a> - 双端自适应随机二次元图片API提供</li><li><a href="https://api.gumengya.com/" target="_blank">故梦API</a> - 随机风景图片API提供</li><li><a href="https://tenapi.cn/" target="_blank">Ten·API</a> - 随机一言API提供</li><li><a href="https://bing.com/" target="_blank">必应</a> | <a href="https://bing.shangzhenyang.com/" target="_blank">bing.shangzhenyang.com</a> - 每日必应壁纸API提供</li><li><a href="https://jinrishici.com/" target="_blank">jinrishici.com</a> - 随机诗词API提供</li><li><a href="https://baidu.com/" target="_blank">百度</a> - 搜索联想API提供</li><li><a href="https://github.com/" target="_blank">Github</a> - 静态网站托管服务提供</li></ul><h2>感谢以下可爱的人对QUIK的支持</h2><ul><li><a href="https://stear.cn/wm/" target="_blank">川上星林</a></li></ul><p>没有你们，就没有现在的QUIK起始页。</p></div>`,class:"thank-dialog",mobileShowtype:H.SHOW_TYPE_FULLSCREEN}),M.query(jt.getDialogDom(),".close").onclick=function(){jt.close()},window.version_code=14,window.version={version:"2.0.0-dev",version_code:window.version_code,updateTime:"2024/4/13",log:[{tag:"fix",content:"修复BUG"}]},"serviceWorker"in navigator&&!window._dev&&(navigator.serviceWorker.ready.then(function(t){window.swReg=t,quik.util.xhr("./version",function(e){parseInt(e)>version_code&&t.active.postMessage("update")},function(){console.log("获取版本失败")})}),navigator.serviceWorker.addEventListener("message",function(e){"updated"==e.data&&quik.confirm("新版本已准备就绪，是否刷新页面",function(e){e&&(localStorage.setItem("__q__s__","1"),location.reload())})})),zt=null,localStorage.getItem("__q__s__")&&(Jt(),localStorage.removeItem("__q__s__")),window.quik={sync:$t,addon:Tt,storage:p,omnibox:ve,util:M,link:ye,dialog:H,toast:r,says:L,menu:V,iconc:U,background:T,mainmenu:ne,Setting:me,SettingGroup:G,SettingItem:P,mainSetting:v,notice:ft,tyGroup:pe,alert:D,confirm:It,prompt:_t,theme:e,card:Dt},clearTimeout(loadingtimeout),document.querySelector("main").style.display="block",document.querySelector(".loading-f").classList.add("h")}();