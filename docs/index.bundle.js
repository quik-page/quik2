(()=>{function showOpenFilePicker(){return new Promise(((e,t)=>{var i=document.createElement("input");i.type="file",document.body.append(i),i.style.display="none",i.click(),i.onchange=()=>{e(i.files),i.remove()}}))}var onshows_fns=[];function Onshow(e){onshows_fns.push(e)}var getEventHandle=(events=[],function(){var e=events.length;return events.push({}),{on:(t,i)=>(events[e][t]||(events[e][t]=[]),events[e][t].push(i),!0),off(t,i){if(!events[e][t])return!1;for(var n=0;n<events[e][t].length;n++)if(events[e][t][n]===i)return events[e][t].splice(n,1),!0;return!1},doevent(t,i){if(!events[e][t])return!1;Array.isArray(i)||(i=[i]);for(var n=0;n<events[e][t].length;n++)events[e][t][n].apply(null,i);return!0}}}),events,util=(()=>{-1!=location.hash.indexOf("extdheodqp2eidhjwe")?(window.isExt=!0,-1!=location.hash.indexOf(";")?window.extid=location.hash.substring(location.hash.indexOf(":")+1,location.hash.indexOf(";")):window.extid=location.hash.substring(location.hash.indexOf(":")+1,location.hash.length)):window.isExt=!1;var e=[],t=0;return window.addEventListener("message",(function(t){if("xhr_cb"==t.data.type)for(var i=t.data.id,n=0;n<e.length;n++)if(e[n].id==i){"function"==typeof e[n][t.data.fn]&&e[n][t.data.fn](t.data.data),1==t.data.finish&&e.slice(n,1);break}})),{deepClone(e){const t=new WeakMap;function i(e){return"object"==typeof e&&e}return function e(n){if(!i(n))return n;if([Date,RegExp].includes(n.constructor))return new n.constructor(n);const s=t.get(n);if(s)return s;if(n instanceof Map){const s=new Map;return t.set(n,s),n.forEach(((t,n)=>{i(t)?s.set(n,e(t)):s.set(n,t)})),s}if(n instanceof Set){const s=new Set;return t.set(n,s),n.forEach((t=>{i(t)?s.add(e(t)):s.add(t)})),s}const a=Reflect.ownKeys(n),o=Object.getOwnPropertyDescriptors(n),l=Object.create(Object.getPrototypeOf(n),o);return t.set(n,l),a.forEach((t=>{const s=n[t];i(s)?l[t]=e(s):l[t]=s})),l}(e)},requestByExt(i){t++,i.id=t,e.push(i);var n=this.deepClone(i);for(var s in n)"function"==typeof n[s]&&(n[s]={_t:"fn",_n:s});parent.postMessage({type:"xhr",data:n,id:t},"*")},addStyle(e){var t=util.element("style");t.innerHTML=e,document.head.appendChild(t)},initSet(e,t,i){var n=e.get(t);if("object"==typeof i&&i)if("object"==typeof n&&n){var s=!1;for(var a in i)void 0===n[a]&&(s=!0,n[a]=i[a]);s&&e.set(t,n)}else void 0===n&&e.set(t,i);else void 0===n&&e.set(t,i)},joinObj(){var e=arguments,t=e[0];function i(e,t){for(var i in t)e[i]=t[i];return e}for(var n=1;n<e.length;n++)t=i(t,e[n]);return t},loadimg(e,t){var i=new Image;i.src=e,i.onload=function(){t(!0)},i.onerror=function(){t(!1)}},element(e,t={}){var i=document.createElement(e);for(var n in t)i.setAttribute(n,t[n]);return i},query:(e,t,i)=>e["querySelector"+(i?"All":"")](t),getFavicon(e,t){try{var i=new URL(e)}catch(e){return void t(!1)}var n="https://api.iowen.cn/favicon/"+i.host+".png";-1!=i.hostname.indexOf("bing.com")?n="https://bing.com/favicon.ico":-1!=i.hostname.indexOf("www.google.com")||0==i.hostname.indexOf("google.com")?n="https://s2.loli.net/2024/08/10/dVNZ4SzFxTMpj1a.png":(-1!=i.hostname.indexOf("stear.cn")||-1!=i.hostname.indexOf("tfseek.top"))&&(n="https://stear.cn/assets/img/216.png"),this.loadimg(n,(function(e){e?t(n):util.loadimg(i.protocol+"//"+i.host+"/favicon.ico",(function(e){t(!!e&&i.protocol+"//"+i.host+"/favicon.ico")}))}))},createIcon(e){var t=document.createElement("canvas");t.width=64,t.height=64;var i=t.getContext("2d");return i.fillStyle=this.getRandomColor(),i.font="bold 32px Arial",i.fillText(e,20,40),t.toDataURL()},getRandomColor:()=>"#"+Math.random().toString(16).substring(2,8).toUpperCase(),fangdou(e,t){var i=null;return function(){i&&clearTimeout(i);var n=this;i=setTimeout((()=>{e.apply(n,arguments)}),t)}},jsonp(e,t,i){var n="a"+Math.random().toString(36).slice(2),s=this.element("script",{src:function(e,t,i){var n=new URL(e);return n.searchParams.set(t,i),n.href}(e,i||"callback",n)});return document.body.appendChild(s),s.onerror=function(){t(!1),document.body.removeChild(s)},window[n]=function(e){t(e);try{document.body.removeChild(s)}catch(e){}delete window[n]},{abort(){try{s.remove()}catch(e){}}}},xhr(e,t,i){var n=new XMLHttpRequest;return n.onreadystatechange=function(){4==n.readyState&&(200==n.status?t(n.responseText):n.status>=400&&i&&i({status:n.status,statusText:n.statusText,readyState:n.readyState,responseText:n.responseText}))},n.onerror=function(){i&&i({status:n.status,statusText:n.statusText,readyState:n.readyState,responseText:n.responseText})},n.open("GET",e,!0),n.send(),{abort(){n.abort()}}},checkSession:e=>e.isSession&&"Hvm_session_token_eoi1j2j"===e.session_token,getRandomHashCache:()=>Math.random().toString(36).slice(2)+Date.now().toString(36),copyText(e){if(window.isExt)parent.postMessage({type:"copy",text:e},"*");else if(navigator.clipboard)navigator.clipboard.writeText(e);else{const t=document.createElement("input");t.value=e,t.style.display="none",document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}toast.show("复制成功")},getGoogleIcon:(e,t)=>'<span class="material-symbols-outlined'+(t&&t.type?" "+t.type:"")+'">&#x'+e+";</span>",getGoogleIconByString:(e,t)=>'<span class="material-symbols-outlined'+(t&&t.type?" "+t.type:"")+'">'+e+"</span>",checkDetailsCorrect(e,t){for(var i=0;i<t.length;i++)if(0==e.hasOwnProperty(t[i]))return!1;return!0},checkUrl:e=>/^(https?:\/\/)?([a-zA-Z0-9\.\-]+(\:[a-zA-Z0-9\.&%\$\-]+)*@)?((25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9])\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[0-9])|([a-zA-Z0-9\-]+\.)*[a-zA-Z0-9\-]+\.[a-zA-Z]{2,4})(\:[0-9]+)?(\/[^\/][a-zA-Z0-9\.\,\?\'\\\/\+&%\$#\=~_\-@]*)*(\/)?$/.test(e),b0:e=>e<10?"0"+e:e}})(),toast=(to=util.element("div",{class:"toast"}),g=null,g2=null,util.query(document,"body").append(to),{show(e,t){to.innerHTML=e,to.classList.add("show"),to.style.animation="toastin .3s",clearTimeout(g),clearTimeout(g2),g=setTimeout((()=>{to.style.animation="toastout .3s",g2=setTimeout((()=>{to.classList.remove("show")}),298)}),t||2e3)}}),to,g,g2,iconc=(icners={tl:util.query(document,".topper .left"),tr:util.query(document,".topper .right"),bl:util.query(document,".bottomer .left"),br:util.query(document,".bottomer .right")},icon=function(e){this.content=e.content,this.width=e.width;var t=util.element("div",{class:"item"+(e.class?" "+e.class:"")+(e.important?" important":"")});icners[e.offset].append(t),t.innerHTML=this.content,this.element=t,this.width&&(t.style.width=this.width+"px")},icon.prototype={getIcon(){return this.element},setIcon(e){this.content=e,this.element.innerHTML=this.content},setWidth(e){this.width=e,this.width&&(ic.style.width=this.width+"px")},getWidth(){return this.width},show(){this.element.classList.remove("hide"),this.element.classList.add("show")},hide(){this.element.classList.add("hide"),this.element.classList.remove("show")}},{icon:icon}),icners,icon,{storage:storage,getStorageList:getStorageList,getAllStorage:getAllStorage,dbTool:dbTool}=(()=>{localStorage.quik2||(localStorage.quik2="{}");var e=getEventHandle(),t=localforage._getSupportedDrivers([localforage.INDEXEDDB])[0]==localforage.INDEXEDDB;t||localStorage.notdb||(localStorage.notdb="1",setTimeout((()=>{alert("浏览器版本过低，不支持indexedDB，一些功能的使用将受限！")})));var i={get(e,t){localforage.getItem(e).then(t)},set(e,t,i){t=t||"^"+util.getRandomHashCache(),localforage.setItem(t,e).then((()=>{i(t)}))},delete(e,t){localforage.removeItem(e).then(t)}},n={},s=function(s,a){if("string"==typeof s){function o(e,n,a){if(!n)return l()[s][e];if(!t)throw new Error("indexedDB is not support in this browser");i.get(l()[s][e],(e=>{a(e)}))}function l(){return JSON.parse(localStorage.getItem("quik2"))}function r(t){var i=l();i[s]=t,localStorage.setItem("quik2",JSON.stringify(i)),e.doevent("storage",[{key:s,value:t}]),a&&!a.websync&&a.sync&&e.doevent("websync",[{key:s,value:t}])}return JSON.parse(localStorage.getItem("quik2"))[s]||r({}),n[s]=a,{get:o,websync:function(t){e.doevent("websync",[{key:s,value:t,sp:!0}])},set:function(e,n,a,c){if(a){if(!t)throw new Error("indexedDB is not support in this browser");i.set(n,o(e),(t=>{var i=l();i[s][e]=t,r(i[s]),c(t)}))}else{var d=l();d[s][e]=n,r(d[s])}},remove:function(e,n,a){var o=l();if(n){if(!t)throw new Error("indexedDB is not support in this browser");i.delete(o[s][e],(()=>{var t=l();delete t[s][e],r(t[s]),a()}))}else delete o[s][e],r(o[s])},list:function(){return Object.keys(l()[s])},getAll:()=>l()[s],clear(){var e=l()[s];for(var t in e){var n=t[e];"string"==typeof n&&n.startsWith("^")&&i.delete(n)}r({})}}}throw new Error("ck is not a string")};return s.checkIDB=()=>t,s.on=e.on,s.off=e.off,{storage:s,getStorageList:()=>n,getAllStorage:()=>JSON.parse(localStorage.getItem("quik2")),dbTool:i}})(),dialog=(()=>{var e=[],t=1,i=0,n=function(t){this.options=t;var n=util.element("div",{class:"dialog"});n.innerHTML=`<div class="d-b"></div><div class="d-c">${t.content}</div>`,util.query(document,".dialogs").append(n);var a=util.query(n,".d-c");t.class&&a.classList.add(t.class),1==t.mobileShowtype&&n.classList.add("mobile-show-full"),this.element=n,this.id=i,i++,n.setAttribute("data-id",this.id),void 0===t.clickOtherToClose?this.clickOtherToClose=!0:this.clickOtherToClose=t.clickOtherToClose,this.clickOtherToClose&&n.querySelector(".d-b").addEventListener("click",(function(){s(this.parentElement.getAttribute("data-id")).close()})),e.push(this)};function s(t){var i=null;return e.forEach((e=>{e.id==t&&(i=e)})),i}return n.SHOW_TYPE_FULLSCREEN=1,n.SHOW_TYPE_DIALOG=2,n.iframeDialogBuilder=function(e,t=1){var i=new n({content:`<div class="material-symbols-outlined closebtn">&#xE5CD;</div><iframe src="${e}" class="dialog-iframe"></iframe>`,class:"iframe-dialog",mobileShowtype:t}),s=i.getDialogDom();return util.query(s,".closebtn").onclick=()=>{i.close()},this.closed=!0,i},n.getDialogById=s,n.prototype={open(){this.element.classList.add("show"),this.element.style.zIndex=t,t++,this.closed=!1,this.onopen&&this.onopen(),util.query(this.element,"img[data-src]",!0).forEach((function(e){e.src=e.getAttribute("data-src"),e.removeAttribute("data-src")}))},close(){this.element.classList.remove("show"),this.closed=!0,this.onclose&&this.onopen()},destroy(){this.element.remove(),e.splice(e.indexOf(this),1)},getDialogDom(){return util.query(this.element,".d-c")}},n})();let{alert:alert,confirm:confirm,prompt:prompt}=(base='<div class="def_dialog"><h1>提示</h1><div class="content">$0</div><div class="footer">$1<button class="ok btn">确定</button></div></div>',emptyFn=()=>{},{alert:function(e,t){t||(t=emptyFn);var i=new dialog({content:base.replace("$0","").replace("$1",""),clickOtherToClose:!1});setTimeout((()=>{i.open()}),10);var n=i.getDialogDom();util.query(n,".content").innerText=e,util.query(n,".ok").onclick=()=>{t(),i.close(),setTimeout((()=>{i.destroy()}),299)}},confirm:function(e,t){t||(t=emptyFn);var i=new dialog({content:base.replace("$0","").replace("$1",'<button class="cancel btn">取消</button>'),clickOtherToClose:!1});setTimeout((()=>{i.open()}),10);var n=i.getDialogDom();util.query(n,".content").innerText=e,util.query(n,".ok").onclick=()=>{t(!0),i.close(),setTimeout((()=>{i.destroy()}),299)},util.query(n,".cancel").onclick=()=>{t(!1),i.close(),setTimeout((()=>{i.destroy()}),299)}},prompt:function(e,t){t||(t=emptyFn);var i=new dialog({content:base.replace("$0",'<p class="c"></p><p><input type="text"/></p>').replace("$1",'<button class="cancel btn">取消</button>'),clickOtherToClose:!1});setTimeout((()=>{i.open()}),10);var n=i.getDialogDom();util.query(n,".content .c").innerText=e,util.query(n,".ok").onclick=()=>{t(util.query(n,".content input").value),i.close(),setTimeout((()=>{i.destroy()}),299)},util.query(n,".cancel").onclick=()=>{t(""),i.close(),setTimeout((()=>{i.destroy()}),299)},util.query(n,".content input").focus(),util.query(n,".content input").addEventListener("keydown",(function(e){"Enter"==e.key&&(t(this.value),i.close(),setTimeout((()=>{i.destroy()}),299))}))}});var base,emptyFn,menu=(()=>{var e=function(e){this.options=e;var i=util.element("div",{class:"contextMenu"});e.offset&&(i.style.top=e.offset.top+"px",i.style.left=e.offset.left+"px",i.style.bottom=e.offset.bottom+"px",i.style.right=e.offset.right+"px"),t(e.list,i),document.body.appendChild(i),this.element=i};function t(e,t){e.forEach((function(e){if("hr"==e.type){var i=util.element("div",{class:"hr"});t.appendChild(i)}else{(i=util.element("div",{class:"item"})).innerHTML=`<div class="icon">${e.icon}</div><div class="title">${e.title}</div>`,i.onclick=function(){e.click()},t.appendChild(i)}}))}function i(e){document.querySelectorAll(".contextMenu").forEach((t=>{e&&t.isSameNode(e)||(t.style.height="0px",setTimeout((()=>{t.style.transition="none",t.classList.remove("show")}),200))}))}return e.prototype={show(){i(this.element),this.element.classList.add("show"),this.element.style.height="auto";var e=this.element.getBoundingClientRect().height;this.element.style.height="0px",this.element.style.transition="height .2s";var t=this;setTimeout((()=>{t.element.style.height=e+"px"}))},hide(){this.element.style.height="0px";var e=this;setTimeout((()=>{e.element.style.transition="none",e.element.classList.remove("show")}),200)},isShow(){return this.element.classList.contains("show")},destroy(){this.element.remove()},setOffset(e){this.options.offset=e;var t=this.options,i=this.element;i.style.top="",i.style.left="",i.style.bottom="",i.style.right="",t.offset&&("number"==typeof t.offset.top?i.style.top=t.offset.top+"px":i.style.bottom=t.offset.bottom+"px","number"==typeof t.offset.left?i.style.left=t.offset.left+"px":i.style.right=t.offset.right+"px")},setList(e){this.options.list=e;var i=this.element;i.innerHTML="",t(e,i)}},document.addEventListener("click",(()=>{i()})),document.addEventListener("contextmenu",(()=>{i()})),e})(),mainmenu=(()=>{var e=new iconc.icon({class:"main_menu",content:util.getGoogleIcon("e5d2"),offset:"tr"}),t=[],i=[],n=new menu({list:[],offset:{top:40,right:15}});e.getIcon().onclick=e=>{e.stopPropagation(),n.show()};return{pushMenu:function(e,s){1==s?i.push(e):t.push(e),n.setList(t.concat([{type:"hr"}],i))},MAIN_MENU_BOTTOM:1,MAIN_MENU_TOP:0}})(),setting=(()=>{var e,t=storage("setting",{title:"设置",desc:"QUIK起始页的各项设置",sync:!0}),i=(()=>{function e(e){this.title=e.title,this.ifo=!1,this.groups=[],this._events={change:[]}}function t(e,t,n){util.query(e,".qui-options").innerHTML=(()=>{var e="";for(var i in t)e+=`<div class="qui-option" data-value="${i}">${t[i]}</div>`;return e})(),util.query(e,".qui-options .qui-option",!0).forEach((s=>{s.onclick=()=>{var a=s.getAttribute("data-value");util.query(e,".setting-item-input").value=a,util.query(e,".qui-select").innerText=t[a];var o=util.query(e,".qui-options .qui-option.selected");o&&o.classList.remove("selected"),s.classList.add("selected"),i.call(util.query(e,".setting-item-input"),n)}}))}function i(e){var t;this.classList.contains("null-click")||(t="checkbox"==this.type?this.checked:this.value,"function"==typeof e.check?e.check(t)?e.callback(t):getacb():e.callback(t))}return e.prototype={drawAll(){if(!this.ifo){this.ifo=!0,this.dialog=new dialog({content:`<div class="actionbar"><h1>设置</h1><div class="closeBtn">${util.getGoogleIcon("e5cd")}</div></div><ul class="setting-root"></ul>`,class:"setting_dia",mobileShowtype:dialog.SHOW_TYPE_FULLSCREEN}),this.dialogDom=this.dialog.getDialogDom(),util.query(this.dialogDom,".closeBtn").addEventListener("click",(()=>{this.dialog.close()})),util.query(this.dialogDom,".actionbar h1").innerText=this.title;var e=this;this.groups.forEach((t=>{e._drawGroup(t)}))}},addNewGroup(e){this.groups.push(e);var t=this;e.on("change",((e,i)=>{t._dochange({type:e.type,details:e.details,id:e.id}),"it"==e.type?t._dochangeGroup(i,e.details):"add"==e.type?t._drawItem(i,i.items[i.items.length-1]):"change"==e.type&&("reinit"==e.details.attr?t._reinitItem(i,i.items.find((t=>t.id==e.id)),e.details):"reget"==e.details.attr?t._regetItem(i.items.find((t=>t.id==e.id)),e.details):t._dochangeItem(i,i.items.find((t=>t.id==e.id)),e.details))})),t._dochange({type:"addgroup"}),t._drawGroup(e)},setTitle(e){this.title=e,this.ifo&&(util.query(this.dialogDom,".actionbar h1").innerText=e),_._dochange({type:"changetitle",title:e})},open(){var e=this;e.ifo?e.dialog.open():(e.drawAll(),setTimeout((()=>{e.dialog.open()}),10))},close(){this.dialog.close()},on(e,t){this._events[e]&&this._events[e].push(t)},_dochange(e){var t=this;this._events.change.forEach((i=>{i(e,t)}))},_drawGroup(e){if(this.ifo){var t=this,i=util.element("li",{class:"setting-group","data-index":e.index,"data-id":e.id});i.innerHTML='<div class="setting-group-title"></div><ul class="setting-tree"></ul>';for(var n=util.query(this.dialogDom,".setting-root"),s=n.children,a=!0,o=0;o<s.length;o++)if(parseInt(s[o].getAttribute("data-index"))>e.index){n.insertBefore(i,s[o]),a=!1;break}a&&n.appendChild(i),util.query(i,".setting-group-title").innerText=e.title,e.items.forEach((i=>{t._drawItem(e,i)}))}},_drawItem(e,n){if(this.ifo){var s=util.element("li",{class:"setting-item","data-index":n.index,"data-id":n.id});n._show||(s.style.display="none"),s.innerHTML='<div class="setting-item-left"><div class="setting-item-title"></div><div class="setting-item-message"></div></div><div class="setting-item-right"></div>';for(var a=util.query(this.dialogDom,".setting-group[data-id="+e.id+"] .setting-tree"),o=a.children,l=!0,r=0;r<o.length;r++)if(parseInt(o[r].getAttribute("data-index"))>n.index){a.insertBefore(s,o[r]),l=!1;break}l&&a.appendChild(s),util.query(s,".setting-item-title").innerText=n.title,n.message?util.query(s,".setting-item-message").innerText=n.message:s.classList.add("no-message");var c=util.query(s,".setting-item-right"),d=()=>{};({string(){c.innerHTML='<input type="text" class="setting-item-input">',d=e=>{util.query(c,".setting-item-input").value=e}},number(){c.innerHTML='<input type="number" class="setting-item-input">',d=e=>{util.query(c,".setting-item-input").value=e}},boolean(){c.innerHTML='<div class="check-box"><div class="check-box-inner"></div></div><input type="checkbox" class="setting-item-input">',d=e=>{util.query(c,".setting-item-input").checked=e,e?util.query(c,".check-box").classList.add("checked"):util.query(c,".check-box").classList.remove("checked")},util.query(c,".check-box").addEventListener("click",(function(){util.query(c,".setting-item-input").click(),util.query(c,".setting-item-input").checked?this.classList.add("checked"):this.classList.remove("checked")}))},range(){c.innerHTML='<input type="range" class="setting-item-input">',d=e=>{util.query(c,".setting-item-input").value=e};var e=n.init();function t(e){util.query(c,".setting-item-input").max=e[1],util.query(c,".setting-item-input").min=e[0]}e instanceof Promise?e.then(t):t(e)},select(){var e;c.innerHTML='<input class="setting-item-input" type="text" style="display:none"></input><div class="qui-select"></div><div class="qui-options"></div>',util.query(c,".qui-select").onclick=function(e){e.stopPropagation();var t=util.query(document,".qui-options.active");t&&t.classList.remove("active"),util.query(c,".qui-options").classList.add("active")},d=t=>{e=t};var i=n.init();function s(i){t(c,i,n),d=e=>{util.query(c,".setting-item-input").value=e,util.query(c,".qui-select").innerText=i[e];var t=util.query(c,".qui-options .qui-option.selected");t&&t.classList.remove("selected");try{util.query(c,'.qui-options .qui-option[data-value="'+e+'"]').classList.add("selected")}catch(e){util.query(c,".qui-select").innerText=""}},e&&d(e)}i instanceof Promise?i.then(s):s(i)},null(){c.innerHTML=`<div class="setting-item-input null-click">${util.getGoogleIcon("e5e1")}</div>`,s.classList.add("just-callback-item"),s.onclick=()=>{n.callback()}}})[n.type](),u(),n.getacb=u,util.query(c,".setting-item-input").addEventListener("range"==n.type?"input":"null"==n.type?"click":"change",(function(){i.call(this,n)}))}function u(){if("null"!=n.type){var e=n.get();e instanceof Promise?e.then(d):d(e)}}},_dochangeGroup(e,t){if(this.ifo){var i=util.query(this.dialogDom,".setting-group[data-id="+e.id+"]");if("title"==t.attr)util.query(i,".setting-group-title").innerText=t.content;else if("index"==t.attr){i.setAttribute("data-index",t.content);for(var n=util.query(this.dialogDom,".setting-root"),s=n.children,a=!0,o=0;o<s.length;o++)if(!s[o].isSameNode(i)&&parseInt(s[o].getAttribute("data-index"))>t.content){n.insertBefore(i,s[o]),a=!1;break}a&&n.appendChild(i)}else"show"==t.attr&&(i.style.display=t.content?"block":"none")}},_dochangeItem(e,t,i){if(this.ifo){var n=util.query(this.dialogDom,".setting-group[data-id="+e.id+"] .setting-item[data-id="+t.id+"]");if("title"==i.attr)util.query(n,".setting-group-title").innerText=i.content;else if("message"==i.attr)i.content?(util.query(n,".setting-item-message").innerText=i.content,n.classList.remove("no-message")):n.classList.add("no-message");else if("index"==i.attr){n.setAttribute("data-index",i.content);for(var s=util.query(this.dialogDom,".setting-group[data-id="+e.id+"] .setting-tree"),a=s.children,o=!0,l=0;l<a.length;l++)if(!a[l].isSameNode(n)&&parseInt(a[l].getAttribute("data-index"))>i.content){s.insertBefore(n,a[l]),o=!1;break}o&&s.appendChild(n)}else"show"==i.attr&&(n.style.display=i.content?"block":"none")}},_reinitItem(e,i){if(this.ifo){var n,s=util.query(this.dialogDom,".setting-group[data-id="+e.id+"] .setting-item[data-id="+i.id+"]"),a=util.query(s,".setting-item-right");if("range"==i.type)n=e=>{util.query(a,".setting-item-input").max=e[1],util.query(a,".setting-item-input").min=e[0]};else{if("select"!=i.type)return;n=e=>{t(a,e,i),cb=t=>{util.query(a,".setting-item-input").value=t,util.query(a,".qui-select").innerText=e[t];var i=util.query(a,".qui-options .qui-option.selected");i&&i.classList.remove("selected");try{util.query(a,'.qui-options .qui-option[data-value="'+t+'"]').classList.add("selected")}catch(e){}};var n=i.get();n instanceof Promise?n.then(cb):cb(n)}}var o=i.init();o instanceof Promise?o.then(n):n(o)}},_regetItem(e){this.ifo&&e.getacb()}},document.addEventListener("click",(()=>{var e=util.query(document,".qui-options.active");e&&e.classList.remove("active")})),e})(),n=(()=>{var e=0;function t(t){this.title=t.title,this.index=t.index,this.index<0&&(this.index=0),this.items=[],this.id="seg_"+e,e++,this._events={change:[]}}return t.prototype={addNewItem(e){this.items.push(e);var t=this;e.on("change",((e,i)=>{t._dochange({type:"change",details:e,id:i.id})})),t._dochange({type:"add"})},setTitle(e){this.title=e,this._dochange({type:"it",details:{attr:"title",content:e}})},setIndex(e){this.index=e,this._dochange({type:"it",details:{attr:"index",content:e}})},on(e,t){this._events[e]&&this._events[e].push(t)},show(){this.show=!0,this._dochange({type:"it",details:{attr:"show",content:!0}})},hide(){this.show=!1,this._dochange({type:"it",details:{attr:"show",content:!1}})},_dochange(e){var t=this;this._events.change.forEach((i=>{i(e,t)}))}},t})(),s=(()=>{var e=0;function t(t){this.title=t.title,this.index=t.index,this.type=t.type,this.init=t.init,this.check=t.check,this.callback=t.callback,this.message=t.message,this.get=t.get,this._show=!0,this.id="sei_"+e,e++,this._events={change:[]}}return t.prototype={reInit(){this._dochange({attr:"reinit"})},reGet(){this._dochange({attr:"reget"})},setTitle(e){this.title=e,this._dochange({attr:"title",content:e})},setIndex(e){this.index=e,this._dochange({attr:"index",content:e})},setMessage(e){this.message=e,this._dochange({attr:"message",content:e})},show(){this._show=!0,this._dochange({attr:"show",content:!0})},hide(){this._show=!1,this._dochange({attr:"show",content:!1})},on(e,t){this._events[e]&&this._events[e].push(t)},_dochange(e){var t=this;this._events.change.forEach((function(i){i(e,t)}))}},t})(),a=(()=>{var e=new i({title:"设置"});return mainmenu.pushMenu({icon:util.getGoogleIcon("e8b8",{type:"fill"}),title:"主设置",click(){e.open()}},mainmenu.MAIN_MENU_TOP),e})();(e=new iconc.icon({content:util.getGoogleIcon("e8b8",{type:"fill"}),offset:"bl"})).getIcon().title="(Alt+S) 打开设置",e.getIcon().onclick=()=>{a.open()};var o=new n({title:"通用",index:0});return a.addNewGroup(o),{Setting:i,SettingGroup:n,SettingItem:s,mainSetting:a,tyGroup:o,settingSto:t}})(),Setting=setting.Setting,SettingGroup=setting.SettingGroup,SettingItem=setting.SettingItem,mainSetting=setting.mainSetting,tyGroup=setting.tyGroup,omnibox=(()=>{var initsto=setting.settingSto,{on:on,off:off,doevent:doevent}=getEventHandle(),sg=new SettingGroup({title:"搜索框",index:1});mainSetting.addNewGroup(sg);var core=(()=>{var k={SA:[],enter:[]};null==initsto.get("ob_justsearch")&&initsto.set("ob_justsearch",!1),null==initsto.get("ob_http")&&initsto.set("ob_http",!1),null==initsto.get("ob_enable")&&initsto.set("ob_enable",!0);var sawait=[],sis=[],getSA=function(e,t){sawait.length>0&&sawait.forEach((function(e){k.SA[e].interrupt()}));for(var i=[],n=k.SA.length,s=0;s<n;s++)if(k.SA[s].check(e)){var a=k.SA[s].get(e,(function(){return i}));a instanceof Promise?(sawait.push(s),function(e){a.then((function(n){i=n,sawait.splice(sawait.indexOf(e),1),t(i)}))}(s)):t(i=a)}},enter=function(e){doevent("beforeenter",[e]),getType(e).enter(e),doevent("afterenter",[e])},getType=function(e){for(var t=0;t<k.enter.length;t++)if(k.enter[t].check(e))return k.enter[t]},addNewType=function(e){k.enter.unshift(e)},addNewSA=function(e){k.SA.push(e)},searchUtil=(()=>{if(storage){var e=storage("search",{sync:!0,title:"搜索引擎",desc:"搜索引擎配置",compare(e,t,i){var n=o();for(var t in i.typelist)n[t]=i.typelist[t];i.typelist=n,e[t]=i}});e.get("typelist")||e.set("typelist",{bing:"",baidu:"",so:"",sogou:"",google:""}),e.get("type")||e.set("type","bing");var t={bing:{name:"必应",link:"https://www.bing.com/search?q="},baidu:{name:"百度",link:"https://www.baidu.com/s?ie=utf-8&wd="},google:{name:"Google",link:"https://www.google.com/search?q="},so:{name:"360搜索",link:"https://www.so.com/s?q="},sogou:{name:"搜狗",link:"https://www.sogou.com/sogou?query="},stear:{name:"林中木<span>赞助</span>",link:"https://tfseek.top/search?q="},yandex:{name:"Yandex",link:"https://yandex.com/search/?text="},github:{name:"GitHub",link:"https://github.com/search?q="},bilibili:{name:"哔哩哔哩",link:"https://search.bilibili.com/all?keyword="},zhihu:{name:"知乎",link:"https://www.zhihu.com/search?type=content&q="},weibo:{name:"微博",link:"https://s.weibo.com/weibo?q="},taobao:{name:"淘宝",link:"https://ai.taobao.com/search/index.htm?pid=mm_31205575_2237000308_114588650482&union_lens=lensId%3APUB%401667806444%402104ee54_0bea_1845102bd01_03e9%4001&key="},jd:{name:"京东",link:"https://search.jd.com/Search?keyword="},xiaohongshu:{name:"小红书",link:"https://www.xiaohongshu.com/search_result/?&m_source=itab&keyword="},kugou:{name:"酷狗音乐",link:"https://www.kugou.com/yy/html/search.html#searchType=song&searchKeyWord="},qqm:{name:"QQ音乐",link:"https://y.qq.com/n/ryqq/search?t=song&remoteplace=txt.yqq.top&w="},netease:{name:"网易云音乐",link:"https://music.163.com/#/search/m/?type=1&s="},douyin:{name:"抖音",link:"https://www.douyin.com/search/%s?ug_source=lenovo_stream"},duckduckgo:{name:"DuckDuckGo",link:"https://duckduckgo.com/?q="},stackoverflow:{name:"StackOverflow",link:"https://stackoverflow.com/nocaptcha?s="},yahoo:{name:"Yahoo",link:"https://hk.search.yahoo.com/search?p="},mdn:{name:"MDN",link:"https://developer.mozilla.org/zh-CN/search?q="},douban:{name:"豆瓣",link:"https://www.douban.com/search?q="},toutiao:{name:"头条搜索",link:"https://so.toutiao.com/search?dvpf=pc&keyword="},fsearch:{name:"F搜",link:"https://fsoufsou.com/search?q="}},{on:i,off:n,doevent:s}=getEventHandle(),a=s,o=()=>e.get("typelist"),l={getSearchType:()=>t[e.get("type")]?t[e.get("type")].link+"%keyword%":e.get("typelist")[e.get("type")],on:i,setSearchList:t=>{if(0==Object.keys(t).length)throw new Error("newList is empty");e.set("typelist",t);var i=e.get("typelist");a("typelistchange");var n=e.get("type");i[n]!=t[n]&&a("nowtypechange")},getSearchTypeList:o,setSearchType:t=>{e.set("type",t),a("nowtypechange")},getSearchTypeIndex:()=>e.get("type"),neizhi:t};return Object.defineProperty(l,"keywordText",{get:()=>"%keyword%"}),l}})();function checkUrl(e){return!initsto.get("ob_justsearch")&&util.checkUrl(e)}function initNative(){addNewType({check:()=>!0,enter(e){open(searchUtil.getSearchType().replace(searchUtil.keywordText,encodeURIComponent(e)))},icon:":searchtype",submit:util.getGoogleIcon("E8B6")}),addNewType({check:checkUrl,enter(e){-1==e.indexOf("://")&&(e=(initsto.get("ob_http")?"https://":"http://")+e),open(e)},icon:util.getGoogleIcon("E80B"),submit:util.getGoogleIcon("E89E")}),addNewSA({check:e=>!!e,get(e,t){var i=t();return i.unshift({icon:util.getGoogleIcon("E8B6"),text:e,click(){open(searchUtil.getSearchType().replace(searchUtil.keywordText,encodeURIComponent(e)))}}),i}});var searchfetch=null;addNewSA({check:e=>!!e,get:(e,t)=>new Promise((function(i,n){searchfetch=util.jsonp("https://www.baidu.com/sugrec?pre=1&p=3&ie=utf-8&json=1&prod=pc&from=pc_web&wd="+encodeURIComponent(e),(function(e){var n=t();searchfetch=null,e.g?(e.g.forEach((function(e){n.push({icon:util.getGoogleIcon("E8B6"),text:e.q,click(){open(searchUtil.getSearchType().replace(searchUtil.keywordText,encodeURIComponent(e.q)))}})})),i(n)):i(n)}),"cb")})),interrupt(){searchfetch&&(searchfetch.abort(),searchfetch=null)}}),addNewSA({check:checkUrl,get:(e,t)=>new Promise((function(i,n){var s=t();s.unshift({icon:util.getGoogleIcon("E80B"),text:e,click(){-1==e.indexOf("://")&&(e=(initsto.get("ob_http")?"https://":"http://")+e),open(e)}}),i(s)}))});var cal=(()=>{var si=new SettingItem({title:"自动计算",index:2,type:"boolean",message:"搜索框输入=自动计算后面的内容",get:()=>!!core.initsto.get("ob_cal"),callback:e=>(core.initsto.set("ob_cal",e),!0)});return sg.addNewItem(si),core.addNewSA({check:e=>!!core.initsto.get("ob_cal")&&"="==e[0],get(text,getsa){var a=getsa();try{if(text=text.substr(1),!text)return a;var e=Math.E,PI=Math.PI,ln=Math.log,lg=Math.log10,sin=Math.sin,cos=Math.cos,tan=Math.tan,asin=Math.asin,acos=Math.acos,atan=Math.atan,sqrt=Math.sqrt,abs=Math.abs;text=text.replaceAll("^","**").replaceAll("π","PI").replaceAll("[","(").replaceAll("]",")").replaceAll("{","(").replaceAll("}",")");var result=eval(text);result=result.toString().replace("e+","*10^"),a.unshift({icon:util.getGoogleIcon("ea5f"),text:result,click(){ui.setValue(result)}})}catch(e){}return a}}),{si:si}})(),tr=(()=>{var e,t,i=new SettingItem({title:"自动翻译",index:2,type:"boolean",message:"搜索框输入非中文时自动翻译为中文",get:()=>!!core.initsto.get("ob_tran"),callback:e=>(core.initsto.set("ob_tran",e),!0)});return sg.addNewItem(i),core.addNewSA({check:e=>!!core.initsto.get("ob_tran")&&!util.checkUrl(e)&&function(e){var t=e.length,i=e.match(/[a-zA-Z\u3040-\u309F\u30A0-\u30FF\u31F0-\u31FFйцукенгшщзхъфывапролджэячсмитьбюёàâäèéêëîïôœùûüÿçÀÂÄÈÉÊËÎÏÔŒÙÛÜŸÇ\u0530-\u1CDF]/g);return!!i&&i.length/t>.5}(e),get:(i,n)=>new Promise((function(s,a){t=setTimeout((()=>{function t(){e=util.xhr("https://api.gumengya.com/Api/Translate?text="+encodeURIComponent(i)+"&from=auto&to=zh",(function(e){var t=n(),i=JSON.parse(e);if(200==i.code){var a=i.data.result;t.unshift({icon:util.getGoogleIcon("e8e2"),text:a,click(){ui.setValue(a)}})}s(t)}),(function(e){}))}e=util.xhr("https://api.oioweb.cn/api/txt/QQFanyi?sourceText="+encodeURIComponent(i),(function(e){var i=JSON.parse(e);if(200==i.code){var a=n(),o=i.result.targetText;a.unshift({icon:util.getGoogleIcon("e8e2"),text:o,click(){ui.setValue(o)}}),s(a)}else t()}),(function(e){t()}))}),1500)})),interrupt(){clearTimeout(t),e&&e.abort()}}),{si:i}})();sis.push(cal.si),sis.push(tr.si),init_state=!0}var init_state=!1;function isInit(){return init_state}var sic=new SettingItem({title:"启用搜索框",index:1,type:"boolean",message:"关闭将不显示搜索框",get:()=>!!initsto.get("ob_enable"),callback:e=>(initsto.set("ob_enable",e),e&&!init_state&&initNative(),initSett(e),ui.uiEnable(e),!0)}),si=new SettingItem({title:"搜索框仅搜索",index:1,type:"boolean",message:"打开后，搜索框将失去打开链接的功能",get:()=>!!initsto.get("ob_justsearch"),callback:e=>(initsto.set("ob_justsearch",e),ui.getInput().placeholder=e?"搜索":"搜索或输入网址",!0)}),si2=new SettingItem({title:"默认HTTPS打开链接",index:1,type:"boolean",message:"打开后，搜索框打开链接在默认情况下使用HTTPS",get:()=>!!initsto.get("ob_http"),callback:e=>(initsto.set("ob_http",e),!0)});function initSett(e){e?sis.forEach((e=>e.show())):sis.forEach((e=>e.hide()))}return sg.addNewItem(sic),sg.addNewItem(si),sg.addNewItem(si2),sis.push(si),sis.push(si2),{getSA:getSA,enter:enter,getType:getType,addNewType:addNewType,addNewSA:addNewSA,searchUtil:searchUtil,initsto:initsto,setJustSearch(e){initsto.set("ob_justsearch",e),si.reGet()},isInit:isInit,initNative:initNative,initSett:initSett}})(),ui=(()=>{"use strict";var e,t,i,n,s,a,o,l;function r(e,t){var n=core.getType(e);if(":"==n.icon[0]){if(!t&&i.getAttribute("data-teshu")==n.icon)return;i.setAttribute("data-teshu",n.icon);var a=function(e){return":searchtype"==e?new Promise((function(e,t){util.getFavicon(core.searchUtil.getSearchType(),(function(t){e(t?'<img src="'+t+'" style="border-radius:50%;"/>':'<img src="'+util.createIcon("S")+'" style="border-radius:50%;"/>')}))})):""}(n.icon);a instanceof Promise?a.then((function(e){i.innerHTML=e})):i.innerHTML=a}else i.innerHTML=n.icon,i.removeAttribute("data-teshu");":"==n.submit[0]?(s.setAttribute("data-teshu",n.submit),s.innerHTML=(n.submit,"")):(s.innerHTML=n.submit,s.removeAttribute("data-teshu"))}o=util.element("div",{class:"searchpadding"}),util.query(document,"main .center").append(o),null==core.initsto.get("ob_autofocus")&&core.initsto.set("ob_autofocus",!1),core.initsto.get("ob_autofocus")&&Onshow((()=>{setTimeout((()=>{n.focus(),_focus()}),100)}));var c=new SettingItem({title:"自动聚焦",index:1,type:"boolean",message:"打开页面自动聚焦搜索框",get:()=>!!core.initsto.get("ob_autofocus"),callback:e=>(core.initsto.set("ob_autofocus",e),!0)});sg.addNewItem(c);var d=new SettingItem({title:"聚焦时背景蒙版",index:6,type:"boolean",message:"关闭后聚焦搜索框时不再出现背景蒙版",get:()=>!core.initsto.get("ob_notshowb"),callback:e=>(core.initsto.set("ob_notshowb",!e),g(),!0)});sg.addNewItem(d);var u=new SettingItem({title:"背景蒙版模糊",index:7,type:"boolean",message:"背景蒙版模糊（可能会影响性能）",get:()=>core.initsto.get("ob_bblur"),callback:e=>(core.initsto.set("ob_bblur",e),g(),!0)});function g(){core.initsto.get("ob_notshowb")?(t.classList.add("notshow"),u.hide()):(t.classList.remove("notshow"),u.show(),core.initsto.get("ob_bblur")?t.classList.add("blur"):t.classList.remove("blur"))}return sg.addNewItem(u),{setValue(e){n.value=e,n.focus(),l.call(n)},focus(){n.focus()},blur(){n.blur()},isblur:()=>!n.classList.contains("active"),setAutoFocus(e){core.initsto.set("ob_autofocus",e),c.reGet()},getInput:()=>n,uiEnable:function(h){h?(e||function(){var c;e=util.element("div",{class:"searchbox"}),t=util.element("div",{class:"cover searchcover"}),e.innerHTML='<div class="box"><div class="icon"></div><div class="input"><input type="text" placeholder="搜索或输入网址" {i}></div><div class="submit"></div></div><ul class="sas"></ul>'.replace("{i}",core.initsto.get("ob_autofocus")?"autofocus":""),util.query(document,"main").append(e),util.query(document,"main").append(t),i=util.query(e,"div.icon"),n=util.query(e,"div.input input"),s=util.query(e,"div.submit"),a=util.query(e,"ul.sas"),initsto.get("ob_justsearch")&&(n.placeholder="搜索"),l=function(){r(this.value.trim()),a.innerHTML="",core.getSA(this.value.trim(),(function(e){var t=util.query(a,"li.active");t&&(t={icon:util.query(t,"div.saicon").innerHTML,text:util.query(t,"div.sa_text").innerText}),a.innerHTML="",e.forEach((e=>{var t=util.element("li");t.innerHTML=`<div class="saicon">${e.icon}</div><div class="sa_text"></div>`,t.querySelector(".sa_text").innerText=e.text,a.append(t),t.onclick=()=>{e.click()}})),t&&util.query(a,"li",!0).forEach((e=>{util.query(e,"div.saicon").innerHTML&&util.query(e,"div.sa_text").innerHTML==t.text&&e.classList.add("active")}))})),doevent("input",[n.value])},n.oninput=util.fangdou(l,300),n.onkeydown=function(e){if("Enter"==e.key)(t=util.query(a,"li.active"))?t.click():core.enter(this.value);else if("ArrowUp"==e.key)e.preventDefault(),(t=util.query(a,"li.active"))&&(t.classList.remove("active"),t.previousElementSibling&&t.previousElementSibling.classList.add("active"));else if("ArrowDown"==e.key)e.preventDefault(),(t=util.query(a,"li.active"))?t.nextElementSibling&&(t.classList.remove("active"),t.nextElementSibling.classList.add("active")):util.query(a,"li").classList.add("active");else if("ArrowRight"==e.key){var t;(t=util.query(a,"li.active"))&&(n.value=util.query(t,".sa_text").innerText,l.call(this))}else if("Tab"==e.key)if(e.preventDefault(),e.shiftKey)if(util.query(m,"li.active").previousElementSibling)util.query(m,"li.active").previousElementSibling.click();else{var i=util.query(m,"li",!0);i[i.length-2].click()}else util.query(m,"li.active").nextElementSibling.classList.contains("add")?util.query(m,"li").click():util.query(m,"li.active").nextElementSibling.click()},n.addEventListener("focus",(function(){clearTimeout(c),t.classList.add("active"),e.classList.add("active"),doevent("focus",[n])})),n.addEventListener("blur",(function(){this.classList.remove("active"),c=setTimeout((()=>{d?u=function(){setTimeout((()=>{t.classList.remove("active"),e.classList.remove("active")}),10)}:(t.classList.remove("active"),e.classList.remove("active"))})),doevent("blur",[n])})),document.addEventListener("mousedown",h),document.addEventListener("touchstart",h),document.addEventListener("mouseup",p),document.addEventListener("touchend",p);var d=!1,u=function(){};function h(){d=!0}function p(){d=!1,u(),u=function(){}}s.onclick=function(){core.enter(n.value)};var m=util.element("div",{class:"searchtypeselector"});function y(){var e=util.query(m,"ul"),t=core.searchUtil.getSearchTypeIndex();e.innerHTML="";var i=core.searchUtil.getSearchTypeList();for(var n in i){var s;(s=util.element("li")).innerHTML="<img/>",function(e,t){!i[t]&&core.searchUtil.neizhi[t]&&(i[t]=core.searchUtil.neizhi[t].link),util.getFavicon(i[t],(function(t){e.querySelector("img").src=t||util.createIcon("s")}))}(s,n),s.setAttribute("data-type",n),e.append(s),n==t&&s.classList.add("active"),s.onclick=function(){var e=util.query(m,"ul li.active");e&&e.classList.remove("active"),this.classList.add("active"),core.searchUtil.setSearchType(this.getAttribute("data-type")),m.classList.remove("active")}}(s=util.element("li")).classList.add("add"),s.innerHTML=util.getGoogleIcon("e145"),e.append(s),s.onclick=function(){searchEditor.open()},m.style.width=36*util.query(e,"li",!0).length-6+"px"}m.innerHTML="<ul></ul>",util.query(document,"main .center").insertBefore(m,o.nextElementSibling),i.addEventListener("click",(function(){m.classList.contains("active")?(m.classList.remove("active"),document.querySelector("main .links").classList.remove("duan")):(m.classList.add("active"),document.querySelector("main .links").classList.add("duan"))})),core.searchUtil.on("nowtypechange",(function(){":searchtype"==i.getAttribute("data-teshu")&&r(n.value,!0)})),core.searchUtil.on("typelistchange",(function(){y()})),y(),r(""),g()}(),e.style.display="block",o.style.height="",c.show(),d.show(),u.show()):(e&&(e.style.display="none"),o.style.height="20px",c.hide(),d.hide(),u.hide())}}})(),_isen=initsto.get("ob_enable");return _isen&&!core.isInit()&&core.initNative(),core.initSett(_isen),ui.uiEnable(_isen),{value:ui.setValue,focus:ui.focus,blur:ui.blur,isblur:ui.isblur,addNewSug:core.addNewSA,addNewType:core.addNewType,on:on,off:off,getSearchType:core.searchUtil.getSearchType,getSearchTypeList:core.searchUtil.getSearchTypeList,getSearchTypeIndex:core.searchUtil.getSearchTypeIndex,setSearchType:core.searchUtil.setSearchType,setSearchList:core.searchUtil.setSearchList,keywordText:core.searchUtil.keywordText,neizhi:core.searchUtil.neizhi,search:{on:core.searchUtil.on},sg:sg,setAutoFocus:ui.setAutoFocus,setJustSearch:ui.setJustSearch}})(),link=(()=>{var e=storage("link",{sync:!0,title:"链接",desc:"QUIK起始页链接数据",websync:!0,get:async function(){var t=e.getAll();return"db"==t["storage-mode"]&&(t.links=await localforage.getItem(t.links),t.cate=await localforage.getItem(t.cate)),delete t["storage-mode"],t},rewrite:(t,i,n)=>new Promise((s=>{n["storage-mode"]=e.get("storage-mode"),"db"==e.get("storage-mode")?e.remove("links",!0,(()=>{dbTool.set(n.links,void 0,(a=>{n.links=a,e.remove("cate",!0,(()=>{dbTool.set(n.cate,void 0,(e=>{n.cate=e,t[i]=n,s()}))}))}))})):(t[i]=n,s())})),compare:(i,n,s)=>new Promise((a=>{if(s["storage-mode"]=e.get("storage-mode"),"db"==s["storage-mode"])e.get("links",!0,(o=>{e.remove("links",!0,(()=>{s.links=t(o,s.links),dbTool.set(s.links,void 0,(e=>{s.links=e,dbTool.get(i[n].cate,(e=>{dbTool.delete(i[n].cate,(()=>{var o=e;for(var l in s.cate)o[l]=t(o[l],s.cate[l]);s.cate=o,dbTool.set(s.cate,void 0,(e=>{s.cate=e,i[n]=s,a()}))}))}))}))}))}));else{s.links=t(e.get("links"),s.links);var o=e.get("cate");for(var l in s.cate)o[l]=t(o[l],s.cate[l]);s.cate=o,i[n]=s}}))});function t(e,t){if(!e)return t;if(!t)return e;for(var i=0;i<e.length;i++)t.find((function(t){return t.title==e[i].title&&t.url==e[i].url}))||t.push(e[i]);return t}var i,{on:n,off:s,doevent:a}=getEventHandle();function o(e,t){var i={title:e.title,url:e.url};return"number"==typeof e.index&&e.index>=0?e.index>t.length?t.push(i):t.splice(e.index,0,i):t.push(i),t}function l(e,t,i){if(!i[e])return!1;var n={title:t.title,url:t.url};if(i[e]=n,"number"==typeof t.index&&t.index>=0)if(t.index>=i.length);else{var s=i.splice(e,1)[0];i.splice(t.index,0,s)}return i}function r(e){return e.url.length>1e3?"url":e.title.length>60&&"title"}storage.checkIDB()?i=(()=>{e.set("storage-mode","db");var t=0,i=[];return e.get("links")?3==++t&&i.forEach((e=>e())):e.set("links",[],!0,(()=>{3==++t&&i.forEach((e=>e()))})),e.get("cate")?(t++,e.get("catelist")?3==++t&&i.forEach((e=>e())):e.get("cate",!0,(n=>{e.set("catelist",Object.keys(n)),3==++t&&i.forEach((e=>e()))}))):e.set("cate",{},!0,(()=>{t++,e.set("catelist",[]),3==++t&&i.forEach((e=>e()))})),3==t&&i.forEach((e=>e())),{setAll(i,n,s){if(3!=t)throw"初始化未完成";Array.isArray(i)&&"object"==typeof n&&(i&&e.set("links",i,!0,(()=>{s&&s("link"),a("change",{type:"all",links:i})})),n&&e.set("cate",n,!0,(()=>{e.set("catelist",Object.keys(n)),s&&s("cate"),a("change",{type:"all",cate:n})})))},addLink(i,n){if(3!=t)throw"初始化未完成";if(!util.checkDetailsCorrect(i,["title","url"]))throw"参数不正确";i.cate?e.get("cate",!0,(t=>{t[i.cate]?(t[i.cate]=o(i,t[i.cate]),e.set("cate",t,!0,(()=>{n&&n({code:0,msg:"添加成功"}),a("change",{cate:i.cate,type:"add",detail:i})}))):n&&n({code:-1,msg:"分组不存在"})})):e.get("links",!0,(t=>{t=o(i,t),e.set("links",t,!0,(()=>{n&&n({code:0,msg:"添加成功"}),a("change",{cate:null,type:"add",detail:i})}))}))},changeLink(i,n,s,o,r={}){if(3!=t)throw"初始化未完成";if(!util.checkDetailsCorrect(s,["title","url"])||"number"!=typeof n)throw"参数错误";i?e.get("cate",!0,(t=>{if(t[i]){var c=l(n,s,t[i]);c?(t[i]=c,e.set("cate",t,!0,(()=>{o&&o({code:0,msg:"修改成功"}),a("change",{cate:i,index:n,type:"change",detail:s,other:r})}))):o&&o({code:-2,msg:"链接不存在"})}else o&&o({code:-1,msg:"分组不存在"})})):e.get("links",!0,(t=>{var i=l(n,s,t);i?(t=i,e.set("links",t,!0,(()=>{o&&o({code:0,msg:"修改成功"}),a("change",{cate:null,index:n,type:"change",detail:s,other:r})}))):o&&o({code:-2,msg:"链接不存在"})}))},deleteLink(i,n,s){if(3!=t)throw"初始化未完成";i?e.get("cate",!0,(t=>{t[i]?t[i][n]?(t[i].splice(n,1),e.set("cate",t,!0,(()=>{s&&s({code:0,msg:"删除成功"}),a("change",{cate:i,index:n,type:"delete"})}))):s&&s({code:-2,msg:"链接不存在"}):s&&s({code:-1,msg:"分组不存在"})})):e.get("links",!0,(t=>{t[n]?(t.splice(n,1),e.set("links",t,!0,(()=>{s&&s({code:0,msg:"删除成功"}),a("change",{cate:null,index:n,type:"delete"})}))):s&&s({code:-2,msg:"链接不存在"})}))},addCate(i,n,s){if(3!=t)throw"初始化未完成";e.get("cate",!0,(t=>{t[i]?n&&n({code:-1,msg:"分组已存在"}):(t[i]=[],e.set("cate",t,!0,(()=>{var t=e.get("catelist");void 0===s?t.splice(s,0,i):t.push(i),e.set("catelist",t),n&&n({code:0,msg:"添加成功"}),a("change",{cate:i,type:"cateadd"})})))}))},renameCate(i,n,s,o){if(3!=t)throw"初始化未完成";var l=e.get("catelist");if(!(l.indexOf(i)<0))return i==n?(l.splice(l.indexOf(i),1),l.splice(o,0,i),e.set("catelist",l),s&&s({code:0,msg:"修改成功"}),void a("change",{cate:i,catename:n,type:"caterename"})):void e.get("cate",!0,(t=>{t[i]?(t[n]&&s&&s({code:-2,msg:"分组重名"}),t[n]=t[i],delete t[i],e.set("cate",t,!0,(()=>{"number"!=typeof o&&(o=l.indexOf(i)),l.splice(l.indexOf(i),1),l.splice(o,0,n),e.set("catelist",l),s&&s({code:0,msg:"修改成功"}),a("change",{cate:i,catename:n,type:"caterename"})}))):s&&s({code:-1,msg:"分组不存在"})}));s&&s({code:-1,msg:"分组不存在"})},deleteCate(i,n){if(3!=t)throw"初始化未完成";var s=e.get("catelist");s.indexOf(i)<0?n&&n({code:-1,msg:"分组不存在"}):(s.splice(s.indexOf(i),1),e.set("catelist",s),e.get("cate",!0,(t=>{t[i]?t[i].length<=0?(delete t[i],e.set("cate",t,!0,(()=>{n&&n({code:0,msg:"删除成功"}),a("change",{cate:i,type:"catedelete"})}))):confirm("确定要删除分组吗？无法恢复！",(s=>{s?(delete t[i],e.set("cate",t,!0,(()=>{n&&n({code:0,msg:"删除成功"}),a("change",{cate:i,type:"catedelete"})}))):n&&n({code:-2,msg:"用户取消删除"})})):n&&n({code:-1,msg:"分组不存在"})})))},getLinks(i,n){if(3!=t)throw"初始化未完成";i?e.get("cate",!0,(e=>{e[i]?n&&n({code:0,msg:"获取成功",data:e[i]}):n&&n({code:-1,msg:"分组不存在"})})):e.get("links",!0,(e=>{n&&n({code:0,msg:"获取成功",data:e})}))},getCates(i){if(3!=t)throw"初始化未完成";i&&i({code:0,msg:"获取成功",data:e.get("catelist")})},getCateAll(i){if(3!=t)throw"初始化未完成";e.get("cate",!0,(e=>{i&&i({code:0,msg:"获取成功",data:e})}))},ready(e){3==t?e():i.push(e)},on:n,off:s}})():(e.set("storage-mode","localstorage"),e.get("links")||e.set("links",[]),e.get("cate")?e.get("catelist")||e.set("catelist",Object.keys(e.get("cate"))):(e.set("cate",{}),e.set("catelist",[])),i={setAll(t,i,n){Array.isArray(t)&&"object"==typeof i&&(e.set("links",t),e.set("cate",i),e.set("catelist",Object.keys(i)),n&&n(),a("change",{type:"all",links:t,cate:i}))},addLink(t,i){if(!util.checkDetailsCorrect(t,["title","url"]))throw"参数不正确";var n=r(t);if(n)i&&i({code:-3,msg:"受限模式下，"+n+"长度过长",lm:n});else if(t.cate){var s=e.get("cate");if(s[t.cate]){if(s[t.cate].length>100)return void(i&&i({code:-4,msg:"受限模式下，分组下已超过100条链接，无法添加"}));s[t.cate]=o(t,s[t.cate]),e.set("cate",s),i&&i({code:0,msg:"添加成功"}),a("change",{cate:t.cate,type:"add",detail:t})}else i&&i({code:-1,msg:"分组不存在"})}else{var l=e.get("links");if(l.length>100)return void(i&&i({code:-4,msg:"受限模式下，分组下已超过100条链接，无法添加"}));l=o(t,l),e.set("links",l),i&&i({code:0,msg:"添加成功"}),a("change",{cate:null,type:"add",detail:t})}},changeLink(t,i,n,s,o={}){if(!util.checkDetailsCorrect(n,["title","url"])||"number"!=typeof i)throw"参数错误";var c=r(n);if(c)s&&s({code:-3,msg:"受限模式下，"+c+"长度过长",lm:c});else if(t){var d=e.get("cate");if(!d[t])return void(s&&s({code:-1,msg:"分组不存在"}));if(!(u=l(i,n,d[t])))return void(s&&s({code:-2,msg:"链接不存在"}));d[t]=u,e.set("cate",d),s&&s({code:0,msg:"修改成功"}),a("change",{cate:t,index:i,type:"change",detail:n,other:o})}else{var u,g=e.get("links");if(!(u=l(i,n,g)))return void(s&&s({code:-2,msg:"链接不存在"}));g=u,e.set("links",g),s&&s({code:0,msg:"修改成功"}),a("change",{cate:null,index:i,type:"change",detail:n,other:o})}},deleteLink(t,i,n){if(t){var s=e.get("cate");if(!s[t])return void(n&&n({code:-1,msg:"分组不存在"}));if(!s[t][i])return void(n&&n({code:-2,msg:"链接不存在"}));s[t].splice(i,1),e.set("cate",s),n&&n({code:0,msg:"删除成功"}),a("change",{cate:t,index:i,type:"delete"})}else{var o=e.get("links");if(!o[i])return void(n&&n({code:-2,msg:"链接不存在"}));o.splice(i,1),e.set("links",o),n&&n({code:0,msg:"删除成功"}),a("change",{cate:null,index:i,type:"delete"})}},addCate(t,i){var n=e.get("cate");n[t]?i&&i({code:-1,msg:"分组已存在"}):Object.keys(n).length>=20?i&&i({code:-2,msg:"受限模式下，分组数量不能超过20个"}):(n[t]=[],e.set("cate",n),i&&i({code:0,msg:"添加成功"}),a("change",{cate:t,type:"cateadd"}))},renameCate(t,i,n){var s=e.get("cate");s[t]?(s[i]&&n&&n({code:-2,msg:"分组重名"}),s[i]=s[t],delete s[t],e.set("cate",s),n&&n({code:0,msg:"修改成功"}),a("change",{cate:t,catename:i,type:"caterename"})):n&&n({code:-1,msg:"分组不存在"})},deleteCate(t,i){var n=e.get("cate");n[t]?n[t].length<=0?(delete n[t],e.set("cate",n),i&&i({code:0,msg:"删除成功"})):confirm("确定要删除分组吗？无法恢复！",(s=>{s?(delete n[t],e.set("cate",n),i&&i({code:0,msg:"删除成功"}),a("change",{cate:t,type:"catedelete"})):i&&i({code:-2,msg:"用户取消删除"})})):i&&i({code:-1,msg:"分组不存在"})},getLinks(t,i){if(t){if(!(n=e.get("cate"))[t])return void(i&&i({code:-1,msg:"分组不存在"}));i&&i({code:0,msg:"获取成功",data:n[t]})}else{var n=e.get("links");i&&i({code:0,msg:"获取成功",data:n})}},getCates(t){var i=e.get("catelist");t&&t({code:0,msg:"获取成功",data:i})},getCateAll(t){var i=e.get("cate");t&&t({code:0,msg:"获取成功",data:i})},ready(e){e()},on:n,off:s});var c=(()=>{function t(e,t){for(var i=0;i<t.length;i++)if(t[i].isSameNode(e))return i;return-1}var n=[],s=(()=>{util.initSet(e,"draglink",!0);var s=new SettingItem({type:"boolean",index:2,title:"拖动排序链接(Beta)",message:"开启后，你可以通过拖动链接来进行排序，手机端需长按链接1s才可拖动（Beta）",get:()=>e.get("draglink"),callback(t){e.set("draglink",t)}});setTimeout((()=>{l.addNewItem(s)}));var a=null;return function(s){function l(l){var c=null,d=null;s.addEventListener(l?"mousedown":"touchstart",(u=>{if(3==u.which)return!0;if(l||(d=setTimeout((()=>{r(),menuedLi=s,linkMenu.setOffset({top:u.targetTouches[0].pageY,left:u.targetTouches[0].pageX}),s.classList.add("menued"),linkMenu.show()}),600)),!e.get("draglink"))return!0;let g=l?u.pageX-s.getBoundingClientRect().left:u.targetTouches[0].pageX-s.getBoundingClientRect().left,h=l?u.pageY-s.getBoundingClientRect().top:u.targetTouches[0].pageY-s.getBoundingClientRect().top;l?(c=setTimeout((()=>{document.addEventListener("mousemove",k,{passive:!1})}),50),document.addEventListener("mouseup",q,{passive:!1})):(c=setTimeout((()=>{document.addEventListener("touchmove",k,{passive:!1}),s.classList.add("touching"),linkMenu.hide()}),1e3),document.addEventListener("touchend",q,{passive:!1}));var p=null,m=null,y=util.query(o,".link-list").getBoundingClientRect().left,v=util.query(o,".link-list").getBoundingClientRect().top,f=s.getBoundingClientRect().width,b=s.getBoundingClientRect().height;function k(e){e.preventDefault(),clearTimeout(d),p||(s.querySelector("a").addEventListener("click",w),(p=s.cloneNode(!0)).classList.add("dragging-link"),s.classList.add("mousing"),document.body.appendChild(p),p.style.width=s.getBoundingClientRect().width+"px",p.style.height=s.getBoundingClientRect().height+"px");var t=(l?e.pageX:e.targetTouches[0].pageX)-g,i=(l?e.pageY:e.targetTouches[0].pageY)-h;p.style.left=t+"px",p.style.top=i+"px";var r=t-y+50,c=i-v+util.query(o,".link-list").scrollTop;if(i-v<-b/2||i>util.query(o,".link-list").getBoundingClientRect().height+util.query(o,".link-list").getBoundingClientRect().top){(u=util.query(o,".link-list .insert-line")).style.display="none",m=null,i-v<0?(clearInterval(a),a=setInterval((()=>{util.query(o,".link-list").scrollTop-=2,util.query(o,".link-list").scrollTop<=0&&clearInterval(a)}),5)):(clearInterval(a),a=setInterval((()=>{util.query(o,".link-list").scrollTop+=2,util.query(o,".link-list").scrollTop>=util.query(o,".link-list").scrollHeight-util.query(o,".link-list").getBoundingClientRect().height&&clearInterval(a)}),5))}else{clearInterval(a);var u,k=parseInt(c/b),q=parseInt(r/f),x=q+k*function(){var e=util.query(o,".link-list").getBoundingClientRect().width/util.query(o,".link-list li").getBoundingClientRect().width;return parseInt(e)}();if(n.length>x)m=x,(u=util.query(o,".link-list .insert-line")).style.top=k*b+7+"px",u.style.left=q*f+"px",u.style.height=b+"px",u.style.display="block"}}function w(e){e.preventDefault()}function q(e){if(clearTimeout(c),clearTimeout(d),s.classList.remove("touching"),s.classList.remove("mousing"),setTimeout((()=>s.querySelector("a").removeEventListener("click",w)),10),document.removeEventListener(l?"mousemove":"touchmove",k),document.removeEventListener(l?"mouseup":"touchend",q),p&&(p.remove(),p=null),null!==m){util.query(o,".link-list .insert-line").style.display="none";var a=t(s,util.query(o,".link-list li",!0));if(m==a)return;var r=util.query(o,".cate-bar-items .cate-item.active");r=r.classList.contains("mr")?null:r.innerText,i.changeLink(r,a,{url:n[a].url,title:n[a].title,index:m},(e=>{0!=e.code?toast.show(e.msg):(n.splice(m,0,n.splice(a,1)[0]),m>a?util.query(o,".link-list").insertBefore(s,util.query(o,".link-list li",!0)[m+1]):util.query(o,".link-list").insertBefore(s,util.query(o,".link-list li",!0)[m]))}),{justindex:!0})}return!0}return!0}))}l(0),l(1)}})(),{init:a,linkF:o,linksg:l,resetmenued:r}=(()=>{var t=util.element("div",{class:"links"});function n(){c()&&c().classList.remove("menued"),v()&&v().classList.remove("menued")}document.addEventListener("click",n),document.addEventListener("contextmenu",n),util.query(document,"main .center").append(t);var s=new SettingGroup({title:"链接"});return mainSetting.addNewGroup(s),{init:function(){t.innerHTML='<div class="cate-bar"><div class="cate-bar-controls"><div class="cate-left-btn">{{cate-left}}</div></div><div class="cate-bar-scrolls"><div class="cate-bar-items"><div class="cate-item mr active">{{mr}}</div></div></div><div class="cate-bar-controls r"><div class="cate-right-btn">{{cate-right}}</div><div class="cate-add-btn">{{cate-add}}</div></div></div><div class="linkscroll"><ul class="link-list"></ul></div>'.replace("{{cate-left}}",util.getGoogleIcon("e314")).replace("{{cate-right}}",util.getGoogleIcon("e315")).replace("{{cate-add}}",util.getGoogleIcon("e145")).replace("{{mr}}",util.getGoogleIcon("e838",{type:"fill"})),i.ready((()=>{u(e.get("enabledCate")),y(e.get("linksize")),m(e.get("linkstyle")),setTimeout((function(){t.style.opacity=1}),300)})),d()},linkF:t,linksg:s,resetmenued:n}})(),{getMenuedCate:c,observeCate:d,dcate:u,cateWidthShiPei:g,enabledCateSi:h}=(()=>{var t,n=null,s=new menu({list:[{icon:util.getGoogleIcon("e3c9"),title:"修改",click(){u(n.innerText)}},{icon:util.getGoogleIcon("e92e"),title:"删除",click(){var e=n.innerText;i.deleteCate(e,(e=>{0==e?toast.show("删除成功"):toast.show(e.msg)}))}}]});function a(e){var t=util.element("div",{class:"cate-item"});t.innerText=e,util.query(o,".cate-bar-items").append(t),t.onclick=function(){d(this)},t.oncontextmenu=function(e){e.preventDefault(),e.stopPropagation(),r(),n=this,s.setOffset({top:e.pageY,left:e.pageX}),this.classList.add("menued"),s.show()}}function c(){util.query(o,".cate-bar-items .cate-item",!0).forEach((e=>{e.classList.contains("mr")||e.remove()})),i.getCates((e=>{e.data.forEach((e=>{a(e)}))}))}function d(e){util.query(o,".link-list").innerHTML='<div class="insert-line"></div>';var t=null;if("string"==typeof e){try{util.query(o,".cate-bar-items .cate-item.active").classList.remove("active")}catch(e){}for(var i=util.query(o,".cate-bar-items .cate-item",!0),n=0;n<i.length;n++)if(!i[n].classList.contains("mr")&&i[n].innerText==e){i[n].classList.add("active");break}t=e}else if(e){try{util.query(o,".cate-bar-items .cate-item.active").classList.remove("active")}catch(e){}e.classList.add("active"),t=e.innerText}else{try{util.query(o,".cate-bar-items .cate-item.active").classList.remove("active")}catch(e){}util.query(o,".cate-bar-items .cate-item.mr").classList.add("active")}p(t)}function u(e){t||(t=new dialog({class:"link-add-dialog",content:'<form><h1></h1><div class="content"><p>标题：<input class="cate-name" type="text" required placeholder="分组标题(必填)"></p><p>位置：<input class="cate-index" type="number" required placeholder="分组位置"></p></div><div class="footer"><div class="cancel btn">取消</div><button class="ok btn">确定</button></div></form>'}));var n=t.getDialogDom();function s(e,t,i,s,a){util.query(n,"h1").innerHTML=e,util.query(n,".cate-name").value=t,util.query(n,".cate-index").value=i,util.query(n,".cate-index").max=s,util.query(n,".cate-index").min=1,util.query(n,"form").onsubmit=e=>{e.preventDefault();var t=util.query(n,".cate-name").value,i=util.query(n,".cate-index").value;a(t,i-1)}}util.query(n,".cancel.btn").onclick=e=>{e.preventDefault(),t.close()},setTimeout((()=>{t.open(),i.getCates((function(n){var a=n.data;e?s("修改分组",e,a.indexOf(e)+1,a.length,(function(n,s){i.renameCate(e,n,(e=>{e.code<0?toast.show(e.msg):(toast.show("修改成功"),t.close())}),s)})):s("添加分组","",a.length+1,a.length+1,(function(e,n){i.addCate(e,(e=>{e.code<0?toast.show(e.msg):(toast.show("添加成功"),t.close())}),n)}))}))}))}void 0===e.get("enabledCate")&&e.set("enabledCate",!1);var g=new SettingItem({type:"boolean",title:"链接分组",message:"(Alt+G)启用链接分组功能来管理链接",get:()=>e.get("enabledCate"),callback(t){e.set("enabledCate",t),h(t)}});function h(e){d(),e?(util.query(o,".cate-bar").style.display="block",function(){if(v)return;function e(e){if(e<0)return 0;var t=util.query(o,".cate-bar-scrolls").scrollWidth-util.query(o,".cate-bar-scrolls").getBoundingClientRect().width;return e>t?t:void 0}i.getCates((e=>{e.data.forEach((e=>{a(e)}))})),util.query(o,".cate-item.mr").onclick=function(){try{util.query(o,".cate-bar-items .cate-item.active").classList.remove("active")}catch(e){}this.classList.add("active"),d()},util.query(o,".cate-item.mr").oncontextmenu=function(e){e.preventDefault(),e.stopPropagation(),f.setOffset({top:e.pageY,left:e.pageX}),f.show()},util.query(o,".cate-add-btn").onclick=()=>{u()},util.query(o,".cate-left-btn").onclick=()=>{util.query(o,".cate-bar-scrolls").scrollTo({left:e(util.query(o,".cate-bar-scrolls").scrollLeft-util.query(o,".cate-bar-scrolls").getBoundingClientRect().width/2),behavior:"smooth"})},util.query(o,".cate-right-btn").onclick=()=>{util.query(o,".cate-bar-scrolls").scrollTo({left:e(util.query(o,".cate-bar-scrolls").scrollLeft+util.query(o,".cate-bar-scrolls").getBoundingClientRect().width/2),behavior:"smooth"})},util.query(o,".cate-bar-scrolls").onscroll=function(){m.call(this)},m.call(util.query(o,".cate-bar-scrolls")),v=!0}(),setTimeout((()=>{y()}),10)):util.query(o,".cate-bar").style.display="none"}function m(){var e=0;0==this.scrollLeft?(util.query(o,".cate-left-btn").classList.add("disabled"),e++):util.query(o,".cate-left-btn").classList.remove("disabled"),this.scrollLeft>=this.scrollWidth-this.getBoundingClientRect().width?(util.query(o,".cate-right-btn").classList.add("disabled"),e++):util.query(o,".cate-right-btn").classList.remove("disabled"),this.style.width="calc(100% - "+(120-40*e)+"px)"}function y(){var e=util.query(o,".cate-bar-items .cate-item",!0);util.query(o,".cate-bar-items").style.width="100000px",e[0].offsetHeight;var t=0;e.forEach((function(e){t+=e.getBoundingClientRect().width+4})),util.query(o,".cate-bar-items").style.width=t+"px",m.call(util.query(o,".cate-bar-scrolls"))}l.addNewItem(g),window.addEventListener("resize",(()=>{m.call(util.query(o,".cate-bar-scrolls"))}));var v=!1,f=new menu({list:[{icon:util.getGoogleIcon("e92e"),title:"清空",click(){confirm("确定清空默认分组的链接吗？该操作不可恢复！",(function(e){e&&i.setAll([],null,(function(e){"link"==e&&toast.show("清空成功")}))}))}}],offset:{top:0,left:0}});return i.on("change",(e=>{if("cateadd"==e.type)c(),d(e.cate);else if("catedelete"==e.type){var t=util.query(o,".cate-bar-items .cate-item.active").innerText;c(),t!=e.cate?d(t):d()}else if("caterename"==e.type){t=util.query(o,".cate-bar-items .cate-item.active").innerText;c(),t!=e.cate&&d(t)}else"all"==e.type&&(c(),d())})),{getMenuedCate:()=>n,observeCate:function(){new MutationObserver((()=>{setTimeout(y,1)})).observe(util.query(o,".cate-bar-items"),{childList:!0})},dcate:h,cateWidthShiPei:y,enabledCateSi:g}})(),{drawLinks:p,dstyle:m,dsize:y,getMenuedLi:v,linkSizeSi:f}=(()=>{var a=null;function c(){var e=t(a,util.query(o,".link-list li",!0)),i=util.query(o,".cate-bar-items .cate-item.active");return{cate:i=i.classList.contains("mr")?null:i.innerText,index:e}}var d,u=new menu({list:[{icon:util.getGoogleIcon("e3c9"),title:"修改",click(){var{index:e,cate:t}=c();y(e,t)}},{icon:util.getGoogleIcon("e92e"),title:"删除",click(){var{index:e,cate:t}=c();i.deleteLink(t,e,(function(){toast.show("删除成功")}))}},{icon:util.getGoogleIcon("e14d"),title:"复制链接",click(){util.copyText(util.query(a,"a").href)}},{icon:util.getGoogleIcon("e941"),title:"移动至...",click(){var{index:e,cate:t}=c();!function(e,t){g||(g=new dialog({class:"move-link-dialog",content:'<h1>移动至</h1><div class="group-list"></div><div class="footer"><div class="btn cancel">取消</div><div class="btn ok">确定</div></div>'}),h=g.getDialogDom(),util.query(h,".cancel.btn").onclick=function(e){e.preventDefault(),g.close()},p=util.query(h,".group-list"));util.query(h,".ok.btn").onclick=function(s){var a=util.query(p,".item.act");if(a){var o=a.classList.contains("mr")?null:util.query(a,".item-name").innerText,l=n[t];i.addLink({title:l.title,url:l.url,cate:o},(function(){i.deleteLink(e,t,(function(){toast.show("移动成功"),g.close()}))}))}else toast.show("请选择一个分组")},p.innerHTML="",i.getCates((e=>{e.data.unshift(null),e.data.forEach((e=>{var t=util.element("div",{class:"item"+(e?"":" mr")});t.innerHTML=`<div class="item-name">${e||util.getGoogleIcon("e838",{type:"fill"})}</div><div class="item-select">${util.getGoogleIcon("e5ca")}</div>`,p.append(t),t.onclick=function(){var e=util.query(p,".item.act");e&&e.classList.remove("act"),this.classList.add("act")}}))})),setTimeout((()=>{g.open()}))}(t,e)}}]}),g=null,h=null,p=null;function m(e){var t=util.element("li");return t.innerHTML=`<a href="${e.url}" target="_blank" rel="noopener noreferer"><img/><p></p></a>`,util.query(t,"p").innerText=e.title,util.getFavicon(e.url,(i=>{util.query(t,"img").src=i||util.createIcon(e.title[0])})),t.oncontextmenu=function(e){e.preventDefault(),e.stopPropagation(),r(),a=this,u.setOffset({top:e.pageY,left:e.pageX}),this.classList.add("menued"),u.show()},s(t),t}function y(e,t){if(!d){var s=(d=new dialog({class:"link-add-dialog",content:'<form><h1></h1><div class="content"><p>URL ：<input class="link-add-url" type="text" required placeholder="链接地址(必填)"></p><p>标题：<input class="link-add-title" type="text" required placeholder="链接标题(必填)"></p><p>位置：<input class="link-add-index" type="number" min="0" placeholder="链接位置"></p></div><div class="footer"><div class="cancel btn">取消</div><button class="ok btn"></button></div></form>'})).getDialogDom();util.query(s,".cancel.btn").onclick=function(e){e.preventDefault(),d.close()}}setTimeout((()=>{d.open();var s=d.getDialogDom(),a=n.length;function o(e,t,i,n,a,o,l){util.query(s,"h1").innerHTML=e,util.query(s,".ok.btn").innerHTML=t,util.query(s,"input.link-add-url").value=i,util.query(s,"input.link-add-title").value=n,util.query(s,"input.link-add-index").setAttribute("max",a),util.query(s,"input.link-add-index").value=o,util.query(s,"form").onsubmit=l}-1==e?o("添加链接","添加","","",a,a,(e=>{e.preventDefault();var n=util.query(s,".link-add-url").value;-1==n.indexOf("://")&&(n="http://"+n);var o=util.query(s,".link-add-title").value,l=util.query(s,".link-add-index").value;l=""==l?a:l-0,i.addLink({url:n,title:o,index:l,cate:t},(e=>{0!=e.code?toast.show(e.msg):(toast.show("添加成功"),d.close())}))})):o("修改链接","修改",n[e].url,n[e].title,a-1,e,(n=>{n.preventDefault();var a=util.query(s,".link-add-url").value;-1==a.indexOf("://")&&(a="http://"+a);var o=util.query(s,".link-add-title").value,l=util.query(s,".link-add-index").value;l=""==l?e:l-0,i.changeLink(t,e,{url:a,title:o,index:l},(e=>{0!=e.code?toast.show(e.msg):(toast.show("修改成功"),d.close())}))}))}))}e.get("linksize")||e.set("linksize","m"),e.get("linkstyle")||e.set("linkstyle","round"),e.get("linkpailie")||e.set("linkpailie","a");var v=new SettingItem({type:"select",title:"链接大小",message:"修改链接显示的大小",init:()=>({xs:"很小",s:"小",m:"中",l:"大",xl:"很大"}),get:()=>e.get("linksize"),callback(t){e.set("linksize",t),w(t)}}),f=new SettingItem({type:"select",title:"链接样式",message:"修改链接显示的样式",init:()=>({def:"圆方",round:"圆形",square:"方形"}),get:()=>e.get("linkstyle"),callback(t){e.set("linkstyle",t),k()}}),b=new SettingItem({type:"select",title:"链接排列",message:"修改链接的排列方式",init:()=>({a:"靠左",b:"居中"}),get:()=>e.get("linkpailie"),callback(t){e.set("linkpailie",t),k()}});function k(){o.className="links "+e.get("linkstyle")+" "+e.get("linkpailie")}function w(e){util.query(o,".link-list").className="link-list "+e}return l.addNewItem(v),l.addNewItem(f),l.addNewItem(b),i.on("change",(e=>{var t=util.query(o,".cate-bar-items .cate-item.active");if(e.cate==t.innerText||null==e.cate&&t.classList.contains("mr"))if("add"==e.type){var i=m(e.detail);util.query(o,".link-list").insertBefore(i,util.query(o,".link-list .link-add")),n.push(e.detail)}else if("change"==e.type){if(!e.other||!e.other.justindex){n.splice(e.index,1),n.splice(e.detail.index,0,e.detail);var s=util.query(o,".link-list li",!0),a=s[e.index];util.query(o,".link-list").insertBefore(a,s[e.detail.index+1]),util.query(a,"a").href=e.detail.url,util.query(a,"p").innerText=e.detail.title,util.getFavicon(e.detail.url,(t=>{util.query(a,"img").src=t||util.createIcon(e.detail.title[0])}))}}else if("delete"==e.type){(i=util.query(o,".link-list li",!0)[e.index]).remove(),n.splice(e.index,1)}})),{drawLinks:function(e){i.getLinks(e,(e=>{n=e.data,e.data.forEach((e=>{var t=m(e);util.query(o,".link-list").append(t)}));var t=util.element("li",{class:"link-add"});t.innerHTML='<a href="javascript:void(0)" class="material-symbols-outlined">&#xe145;</a>',util.query(o,".link-list").append(t),t.onclick=()=>{var e=util.query(o,".cate-bar-items .cate-item.active");y(-1,e=e.classList.contains("mr")?null:e.innerText)}}))},dstyle:k,dsize:w,getMenuedLi:()=>a,linkSizeSi:v}})();return a(),{isShowCate:()=>e.get("enabledCate"),setShowCate(t){e.set("enabledCate",t),u(t),h.reGet()},getLinkSize:()=>e.get("linksize"),setLinkSize(t){-1!=["xs","s","m","l","xl"].indexOf(t)&&(e.set("linksize",t),y(t),f.reGet())},cateWidthShiPei:g}})();return i.on("change",(function(t){e.websync(t)})),util.joinObj(i,c)})(),says=(()=>{var e=storage("says",{sync:!0,title:"一言",desc:"QUIK起始页一言相关配置",get:async()=>{var t=e.getAll(),i=quik.addon.getAddonBySessionId(t.saytype);return i&&(t.requireAddon=i.url),t},rewrite:(e,t,i)=>new Promise(((n,s)=>{if(i.requireAddon){var a=quik.addon.getAddonByUrl(i.requireAddon);a?(i.saytype=a.session.id,e[t]=i,n()):confirm("该一言数据需要安装插件以同步，是否安装？",(s=>{s?quik.addon.installAddon(i.requireAddon).then((s=>{i.saytype=s.session.id,e[t]=i,n()})).catch((e=>{alert(0==e?"插件取消安装，同步取消":"插件安装失败，同步取消",(()=>{n()}))})):alert("已取消一言同步",(()=>{n()}))}))}else e[t]=i,n()}))}),t=util.element("div",{class:"says"});util.query(document,"main").appendChild(t),t.innerHTML=`<div class="say-inner"></div><div class="say-control">${util.getGoogleIcon("e5d4")}</div>`;var i=util.query(t,"div.say-inner"),n=util.query(t,"div.say-control"),s=new menu({list:[]}),a=new dialog({content:`<div class="closeBtn">${util.getGoogleIcon("e5cd")}</div><ul></ul>`,class:"says_info"}),o=a.getDialogDom();util.query(o,"div.closeBtn").onclick=()=>{a.close()};var l,r={},c={};function d(e){r[e.key]={name:e.name,callback:e.callback,click:e.click||(()=>{}),menu:e.menu||[{icon:util.getGoogleIcon("e14d"),title:"复制",click(){var e=c.say;util.copyText(e)}}]}}function u(t,n){if(util.checkSession(t)&&(t=t.id),!r[t])throw"type不存在 type:"+t;e.set("saytype",t),s.setList(r[t].menu),i.onclick=r[t].click,g(t,n),y.reGet()}function g(e,t){if(util.checkSession(e)&&(e=e.id),!r[e])throw"key不存在";i.innerText="...",i.title="加载中",r[e].callback().then((e=>{i.innerText=e.say,i.setAttribute("title",e.title),c=e,t&&t()}))}function h(e){util.query(o,"ul").innerHTML=(()=>{var t="";for(var i in e)t+="<li><b>"+i+":</b> "+e[i]+"</li>";return t})(),a.open()}d((()=>{e.get("usersay")||e.set("usersay","海内存知己，天涯若比邻");var t=null;function i(){if(!t){var i=(t=new dialog({class:"sayseditordialog",content:'<h1>修改一言</h1><div class="content"><p><input class="says-input" type="text"/></p></div><div class="footer"><div class="cancel btn">取消</div><button class="ok btn">确定</button></div>'})).getDialogDom();util.query(i,".cancel.btn").onclick=()=>{t.close()},util.query(i,".ok.btn").onclick=()=>{var n=util.query(i,".says-input").value;e.set("usersay",n),g("user"),t.close()}}setTimeout((()=>{var i=t.getDialogDom();t.open(),util.query(i,".says-input").value=e.get("usersay")}))}return{key:"user",name:"用户自定义",callback:()=>new Promise(((t,i)=>{t({say:e.get("usersay"),title:"点击修改"})})),click(){i()},menu:[{icon:util.getGoogleIcon("e3c9"),title:"修改",click(){i()}},{icon:util.getGoogleIcon("e14d"),title:"复制",click(){var e=c.say;util.copyText(e)}}]}})()),d((l={load(e){var t=0;!function i(){util.xhr("https://v1.hitokoto.cn/",(t=>{e(JSON.parse(t))}),(()=>{++t<=5&&i()}))}()},cats:{a:"动画",b:"漫画",c:"游戏",d:"文学",e:"原创",f:"来自网络",g:"其他",h:"影视",i:"诗词",j:"网易云",k:"哲学",l:"抖机灵"}},{key:"hitokoto",name:"随机一言",callback:()=>new Promise(((e,t)=>{l.load((t=>{e({say:t.hitokoto,from:t.from,uuid:t.uuid,cat:t.type,from_who:t.from_who,title:"该一言来自"+t.from+"，由"+t.from_who+"上传"})}))})),click(){g("hitokoto")},menu:[{icon:util.getGoogleIcon("e5d5"),title:"刷新",click(){g("hitokoto")}},{icon:util.getGoogleIcon("e14d"),title:"复制",click(){var e=c.say;util.copyText(e)}},{icon:util.getGoogleIcon("e88e"),title:"一言详情",click(){var e=l.cats[c.cat];h({API:"Hitokoto (hitokoto.cn)","内容":c.say,"来源":c.from,"上传者":c.from_who,"分类":e||"未知",UUID:c.uuid})}}]})),d((()=>{var e=storage("jrsc"),t={},i="jinrishici-token";function n(e,t){var i=new XMLHttpRequest;i.open("get",t),i.withCredentials=!1,i.send(),i.onreadystatechange=()=>{if(4===i.readyState){var t=JSON.parse(i.responseText);"success"===t.status&&e(t)}}}return t.load=t=>{var s=e.get(i);return s?n(t,"https://v2.jinrishici.com/one.json?client=browser-sdk/1.2&X-User-Token="+encodeURIComponent(s)):n((n=>{e.set(i,n.token),t(n)}),"https://v2.jinrishici.com/one.json?client=browser-sdk/1.2")},{key:"jinrishici",name:"今日诗词",callback:()=>new Promise(((e,i)=>{t.load((t=>{e({say:t.data.content,author:"("+t.data.origin.dynasty+")"+t.data.origin.author,p_title:"《"+t.data.origin.title+"》",tags:t.data.matchTags.join(" "),content:"<br>"+t.data.origin.content.join("<br>"),title:"摘自"+t.data.origin.dynasty+"·"+t.data.origin.author+"的《"+t.data.origin.title+"》"})}))})),click(){g("jinrishici")},menu:[{icon:util.getGoogleIcon("e5d5"),title:"刷新",click(){g("jinrishici")}},{icon:util.getGoogleIcon("e14d"),title:"复制",click(){var e=c.say;util.copyText(e)}},{icon:util.getGoogleIcon("e88e"),title:"诗词详情",click(){h({API:"今日诗词（jinrishici.com）","内容":c.say,"作者":c.author,"标题":c.p_title,"全部内容":c.content})}}]}})()),setTimeout((()=>{addon.on("allrun",(()=>{p&&(e.set("saytype","user"),g("user"),alert("您的一言数据由于插件缺失无法显示，已为您切换为默认。"))}))})),n.onclick=e=>{e.stopPropagation();var t=n.getBoundingClientRect();s.setOffset({bottom:window.innerHeight-t.top,left:t.left-90+t.width}),s.show()},e.get("saytype")||e.set("saytype","user"),null==e.get("enabled")&&e.set("enabled",!0);var p,m=new SettingGroup({title:"一言",index:3}),y=new SettingItem({title:"一言类型",type:"select",index:1,message:"页面底部显示的一言类型",init(){var e={};for(var t in r)e[t]=r[t].name;return e},callback(e){u(e)},get:()=>e.get("saytype")}),v=new SettingItem({title:"显示一言",type:"boolean",message:"是否页面底部显示的一言",index:0,callback(i){e.set("enabled",i),i?(u(e.get("saytype")),t.style.display="",y.show()):(t.style.display="none",y.hide())},get:()=>e.get("enabled")});if(mainSetting.addNewGroup(m),m.addNewItem(y),m.addNewItem(v),e.get("enabled")){var f=e.get("saytype");r[f]?(s.setList(r[f].menu),i.onclick=r[f].click,g(f)):p=f}else t.style.display="none",y.hide();return{getNowSay:function(){return c},setSayType:u,addSayType:function(e){if(!util.checkSession(e.session))throw"错误的session";var t;e.key=e.session.id,d(e),y.reInit(),(t=e.key)==p&&(s.setList(r[t].menu),i.onclick=r[t].click,g(t),p=null)}}})(),card=(()=>{var e=util.query(document,".cards"),t=util.query(document,".top.cards"),i=function(i){this.width=i.width,this.height=i.height,this.offset=i.offset;var n=util.element("div",{class:"card"});n.innerHTML=i.content,n.style.width=i.width+"px",n.style.height=i.height+"px",i.class&&n.classList.add(i.class),i.offset&&("number"==typeof i.offset.top?n.style.top=i.offset.top+"px":"number"==typeof i.offset.bottom&&(n.style.bottom=i.offset.bottom+"px"),"number"==typeof i.offset.left?n.style.left=i.offset.left+"px":"number"==typeof i.offset.right&&(n.style.right=i.offset.right+"px")),this.el=n,i.topper?t.appendChild(n):e.appendChild(n),this.isShow=!1};return i.prototype={show(e){var t=this;t.isShow=!0,this.el.style.display="block",e&&e>0&&(this.el.style.transition="all "+e+"ms",this.el.offsetHeight,setTimeout((()=>{t.el.style.transition="none"}),e)),this.el.style.opacity="1"},hide(e){var t=this;t.isShow=!1,e&&e>0?(this.el.style.transition="all "+e+"ms",setTimeout((()=>{t.el.style.transition="none",t.el.style.display="none"}),e)):this.el.style.display="none",this.el.style.opacity="0"},destroy(){this.el.remove()},getCardDom(){return this.el},getOffset(){return this.offset},getWidth(){return this.width},getHeight(){return this.height},setWidth(e){this.width=e,this.el.style.width=e+"px"},setHeight(e){this.el.style.height=e+"px"},setOffset(e,t){var i=this,n=this.offset;if(t&&t>0){this.el.style.transition="all "+t+"ms";var s=this.el.getBoundingClientRect();"number"==typeof e.top?"number"==typeof n.bottom?this.el.style.bottom=window.innerHeight-e.top-s.height+"px":this.el.style.top=e.top+"px":"number"==typeof e.bottom&&("number"==typeof n.top?this.el.style.top=window.innerHeight-e.bottom-s.height+"px":this.el.style.bottom=e.bottom+"px"),"number"==typeof e.left?"number"==typeof n.right?this.el.style.right=window.innerWidth-e.left-s.width+"px":this.el.style.left=e.left+"px":"number"==typeof e.right&&("number"==typeof n.left?this.el.style.left=window.innerWidth-e.right-s.width+"px":this.el.style.right=e.right+"px"),setTimeout((()=>{i.el.style.transition="none",a.call(i)}),t)}else a.call(i);function a(){this.offset=e,this.el.style.top="auto",this.el.style.left="auto",this.el.style.bottom="auto",this.el.style.right="auto","number"==typeof e.top?this.el.style.top=e.top+"px":"number"==typeof e.bottom&&(this.el.style.bottom=e.bottom+"px"),"number"==typeof e.left?this.el.style.left=e.left+"px":"number"==typeof e.right&&(this.el.style.right=e.right+"px")}}},i})(),guidecreator={create(e,t,i){if(0!=e.length){var n=new card({content:'<div class="guide-text"></div><div class="btn ok">确定</div>',class:"guide-card",offset:{top:0,left:0},width:200,topper:i}),s=n.getCardDom(),a=0;o(),util.query(s,".btn.ok").addEventListener("click",(()=>{++a>=e.length?(n.hide(300),t()):o()}))}else t();function o(){util.query(s,".guide-text").innerHTML=e[a].text,n.isShow?n.setOffset(e[a].offset,300):(n.setOffset(e[a].offset),n.show(300))}}},fcard=(()=>{var e=util.element("div",{class:"fcard-frame"}),t=!1;e.addEventListener("click",(()=>{t=!0})),document.querySelector("main").append(e);var i=0,n=[];function s(t){this.content=t.content,i++,this.id=i;var s=util.element("div",{class:"fcard"+(t.class?" "+t.class:"")});s.innerHTML='<div class="content">'+this.content+"<div>",e.insertBefore(s,e.firstChild),this.el=s,n.push(this),this.isShow=!0,o.style.display=""}function a(){for(var e=0;e<n.length;e++)if(n[e].isShow)return!1;return!0}s.prototype={show(){this.el.style.display="block",this.isShow=!0,o.style.display=""},hide(){this.el.style.display="none",this.isShow=!1,a()&&(o.style.display="none")},getFCardDom(){return this.el},destroy(){this.el.remove(),this.el=null,n.splice(n.indexOf(this),1),a()&&(o.style.display="none")}},s.getFCardById=e=>{for(var t=0;t<n.length;t++)if(n[t].id==e)return n[t];return null};var o=util.element("div",{class:"fcard-mob-zd"});return o.innerHTML=util.getGoogleIcon("e5cc"),o.style.display="none",document.querySelector("main").append(o),o.onclick=function(i){t=!0,e.classList.add("show"),this.classList.add("hide")},document.addEventListener("click",(()=>{t?t=!1:(e.classList.remove("show"),o.classList.remove("hide"))})),s})(),custom=(initsto=setting.settingSto,eventHandle=getEventHandle(),on=eventHandle.on,off=eventHandle.off,doevent=eventHandle.doevent,lite=(()=>{util.initSet(initsto,"linkblur",!0);var e=new SettingItem({index:2,title:"极简模式",message:"(Alt+X)隐藏所有图标和链接，点击LOGO显示",type:"boolean",get:()=>!!initsto.get("lite"),callback(e){initsto.set("lite",e),n(e)}}),t=new SettingItem({index:3,title:"链接页面背景模糊",message:"链接页面背景一般模糊显示，关闭后正常显示",type:"boolean",get:()=>initsto.get("linkblur"),callback(e){initsto.set("linkblur",e),s(e)}});tyGroup.addNewItem(e),tyGroup.addNewItem(t);var i=util.element("div",{class:"liteback"});function n(e){if(document.body.classList.remove("hiden"),document.body.classList.remove("showall"),e){if(document.body.classList.add("lite"),document.body.classList.add("hiden"),t.show(),!initsto.get("lite_firsted")){var i=document.querySelector("main .logo .imglogo").getBoundingClientRect();guidecreator.create([{text:"点击LOGO就可以显示链接和所有图标",offset:window.innerWidth>600?{top:i.top,left:i.left+i.width+10}:{top:i.top+i.height+10,left:i.left}}],(function(){initsto.set("lite_firsted",!0)}))}}else document.body.classList.remove("lite"),link.cateWidthShiPei(),t.hide()}function s(e){e?document.querySelector("main").classList.remove("noblur"):document.querySelector("main").classList.add("noblur")}return i.innerHTML=util.getGoogleIcon("e5ce"),document.querySelector("main .center").appendChild(i),i.addEventListener("click",(()=>{document.body.classList.remove("showall"),document.body.classList.add("hiden")})),document.querySelector("main .center .logo").addEventListener("click",(()=>{document.body.classList.add("showall"),document.body.classList.remove("hiden"),link.cateWidthShiPei()})),n(initsto.get("lite")),s(initsto.get("linkblur")),{set(t){t=!!t,initsto.set("lite",t),n(t),e.reGet()},get:()=>initsto.get("lite")}})(),logo=(()=>{var e=document.querySelector("main .center .logo");initsto.get("timelogo")?(initsto.set("logo","b"),initsto.remove("timelogo")):initsto.get("logo")||initsto.set("logo","a");var t=new SettingItem({index:4,title:"LOGO样式",message:"切换LOGO显示的内容",type:"select",init:()=>({a:"普通LOGO",b:"LED时间",c:"空"}),get:()=>initsto.get("logo"),callback(e){initsto.set("logo",e),l(e)}}),i=new SettingItem({index:5,title:"显示日期",message:"开启后时间LOGO下方将显示日期",type:"boolean",get:()=>!!initsto.get("timelogo_x"),callback(e){initsto.set("timelogo_x",e),o(e)}});function n(){for(var e="",t=0;t<7;t++)e+='<div class="num_line a'+t+'"></div>';return'<div class="_num">'+e+"</div>"}function s(e,t){for(var i={0:"1110111",1:"0010010",2:"1011101",3:"1011011",4:"0111010",5:"1101011",6:"1101111",7:"1010010",8:"1111111",9:"1111011"}[t],n=0;n<7;n++){var s=util.query(e,".a"+n);"1"==i[n]?s.classList.add("show"):s.classList.remove("show")}}util.query(e,".timelogo .h").innerHTML=util.query(e,".timelogo .m").innerHTML=n()+n();var a=!1;function o(t){a&&(t?util.query(e,".timelogo").classList.add("showxx"):util.query(e,".timelogo").classList.remove("showxx"))}function l(t){util.query(e,".timelogo").style.display="none",util.query(e,".imglogo").style.display="none",i.hide(),"a"==t?util.query(e,".imglogo").style.display="block":"b"==t&&(util.query(e,".timelogo").style.display="block",function(){if(!a){a=!0;var t=()=>{var t=new Date,i=util.b0(t.getHours()).toString(),n=util.b0(t.getMinutes()).toString(),a=util.query(e,".timelogo .h ._num",!0),o=util.query(e,".timelogo .m ._num",!0);s(a[0],i[0]),"1"==i[0]?util.query(e,".timelogo .t").style.marginLeft="-13px":util.query(e,".timelogo .t").style.marginLeft="",s(a[1],i[1]),s(o[0],n[0]),s(o[1],n[1])};setInterval(t,1e3),t();var i=util.element("div",{class:"xxxx"});util.query(e,".timelogo").append(i);var n=new Date;i.innerHTML=n.getFullYear()+" 年 "+(n.getMonth()+1)+" 月 "+n.getDate()+" 日 星期"+"日一二三四五六"[n.getDay()],o(initsto.get("timelogo_x"))}}(),i.show())}return l(initsto.get("logo")),tyGroup.addNewItem(t),tyGroup.addNewItem(i),"b"!=initsto.get("logo")&&i.hide(),{set(e){initsto.set("logo",e),l(e),t.reGet()},get:()=>initsto.get("logo")}})(),color=(()=>{var e=null;initsto.get("theme")||initsto.set("theme","a");var t=new SettingItem({index:1,title:"主题颜色",type:"select",message:"",get:()=>initsto.get("theme"),callback(e){initsto.set("theme",e),n(e)},init:()=>({a:"浅色",b:"深色",c:"跟随时间",d:"跟随系统"})});tyGroup.addNewItem(t);var i=3;function n(t){var n;3!=i&&(i=!1),"b"==t?(document.body.classList.add("dark"),doevent("colorchange",["dark"]),e="dark"):"a"==t?(document.body.classList.remove("dark"),doevent("colorchange",["light"]),e="light"):"c"==t?(new Date).getHours()>=18||(new Date).getHours()<6?(document.body.classList.add("dark"),doevent("colorchange",["dark"]),e="dark"):(document.body.classList.remove("dark"),doevent("colorchange",["light"]),e="light"):"d"==t&&(window.matchMedia?3==i?(i=!0,(n=window.matchMedia("(prefers-color-scheme: dark)")).matches?document.body.classList.add("dark"):document.body.classList.remove("dark"),n.addEventListener("change",(t=>{t.matches?(document.body.classList.add("dark"),doevent("colorchange",["dark"]),e="dark"):(document.body.classList.remove("dark"),doevent("colorchange",["light"]),e="light")}))):i=!0:toast("你的浏览器不支持此功能"))}return n(initsto.get("theme")),{setTheme(e){initsto.set("theme",e),n(e),t.reGet()},on:on,off:off,getTheme:function(){return e}}})(),theme=(()=>{initsto.get("themea")||initsto.set("themea","def");var e=["dark","t-dark","t-light","dialogblur","lite","hiden","showall"],t={def:"默认主题"},i=new SettingItem({index:0,title:"主题",type:"select",message:"",get:()=>initsto.get("themea"),callback(e){initsto.set("themea",e),n(e)},init:()=>t});function n(i){if(-1==e.indexOf(i)&&t[i])return document.body.classList.forEach((t=>{-1==e.indexOf(t)&&document.body.classList.remove(t)})),document.body.classList.add(i),doevent("dotheme",[]),s||(s=!0,a.forEach((e=>e()))),!0}tyGroup.addNewItem(i);var s=!1,a=[],o=!1;return n(initsto.get("themea"))||(o=!0,setTimeout((()=>{addon.on("allrun",(()=>{o&&(initsto.set("themea","def"),n("def"),alert("您的主题由于插件缺失无法显示，已为您切换为默认。"))}))}))),{addTheme:function(e,s){t[e]=s,i.reInit(),o&&e==initsto.get("themea")&&(o=!1,n(e))},removeTheme:function(e){"def"!=e&&(delete t[e],initsto.get("themea")==e&&(initsto.set("themea","def"),i.reGet()),i.reInit())},setTheme:function(e){t[e]&&(initsto.set("themea",e),n(e),i.reGet())},waitdotheme:function(e){s?e():a.push(e)}}})(),dialogblur=(()=>{var e=new SettingItem({index:3,title:"毛玻璃效果",message:"为所有内容开启毛玻璃效果，可能会影响性能。",type:"boolean",get:()=>!!initsto.get("dialogblur"),callback(e){initsto.set("dialogblur",e),t(e)}});function t(e){e?document.body.classList.add("dialogblur"):document.body.classList.remove("dialogblur")}return tyGroup.addNewItem(e),t(initsto.get("dialogblur")),{set(i){i=!!i,initsto.set("dialogblur",i),t(i),e.reGet()},get:()=>initsto.get("dialogblur")}})(),{setLite:lite.set,isLite:lite.get,getColor:color.getTheme,setColor:color.setTheme,setTheme:theme.setTheme,addTheme:theme.addTheme,removeTheme:theme.removeTheme,isTimeLogo:()=>"b"==logo.get(),setTimeLogo(){logo.set("b")},getLogo:logo.get,setLogo:logo.set,isDialogBlur:dialogblur.get,setDialogBlur:dialogblur.set,on:on,off:off,waitdotheme:theme.waitdotheme}),initsto,eventHandle,on,off,doevent,lite,logo,color,theme,dialogblur,background=(()=>{var e=new SettingGroup({title:"背景",index:3}),t=new SettingItem({title:"背景设置",message:"点击设置背景",index:0,type:"null",callback:L});mainSetting.addNewGroup(e),e.addNewItem(t);var i=getEventHandle(),n=i.on,s=i.off,a=i.doevent,o=util.element("div",{class:"bgf"});util.query(document,"body").appendChild(o);var l,r,c,d,u=storage("background",{sync:!0,get:()=>new Promise(((e,t)=>{var i=u.getAll();delete i.upload,"default"!=i.bg.type?i.requireAddon=quik.addon.getAddonBySessionId(i.bg.type).url:"userbg"==i.bg.data.type&&i.userbg.useidb&&(i.bg={type:"default",data:{type:"color",light:"#fff",dark:"#333"}}),i.userbg&&i.userbg.useidb?(delete i.userbg,alert("不支持同步用户上传的背景",(function(){e(i)}))):e(i)})),rewrite:(e,t,i)=>new Promise(((n,s)=>{if(i.requireAddon){var a=quik.addon.getAddonByUrl(i.requireAddon);a?(i.bg.type=a.session.id,e[t]=i,n()):confirm("该背景数据需要安装插件以同步，是否安装？",(s=>{if(s){var a=addon.installAddon(i.requireAddon);a.on("error",(e=>{alert("插件安装失败，同步取消",(()=>{n()}))})),a.on("wait",(e=>{e(!0)})),a.on("done",(s=>{i.bg.type=s.id,e[t]=i,n()}))}else alert("已取消背景同步",(()=>{n()}))}))}else e[t]=i,n()})),title:"背景",desc:"QUIK起始页背景相关配置"}),g=0;util.initSet(u,"bg",{type:"default",data:{type:"color",light:"#fff",dark:"#333"}});var h=(()=>{var t,i,n,s;util.initSet(u,"usercolor",{dark:"#333333",light:"#ffffff"}),util.initSet(u,"ivsetting",{mb:50,isbr:!1,br:6,th:1});var a,o={getImg:function(e){var t="";t=window.innerWidth<=500?"https://img.loliapi.cn/i/pe/img"+(parseInt(3095*Math.random())+1)+".webp":"https://img.loliapi.cn/i/pc/img"+(parseInt(696*Math.random())+1)+".webp",util.loadimg(t,(i=>{i?e({url:t,candownload:!0}):(t="https://loliapi.com/acg/?_="+Date.now(),util.loadimg(t,(()=>{e({url:t,candoanload:!1})})))}))}},l={getImg(e){e({url:"https://tu.ltyuanfang.cn/api/fengjing.php?_="+Date.now(),candoanload:!1})}};if(window.isExt){a=[{thumbnail:"mrbgp1_th.png",img:"mrbgp1.webp"},{thumbnail:"mrbgp2_th.png",img:"mrbgp2.webp"}];for(var r=0;r<a.length;r++)for(var c in a[r])a[r][c]="chrome-extension://"+window.extid+"/assets/"+a[r][c]}else a=[{thumbnail:"https://image.gumengya.com/thumbnails/b0289db9349e17ca66be2e772cc647a5.png",img:"https://image.gumengya.com/i/2024/06/09/66656920a034a.webp"},{thumbnail:"https://image.gumengya.com/thumbnails/18231c314c064e8c5059debae2506a77.png",img:"https://image.gumengya.com/i/2024/08/12/66b9bd00d60ea.webp"}];var g=new iconc.icon({content:util.getGoogleIcon("e86a"),offset:"br",important:!0}),h=new iconc.icon({content:util.getGoogleIcon("f090"),offset:"br"});h.getIcon().onclick=()=>{window.open(document.querySelector(".bgf img").src)};var p=new iconc.icon({content:util.getGoogleIcon("e88e"),offset:"br",important:!0}),m=new card({content:'<div class="copyright">...</div>\n      <div class="second">...</div>\n      <div class="title">...</div>\n      <a class="link" target="_blank" href="https://www.bing.com/">去Bing搜索</a>',offset:{right:5,bottom:50},class:"bing_info"});p.getIcon().onclick=()=>{var e;m.isShow?m.hide(400):(m.show(400),e=function(e){var t=m.getCardDom();util.query(t,".copyright").innerText=e.copyright,util.query(t,".second").innerText=e.second_copyright,util.query(t,".title").innerText=e.title,util.query(t,".link").href=e.link},y?e(y):util.xhr("https://bing.shangzhenyang.com/api/json",(t=>{var i=(t=JSON.parse(t)).images[0],n=i.copyright.split("(");n[1]="("+n[1],y={copyright:n[0],second_copyright:n[1],link:i.copyrightlink,title:i.title},e(y)}),(()=>{e({copyright:"加载失败",second_copyright:"(© Bing)",link:"https://www.bing.com/",title:"点击前往必应"})})))},p.getIcon().title="显示壁纸详情",g.getIcon().onclick=function(){var e=document.querySelector(".bgf .full img");e&&(e.style.opacity="0");var t=this;setTimeout((()=>{refreshFn.call(t)}),300)};var y,v=new iconc.icon({content:util.getGoogleIcon("e8f4",{type:"fill"}),offset:"br"});function f(){document.querySelector("main").style.display="block",setTimeout((()=>{document.querySelector("main").style.opacity=1}),10),document.querySelector(".bgf .cover").style.opacity="",document.removeEventListener("click",f)}function b(){var e=new Date;return{light:`rgb(${256-e.getHours()},${256-e.getMinutes()},${256-e.getSeconds()})`,dark:`rgb(${e.getHours()},${e.getMinutes()},${e.getSeconds()})`}}v.getIcon().onclick=function(e){e.preventDefault(),e.stopPropagation(),document.querySelector("main").style.opacity=0,setTimeout((()=>{document.querySelector("main").style.display="none"}),300),document.querySelector(".bgf .cover").style.opacity=0,document.addEventListener("click",f)},v.getIcon().title="查看壁纸";var k,w,{ImgOrVideoSi:q,checkBgCoverStyle:x}=(()=>{var t=new SettingItem({title:"背景图片/视频显示设置",message:"设置背景图片/视频显示的蒙版和模糊等",type:"null",callback(){i.open()}});e.addNewItem(t);var i=new Setting({title:"背景图片/视频显示设置"}),n=new SettingGroup({title:"通用",index:0}),s=new SettingItem({title:"背景蒙版颜色主题",index:0,type:"select",init:()=>({0:"跟随主题",1:"黑色",2:"白色"}),get(){var e=u.get("ivsetting").th;return void 0===e?1:e},callback(e){var t=u.get("ivsetting");t.th=parseInt(e),u.set("ivsetting",t),r()}}),a=new SettingItem({title:"背景蒙版浓度",index:1,type:"range",init:()=>[0,90],get:()=>u.get("ivsetting").mb,callback(e){var t=u.get("ivsetting");t.mb=e,u.set("ivsetting",t),r()}}),o=new SettingItem({title:"背景模糊",message:"可能会影响性能",type:"boolean",index:2,get:()=>u.get("ivsetting").isbr,callback(e){e?l.show():l.hide();var t=u.get("ivsetting");t.isbr=e,u.set("ivsetting",t),r()}}),l=new SettingItem({title:"背景模糊程度",index:3,type:"range",init:()=>[1,20],get:()=>u.get("ivsetting").br,callback(e){var t=u.get("ivsetting");t.br=e,u.set("ivsetting",t),r()}});function r(){if(document.querySelector(".bgf .img-sp")||document.querySelector(".bgf .video-sp")){var e=u.get("ivsetting"),t=document.querySelector("#ivbgse");t||((t=document.createElement("style")).id="ivbgse",document.head.append(t));var i="",n="";1==e.th?(d(),n="0,0,0",document.body.classList.add("t-dark"),document.body.classList.remove("t-light")):2==e.th?(d(),n="255,255,255",document.body.classList.remove("t-dark"),document.body.classList.add("t-light")):0==e.th&&(!function(){if(c)return;c=!0,setTimeout((()=>{quik.custom.on("colorchange",g)}))}(),"dark"==custom.getColor()?(document.body.classList.add("t-dark"),document.body.classList.remove("t-light"),n="0,0,0"):(document.body.classList.remove("t-dark"),document.body.classList.add("t-light"),n="255,255,255")),i+=".img-sp .cover,.video-sp .cover{background-color:rgba("+n+","+e.mb/100+")}",e.isbr&&(i+=".img-sp .cover,.video-sp .cover{backdrop-filter:blur("+e.br+"px)}"),t.innerHTML=i}}i.addNewGroup(n),n.addNewItem(s),n.addNewItem(a),n.addNewItem(o),n.addNewItem(l),u.get("ivsetting").isbr||l.hide();var c=!1;function d(){c&&(c=!1,setTimeout((()=>{quik.custom.off("colorchange",g)})))}function g(e){var t=u.get("ivsetting"),i=document.querySelector("#ivbgse"),n="",s="";"dark"==e?(document.body.classList.add("t-dark"),document.body.classList.remove("t-light"),n="0,0,0"):(document.body.classList.remove("t-dark"),document.body.classList.add("t-light"),n="255,255,255"),s+=".img-sp .cover,.video-sp .cover{background-color:rgba("+n+","+t.mb/100+")}",t.isbr&&(s+=".img-sp .cover,.video-sp .cover{backdrop-filter:blur("+t.br+"px)}"),i.innerHTML=s}return r(),{ImgOrVideoSi:t,checkBgCoverStyle:r}})(),L=null,T={img(e,t){e.innerHTML='<div class="img-sp full"><div class="cover"></div><img src="'+(t.url||a[t.index].img)+'"/></div>',e.querySelector("img").onload=function(){this.style.opacity="1"},x(),q.show(),v.show()},video(e,t){e.innerHTML='<div class="video-sp full"><div class="cover"></div><video src="" muted loop></video></div>',util.query(e,".video-sp video").src=t.url||a[t.index].img,util.query(e,".video-sp video").oncanplay=function(){this.play(),this.style.opacity="1"},x(),q.show(),v.show()},color(e,t){if(e.innerHTML='<div class="color-sp full"></div>',!util.query(document.head,"style.colorSpControl")){var i=document.createElement("style");i.className="colorSpControl",document.head.appendChild(i)}util.query(document.head,"style.colorSpControl").innerHTML=`.color-sp{background-color:${t.light};}body.dark .color-sp{background-color:${t.dark};}`},api:function(e,t){function i(t){g.show(),g.getIcon().classList.add("round-anim"),t.getImg((t=>{g.getIcon().classList.remove("round-anim"),T.img(e,{url:t.url}),t.candownload&&h.show()})),refreshFn=()=>{g.getIcon().classList.add("round-anim"),t.getImg((t=>{g.getIcon().classList.remove("round-anim"),T.img(e,{url:t.url}),t.candownload&&h.show()}))}}switch(t.api){case"acg":i(o);break;case"fj":i(l);break;case"bing":T.img(e,{url:"https://bing.shangzhenyang.com/api/1080p"}),h.show(),p.show();break;case"time":L=setInterval((()=>{T.color(e,b())}),200)}},userbg(e,t){var i=u.get("userbg");if(i)if(document.body.classList.add("t-dark"),"video"==i.type)i.useidb?u.get("upload",!0,(t=>{T.video(e,{url:URL.createObjectURL(t)})})):T.video(e,{url:i.url});else if("image"==i.type){i.useidb?u.get("upload",!0,(t=>{T.img(e,{url:URL.createObjectURL(t)})})):T.img(e,{url:i.url})}},zdy(e,t){if(util.query(e,".zdy-sp")||(e.innerHTML='<div class="zdy-sp full"></div>'),!util.query(document.head,"style.zdySpControl")){var i=document.createElement("style");i.className="zdySpControl",document.head.appendChild(i)}util.query(document.head,"style.zdySpControl").innerHTML=`.zdy-sp{background:${t.light};}body.dark .zdy-sp{background:${t.dark};}`}},{getVideoCaptrue:S,getUserUploadUrl:I,hasUploadedImg:_,uploadIov:E}=(()=>{var e,n;function s(e){var t=u.get("userbg");if(t){if("video"==t.type)if(t.useidb)u.get("upload",!0,(t=>{a(URL.createObjectURL(t),(function(t){e(t)}))}));else try{a(t.url,(t=>{e(t)}))}catch(t){e(!1)}else if("image"==t.type){t.useidb?u.get("upload",!0,(t=>{e(URL.createObjectURL(t))})):e(t.url)}}else e(!1)}function a(e,t){var i=document.createElement("video");i.src=e,i.crossOrigin="anonymous",i.onloadedmetadata=function(){var e=document.createElement("canvas"),n=e.getContext("2d");e.width=i.videoWidth,e.height=i.videoHeight,i.currentTime=i.duration/4,i.oncanplay=function(){n.drawImage(i,0,0,e.width,e.height),t(e.toDataURL("image/png")),this.remove()}}}return{hasUploadedImg:function(){return!!u.get("userbg")},getUserUploadUrl:s,getVideoCaptrue:a,uploadIov:function(a){if(e?e.open():(e=new dialog({content:'<form><h1>上传背景</h1><div class="content"><p>背景类型：<input type="radio" class="uploadi" name="uploadiov" checked="checked"> 图片 <input type="radio" class="uploadv" name="uploadiov"> 视频</p><p>背景URL：<input type="url" placeholder="URL"></p><p class="tip">或者</p><p>从本地选择文件：</p><p class="pddb"><input type="file"></p><p></p></div><div class="footer"><div class="cancel btn">取消</div><button class="ok btn">确定</button></div></form>',class:"iovuploader"}),n=e.getDialogDom(),storage.checkIDB()||(util.query(n,".pddb").innerHTML+='<span style="color:red;font-size:12px;">您的浏览器版本过低，无法上传本地文件作背景</span>',util.query(n,".pddb input").style.display="none"),util.query(n,".cancel").onclick=t=>{t.preventDefault(),e.close()},util.query(n,"form").onsubmit=a=>{a.preventDefault();var o=util.query(n,".uploadi").checked?"image":"video",l=util.query(n,'input[type="url"]').value,r=util.query(n,'input[type="file"]').files[0];util.query(d,".zdy .left img").src="",r?(u.set("upload",r,!0,(function(){e.close(),s((function(e){util.query(d,".zdy .left img").src=e})),i({type:"default",data:{type:"userbg"}})})),u.set("userbg",{type:o,useidb:!0})):(u.set("userbg",{type:o,url:l}),e.close(),s((e=>{util.query(t,".zdy .left img").src=e,i({type:"default",data:{type:"userbg"}})}))),util.query(t,".noBg").style.display="none",util.query(t,".hasBg").style.display="block",util.query(t,".zdy .editbtn").style.display="block"},setTimeout((()=>{e.open()}),10)),a){var o=u.get("userbg");o&&(util.query(n,'input[type="url"]').value=o.url?o.url:"","image"==o.type?util.query(n,".uploadi").checked=!0:util.query(n,".uploadv").checked=!0)}}}})(),{colorChange:M}={colorChange:function(){k?k.open():(k=new dialog({content:'<form><h1>自定义背景颜色</h1><div class="content"><p>浅色模式：<input type="color" class="lightbgcolor"></p><p>深色模式：<input type="color" class="darkbgcolor"></p></div><div class="footer"><div class="cancel btn">取消</div><button class="ok btn">确定</button></div></form>'}),w=k.getDialogDom(),util.query(w,".cancel").onclick=function(e){e.preventDefault(),k.close()},util.query(w,"form").onsubmit=function(e){e.preventDefault();var t=util.query(w,".lightbgcolor").value,s=util.query(w,".darkbgcolor").value;u.set("color",{light:t,dark:s}),util.query(n,".zdy .color-left").style.backgroundColor=t,util.query(n,".zdy .color-right").style.backgroundColor=s,k.close(),i({type:"default",data:{type:"color",light:t,dark:s}})},setTimeout((()=>{k.open()}),10));var e=u.get("usercolor");util.query(w,".lightbgcolor").value=e.light,util.query(w,".darkbgcolor").value=e.dark}};function C(e){if(util.query(t,".bgitem",!0).forEach((e=>{e.classList.remove("selected")})),util.query(n,".bgitem",!0).forEach((e=>{e.classList.remove("selected")})),"default"==e.type)if("img"==e.data.type)try{util.query(t,`.neizhi .bgitem[data-id="${e.data.index}"]`).classList.add("selected")}catch(e){}else"userbg"==e.data.type?util.query(t,".zdy .bgitem").classList.add("selected"):"api"==e.data.type?"time"==e.data.api?util.query(n,".api .bgitem").classList.add("selected"):util.query(t,`.api .bgitem[data-api="${e.data.api}"]`).classList.add("selected"):"color"==e.data.type&&util.query(n,".zdy .bgitem").classList.add("selected")}function D(){document.body.classList.remove("t-dark"),g.hide(),refreshFn=()=>{},clearInterval(L),h.hide(),q.hide(),p.hide(),v.hide()}return{drawer:{type:"default",init(e){i=e.setbg,t=e.pushBgTab({tab:"图片/视频",content:'<div class="unit-item zdy"><div class="unit-title">自定义</div><div class="unit-content"><div class="bgitem full"><div class="left"><div class="hasBg"><img src="" alt=""></div><div class="noBg"><span class="material-symbols-outlined">&#xf09b;</span></div></div><div class="right"><div class="bg-title">用户自定义背景</div><div class="bg-message">上传任意你喜欢的图片/视频作背景</div></div><div class="editbtn"><div class="btn ok">重新上传</div></div></div></div></div><div class="unit-item neizhi"><div class="unit-title">内置</div><div class="unit-content"></div></div><div class="unit-item api"><div class="unit-title">API</div><div class="unit-content"><div class="bgitem half" data-api="bing"><div class="left"><img data-src="https://bing.shangzhenyang.com/api/1080p" alt="" loading="lazy"></div><div class="right"><div class="bg-title">必应壁纸</div><div class="bg-message">获取必应首页的壁纸作为背景</div></div></div><div class="bgitem half" data-api="acg"><div class="left"><img data-src="https://www.loliapi.com/acg/" alt="" loading="lazy"></div><div class="right"><div class="bg-title">随机二次元壁纸</div><div class="bg-message">获取随机二次元壁纸作为背景，背景提供：loliapi.com</div></div></div><div class="bgitem half" data-api="fj"><div class="left"><img data-src="https://tu.ltyuanfang.cn/api/fengjing.php" alt="" loading="lazy"></div><div class="right"><div class="bg-title">随机风景壁纸</div><div class="bg-message">获取随机风景壁纸作为背景，背景提供：ltyuanfang.cn</div></div></div></div></div><div class="unit-item se"><div class="u-se"><p>背景图片显示设置</p><p class="material-symbols-outlined">&#xe5cc;</p></div></div>'}),_()?(util.query(t,".noBg").style.display="none",I((e=>{util.query(t,".zdy .left img").src=e}))):(util.query(t,".hasBg").style.display="none",util.query(t,".zdy .editbtn").style.display="none"),util.query(t,".zdy .left").addEventListener("click",(()=>{_()?e.setbg({type:e.type,data:{type:"userbg"}}):E()})),util.query(t,".zdy .editbtn").addEventListener("click",(()=>{E(!0)}));var o=util.query(t,".neizhi .unit-content");a.forEach(((t,i)=>{var n=util.element("div",{class:"bgitem def","data-id":i});n.innerHTML='<div class="left"><img data-src="'+t.thumbnail+'" loading="lazy"/></div>',o.appendChild(n),util.query(n,".left").onclick=()=>{e.setbg({type:e.type,data:{type:"img",index:parseInt(n.getAttribute("data-id"))}})}})),util.query(t,".u-se").onclick=()=>{q.callback()},util.query(t,".api.unit-item .left",!0).forEach((t=>{t.addEventListener("click",(()=>{e.setbg({type:e.type,data:{type:"api",api:t.parentElement.getAttribute("data-api")}})}))})),n=e.pushBgTab({tab:"纯色",content:'<div class="unit-item zdy"><div class="unit-title">自定义颜色</div><div class="unit-content"><div class="bgitem full"><div class="left"><div class="color-left color"></div><div class="color-right color"></div></div><div class="right"><div class="bg-title">自定义纯色背景</div><div class="bg-message">将你喜欢的颜色做背景，分亮色和暗色（你也可以都设一个颜色或反着来，但不建议这么做）</div></div><div class="editbtn"><div class="btn ok">编辑</div></div></div></div></div><div class="unit-item api"><div class="unit-title">API</div><div class="unit-content"><div class="bgitem full" data-api="time"><div class="left"><div class="color-left color"></div><div class="color-right color"></div></div><div class="right"><div class="bg-title">时间的颜色</div><div class="bg-message">如果当前时间为12:34:56，那么时间的颜色就是rgb(12,34,56)，在亮色模式下就是rgb(255-12,255-34,255-56)</div></div></div></div></div>'});var l=u.get("usercolor");util.query(n,".zdy .color-left").style.backgroundColor=l.light,util.query(n,".zdy .color-right").style.backgroundColor=l.dark,util.query(n,".zdy .left").onclick=()=>{var t=u.get("usercolor");e.setbg({type:e.type,data:{type:"color",light:t.light,dark:t.dark}})},util.query(n,".zdy .btn").onclick=()=>{M()};var r=b();util.query(n,".api .color-left").style.backgroundColor=r.light,util.query(n,".api .color-right").style.backgroundColor=r.dark,util.query(n,".api .left").onclick=function(){e.setbg({type:e.type,data:{type:"api",api:this.parentElement.getAttribute("data-api")}})},s=e.pushBgTab({tab:"自定义",content:'<p>浅色模式：</p><br><textarea class="gjzdytlight textarea"></textarea><p>深色模式：</p><br><textarea class="gjzdytdark textarea"></textarea> <button class="gjzdysetbtn">设置</button><p class="tip">参见 <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/background" target="_blank">CSS | background属性</a></p>'});var c=u.get("custombglight"),d=u.get("custombgdark");util.query(s,".gjzdytlight").value=c||"",util.query(s,".gjzdytdark").value=d||"",util.query(s,".gjzdysetbtn").onclick=()=>{u.set("custombglight",util.query(s,".gjzdytlight").value),u.set("custombgdark",util.query(s,".gjzdytdark").value),e.setbg({type:e.type,data:{type:"zdy",dark:util.query(s,".gjzdytdark").value,light:util.query(s,".gjzdytlight").value}}),quik.toast.show("设置成功")},setTimeout((()=>{C(quik.background.getbg()),quik.background.on("change",C)}))},cancel(e){e.bgf.innerHTML="",D()},draw(e){var t=e.bgf,i=e.data;D(),T[i.type](t,i)}},draws:T}})(),p=h.drawer,m=[p];function y(e){var t=e.tab,i=util.element("div",{class:"tabitem","data-tab":g.toString()});r.appendChild(i),i.innerHTML=t,i.onclick=function(){v(this.getAttribute("data-tab"))};var n=util.element("div",{class:"scrollitem","data-tab":g.toString()});return c.appendChild(n),n.innerHTML=e.content,g++,n}function v(e){util.query(d,".tabitem",!0).forEach((e=>{e.classList.remove("active")})),util.query(d,".scrollitem",!0).forEach((e=>{e.style.display=""})),util.query(d,'.tabitem[data-tab="'+e+'"]').classList.add("active"),util.query(d,'.scrollitem[data-tab="'+e+'"]').style.display="block"}b(p);var f=0;function b(e){l&&e.init({bgf:o,pushBgTab:y,setbg:x,type:e.type})}var k=null;setTimeout((()=>{addon.on("allrun",(()=>{k&&(k=null,u.set("bg",{type:"default",data:{type:"color",light:"#fff",dark:"#333"}}),q(u.get("bg")),alert("您的背景数据由于插件缺失无法显示，已为您切换为默认。"))}))}));var w=null;function q(e){for(var t=0;t<m.length;t++)if(e.type==m[t].type)return w&&w.type!=m[t].type&&(w.cancel({bgf:o}),w=m[t]),void m[t].draw({bgf:o,data:e.data});k=e}function x(e){u.set("bg",e),q(e),a("change",[e])}function L(){l?l.open():(l=new dialog({content:`<div class="actionbar"><h1>背景设置</h1><div class="closeBtn">${util.getGoogleIcon("e5cd")}</div></div><div class="tab_con"></div><div class="scroll_con"></div>`,class:"bg_d",mobileShowtype:dialog.SHOW_TYPE_FULLSCREEN}),d=l.getDialogDom(),util.query(d,".closeBtn").onclick=()=>{l.close()},r=util.query(d,"div.tab_con"),c=util.query(d,"div.scroll_con"),m.forEach((e=>{b(e)})),setTimeout((()=>{l.open(),v("0")}),10))}return q(u.get("bg")),mainmenu.pushMenu({icon:util.getGoogleIcon("e1bc"),title:"背景设置",click:L},mainmenu.MAIN_MENU_TOP),{pushBgDrawer:function(e){var t=e.session;try{if(!util.checkSession(t))throw"session error"}catch(e){throw new Error("背景Drawer注册失败，Session校验错误。")}var i="bgdrawer-"+f;return f++,e.type=i,m.push(e),b(e),function(e){k&&e.type==k.type&&(e.draw({bgf:o,data:k.data}),k=null)}(e),i},getbg:function(){return u.get("bg")},setbg:x,on:n,off:s,neizhiDraw:{img:h.draws.img,video:h.draws.video,color:h.draws.color}}})(),searchEditor=(()=>{var e;function t(){var t=(e=new dialog({content:'<div class="actionbar"><h1>搜索引擎列表设置</h1><div class="closeBtn">{{close}}</div></div><div class="list"><h2>内置搜索引擎</h2><div class="neizhilist"></div><h2>自定义搜索引擎</h2><div class="searchlist"></div></div><div class="footer"><button class="cancel btn">取消</button> <button class="ok btn">确定</button></div>'.replace("{{close}}",util.getGoogleIcon("e5cd")),mobileShowtype:dialog.SHOW_TYPE_FULLSCREEN,class:"search_editor"})).getDialogDom(),i=omnibox.neizhi,n=omnibox.getSearchTypeList(),s=util.query(t,".neizhilist");for(var a in i){var o=util.element("div",{class:"item","data-k":a});o.innerHTML="<img/><div>"+i[a].name+"</div>",((e,t)=>{util.getFavicon(i[e].link,(e=>{util.query(t,"img").src=e||util.createIcon("s")}))})(a,o),s.append(o),"bing"==a?o.addEventListener("click",(()=>{toast.show("该项不可取消")})):o.addEventListener("click",(function(){this.classList.contains("active")?this.classList.remove("active"):this.classList.add("active")})),n.hasOwnProperty(a)&&(o.classList.add("active"),delete n[a])}var l="";for(var a in n)l+='<div class="item" data-k="'+a+'"><div class="icon"><img/></div><div class="url"><input value="'+n[a]+'"/></div><div class="remove">'+util.getGoogleIcon("e5cd")+"</div></div>";function r(e,t){t||util.getFavicon(n[e.getAttribute("data-k")],(t=>{util.query(e,".icon img").src=t||util.createIcon("s")})),util.query(e,".url input").oninput=function(){try{var e=this.parentElement.parentElement.querySelector(".icon img");util.getFavicon(this.value,(t=>{e.src=t||util.createIcon("s")}))}catch(e){}},util.query(e,".remove").onclick=function(){this.parentElement.remove()}}l+=`<div class="addnewitem">${util.getGoogleIcon("e145")} 添加自定义的搜索引擎</div>`,util.query(t,".searchlist").innerHTML=l,util.query(t,".searchlist .item",!0).forEach((e=>{r(e)})),util.query(t,".searchlist .addnewitem").onclick=()=>{var e=util.element("div",{class:"item","data-k":"user_"+Date.now().toString().slice(3)});e.innerHTML='<div class="icon"><img src="https://cn.bing.com/favicon.ico"/></div><div class="url"><input value="https://cn.bing.com/search?q=%keyword%"/></div><div class="remove">'+util.getGoogleIcon("e5cd")+"</div>",util.query(t,".searchlist").insertBefore(e,util.query(t,".searchlist .addnewitem")),r(e,!0)},util.query(t,".closeBtn").onclick=util.query(t,".cancel.btn").onclick=()=>{e.close()},util.query(t,".ok.btn").onclick=()=>{var i={};util.query(t,".searchlist .item",!0).forEach((e=>{i[e.dataset.k]=e.querySelector(".url input").value})),util.query(t,".neizhilist .item.active",!0).forEach((e=>{i[e.dataset.k]=""})),(n=i)[omnibox.getSearchTypeIndex()]||omnibox.setSearchType("bing"),omnibox.setSearchList(n),e.close(),toast.show("设置成功")}}var i=new SettingItem({title:"自定义搜索引擎",index:0,type:"null",message:"",callback(i){e?e.open():(t(),setTimeout((()=>{e.open()}),10))}});return omnibox.sg.addNewItem(i),{open(){e?e.open():(t(),setTimeout((()=>{e.open()}),10))}}})(),notice=(()=>{var e=document.querySelector(".notice-con"),t=document.querySelector(".no-notice-tip"),i='<div class="notice-actionbar"><div class="notice-title"></div><div class="notice-close-btn">{{close-btn}}</div></div><div class="notice-content"></div><div class="notice-progress"><div class="p"><div></div></div></div><div class="notice-btns"></div>',n=document.querySelector(".focus-notice"),s=0,a=!1;function o(t){var n;this.el=util.element("div",{class:"notice-item"}),e.appendChild(this.el),this.title=t.title,this.content=t.content,this.btns=t.btns||[],this.useprogress=t.useprogress,this.progress=0,(n=this).el.innerHTML=i.replace("{{close-btn}}",util.getGoogleIcon("e5cd")),util.query(n.el,".notice-close-btn").onclick=()=>{n.hide()},d(n),u(n),g(n),h(n)}o.prototype={show(e){t.classList.remove("show"),m(1),clearTimeout(this._timeouthide),this.el.classList.add("show"),this.el.addEventListener("click",(function(e){a=!0}));var i=this;this.el.style.display="block",this.el.style.animation="noticein .3s",e&&setTimeout((()=>{i.hide()}),e)},hide(){this.el.classList.remove("show"),document.querySelector(".notice-con .notice-item.show")||(t.classList.add("show"),m(0)),this.el.style.animation="noticeout .3s";var e=this;this._timeouthide=setTimeout((()=>{e.el.style.display="none"}),300)},focus(){this.show(),function(e){r.push(e),1==r.length&&c()}(this)},destroy(){this.hide();var e=this;setTimeout((()=>{e.el.remove()}),300)},setTitle(e){this.title=e,d(this)},setContent(e){this.content=e,u(this)},setBtn(e){this.btns=e,g(this)},setProgress(e){!this.useprogress||e>1||e<0||(this.progress=e,h(this))}};var l,r=[];function c(){var e=r[0],t=e.el.cloneNode(!0);n.appendChild(t),util.query(t,".notice-close-btn").onclick=function(){clearTimeout(l),t.remove(),e.hide(),r.shift(),r.length>0&&c()},g({el:t,btns:e.btns,hide(){e.hide(),clearTimeout(l),t.remove()},show(){}}),l=setTimeout((()=>{t.remove(),r.shift(),r.length>0&&c()}),3e3)}function d(e){util.query(e.el,".notice-title").innerHTML=e.title}function u(e){util.query(e.el,".notice-content").innerHTML=e.content}function g(e){var t=util.query(e.el,".notice-btns");t.innerHTML="";for(var i=0;i<e.btns.length;i++)(i=>{var n=e.btns[i],s=util.element("div",{class:"btn"+(n.style?" "+n.style:"")});s.innerText=n.text,s.onclick=()=>{n.click(e)},t.appendChild(s)})(i)}function h(e){e.useprogress?util.query(e.el,".notice-progress .p div").style.width=100*e.progress+"%":util.query(e.el,".notice-progress").style.display="none"}var p=new iconc.icon({content:util.getGoogleIcon("e7f4"),offset:"tl",class:"notice-icon"});function m(e){void 0===e?e=s:s=e,window.innerWidth<600&&e?p.show():p.hide()}return window.addEventListener("resize",(()=>{m()})),p.getIcon().addEventListener("click",(()=>{document.querySelector(".notice-sc").classList.add("show")})),document.querySelector(".notice-sc").addEventListener("click",(function(){a?a=!1:this.classList.remove("show")})),m(),(()=>{var e=storage("tuisong");util.initSet(e,"d",0);var t=e.get("d");util.xhr("/quik-notice.json",(i=>{if((i=JSON.parse(i)).date>t){setTimeout((()=>{e.set("d",i.date)}),1e4);var n=new o({content:i.content,title:i.title,btns:i.btns.map((e=>{var t;return t=e.link?()=>{n.hide(),window.open(e.link)}:()=>{n.hide()},{text:e.text,style:e.style,click:t}}))});n.show()}}),(()=>{}))})(),o})();(()=>{var e=storage("safe");function t(){var e,t=location.hash.slice(1);-1!=t.indexOf(";")&&(e=t.split(";")[0],t=t.split(";")[1]),"safe"==t&&(location.hash="#"+(e?e+";":""),window.addon_=!0,alert("已阻止所有插件运行，请修改设置或删除插件"))}window.addEventListener("hashchange",t),window.addEventListener("visibilitychange",(()=>{"hidden"==document.visibilityState?document.body.style.display="none":(document.body.style.display="block",link.cateWidthShiPei())})),t();var i=new SettingGroup({title:"高级",index:5}),n=new SettingItem({title:"性能模式",message:"强制关闭所有滤镜和动画效果",index:1,type:"boolean",get:()=>!!e.get("xnse"),callback(t){e.set("xnse",t),a(t)}});i.addNewItem(n);var s=new SettingItem({title:"清除数据",message:"清除QUIK起始页的所有数据",index:2,type:"null",callback(){confirm("确定要清除所有数据吗？",(e=>{if(e){!function e(){prompt("请在下方输入“clearAll”，并再次确定是否要清除所有数据，此操作无法恢复。",(t=>{if("clearAll"==t){var i=storage("oobe").getAll();localStorage.quik2=JSON.stringify({oobe:i}),localforage.clear().then((()=>{location.reload()}))}else t&&e()}))}()}}))}});function a(e){if(e){var t=util.element("style");t.id="xnse",t.innerHTML="*{filter:none!important;backdrop-filter:none!important;animation:none!important;transition:none!important;}",document.head.append(t)}else try{document.getElementById("xnse").remove()}catch(e){}}i.addNewItem(s),mainSetting.addNewGroup(i),a(!!e.get("xnse")),window.addEventListener("offline",r),window.addEventListener("online",r);var o=new iconc.icon({content:util.getGoogleIcon("f239"),offset:"br",important:!0});o.getIcon().style.color="red";var l=new notice({title:"断网提醒",content:"您的网络已断开，请尽快重连！"});function r(){window.navigator.onLine?(l.hide(),o.hide()):(l.show(),l.focus(),o.show())}r()})();var addon=(()=>{if(new iconc.icon({offset:"tr",content:util.getGoogleIcon("e87b",{type:"fill"})}).getIcon().onclick=()=>{storage.checkIDB()?e?e.open():(!function(){var s=(e=new dialog({content:'<div class="addon-bar"><div class="l"><div class="item active" data-p="0">插件管理</div><div class="item" data-p="1">插件市场</div></div><div class="r"><div class="add-btn">{{add-btn}}</div><div class="closeBtn">{{close-btn}}</div></div></div><div class="content"><div class="p gl" style="display:block"><ul></ul></div><div class="p ma"><div class="addon-search-box"><input type="text" placeholder="搜索插件"> <button>{{search}}</button></div><ul><div class="loading-p"><div class="g"></div></div></ul></div></div>'.replace("{{close-btn}}",util.getGoogleIcon("e5cd")).replace("{{search}}",util.getGoogleIcon("e8b6")).replace("{{add-btn}}",util.getGoogleIcon("e145")),mobileShowtype:dialog.SHOW_TYPE_FULLSCREEN,class:"addon-dialog"})).getDialogDom();util.query(s,".closeBtn").addEventListener("click",(()=>{e.close()}));var a=new menu({list:[{icon:util.getGoogleIcon("e157"),title:"从第三方链接添加插件",click(){prompt("请输入插件链接",(e=>{if(!e)return!1;var t=i.installByUrl(e),s=new n;return s.show(),s.bind(t),t.on("done",(e=>{alert("安装成功")})),!0}))}},{icon:util.getGoogleIcon("e66d"),title:"从第三方文件添加插件",click(){showOpenFilePicker().then((e=>{var t=e[0],s=(t.name,new FileReader),a=new n;a.show(),s.onload=function(){var e=i.installByLocal(s.result);a.bind(e),e.ondone=e=>{installing_notice.destroy(),alert("安装成功")}},s.readAsText(t)}))}},{icon:util.getGoogleIcon("e86f"),title:"添加开发者端口",click(){window.isExt?prompt("请输入开发者端口链接",(e=>{if(!e)return!1;i.installByDev(e),alert("安装成功")})):alert("请在浏览器扩展中安装开发端口")}}],offset:{top:0,left:0}});util.query(s,".add-btn").addEventListener("click",(function(e){e.stopPropagation();var t=this.getBoundingClientRect();a.setOffset({top:t.top+t.height,right:window.innerWidth-t.left-t.width}),a.show()}));var o=util.query(s,".addon-bar .l .item",!0),l=util.query(s,".content .p",!0);o.forEach((e=>{e.onclick=function(){o.forEach((e=>{e.classList.remove("active")})),this.classList.add("active"),l.forEach((e=>{e.style.display=""})),l[this.dataset.p].style.display="block"}}));var r=util.query(s,".content .p.gl ul");function c(e){var n=i.getAddonBySessionId(e);"dev"==n.type&&(n.name="开发者端口："+n.url,n.author="dev",n.desc="开发者端口："+n.url);var s=util.query(r,'li[data-id="'+e+'"]');s||((s=util.element("li")).innerHTML='<div class="n"><img src="{deficon}" alt="" onerror="this.src=\'{deficon}\'"><div class="ds"><div class="name"><span></span><div class="official_state">官方</div><div class="disabled_state">已禁用</div></div><div class="message"><span></span> <span></span> <span></span></div></div></div><div class="d"><div class="desc"></div><div class="website"></div><div class="controls"><div class="btn ch_update">检查更新</div><div class="btn update">更新</div><div class="btn enable">启用</div><div class="btn disable">禁用</div><div class="btn uninstall" style="display:block">卸载</div></div></div>'.replace(/{deficon}/g,t),s.dataset.id=e,r.appendChild(s),s.onclick=function(e){r.querySelectorAll("li").forEach((e=>{e.classList.remove("active")})),this.classList.add("active")},util.query(s,".ch_update").onclick=function(){o.innerHTML="检查更新中...";var t=this;t.style.display="",i.checkUpdate(e).then((e=>{e?(o.innerHTML="发现新版本",util.query(s,".update").style.display="block"):(t.style.display="block",o.innerHTML="已是最新版本")}))},util.query(s,".update").onclick=function(){o.innerHTML="更新中...";var t=this;t.style.display="",i.update(e).then((i=>{i.error?(o.innerHTML="更新失败:"+i.msg,t.style.display="block"):(c(e),o.innerHTML="更新完成，刷新生效",util.query(s,".ch_update").style.display="inline-block")}))},util.query(s,".enable").onclick=function(){o.innerHTML="已启用，刷新生效",i.enable(e),util.query(s,".disable").style.display="block",util.query(s,".disabled_state").style.display="none",this.style.display=""},util.query(s,".disable").onclick=function(){o.innerHTML="已禁用，刷新生效",i.disable(e),util.query(s,".enable").style.display="block",util.query(s,".disabled_state").style.display="",this.style.display=""},util.query(s,".uninstall").onclick=function(){confirm("你真的要卸载吗？此操作不可恢复！",(function(t){t&&(o.innerHTML="正在卸载...",i.uninstall(e).then((e=>{e.error?alert("卸载出现错误："+e.msg):alert("卸载成功，刷新生效")})))}))}),util.query(s,".n>img").src=n.icon||t,util.query(s,".n .ds .name span").innerText=n.name;var a=util.query(s,".n .ds .message span",!0);a[0].innerText=n.author||"不详",a[1].innerText=n.version||"",a[2].innerText="",util.query(s,".d .desc").innerText=n.desc||"",util.query(s,".d .website").innerText=n.website||"";var o=util.query(s,".message span",!0)[2];n.type||(util.query(s,".ch_update").style.display="block"),n.disabled?(util.query(s,".enable").style.display="block",util.query(s,".disabled_state").style.display=""):(util.query(s,".disable").style.display="block",util.query(s,".disabled_state").style.display="none"),n.marketId?util.query(s,".official_state").style.display="":util.query(s,".official_state").style.display="none"}i.getAddonList().forEach((e=>{c(e)})),i.on("installnew",(e=>{c(e.id)})),i.on("update",(e=>{c(e.id)})),i.on("uninstall",(e=>{var t=util.query(r,'li[data-id="'+e.id+'"]');t&&t.remove()}));var d=util.query(s,".content .p.ma ul"),u=!1;function g(){i.loadMarketData().then((e=>{for(var t in d.querySelector(".loading-p").remove(),e)h(e[t],t)})).catch((()=>{d.innerHTML='<p>加载失败，点击<a href="javascript:;">重试</a></p>',util.query(d,"a").onclick=()=>{d.innerHTML='<div class="loading-p"><div class="g"></div></div>',g()}}))}function h(e,n){var s=util.element("li");s.innerHTML='<div class="n"><img src="{deficon}" alt="" onerror="this.src=\'{deficon}\'"><div class="ds"><div class="name"><span></span><div class="official_state">官方</div></div><div class="message"><span></span> <span></span> <span></span></div></div></div><div class="d"><div class="desc"></div><div class="website"></div><div class="controls"><div class="btn installed">已安装</div><div class="btn update">更新</div><div class="btn install" style="display:block">安装</div></div></div>'.replace(/{deficon}/g,t),s.dataset.id=n,s.onclick=()=>{d.querySelectorAll("li").forEach((e=>{e.classList.remove("active")})),s.classList.add("active")},util.query(s,".n>img").src=e.icon||t,util.query(s,".n .ds .name span").innerText=e.name;var a=util.query(s,".n .ds .message span",!0);a[0].innerText=e.author||"不详",a[1].innerText=e.version||"",a[2].innerText="",util.query(s,".d .desc").innerText=e.desc||"",util.query(s,".d .website").innerText=e.website||"",d.appendChild(s);var o=i.getAddonByMarketId(n);o&&(util.query(s,".btn.install").style.display="",o.version_code<e.version_code?util.query(s,".btn.update").style.display="block":util.query(s,".btn.installed").style.display="block"),util.query(s,".btn.install").addEventListener("click",(function(){this.style.display="",a[2].innerText="正在安装...(0%)";var t=i.installByOfficialMarket(n);t.on("progress",(function(e){a[2].innerText="正在安装...("+parseInt(100*e)+"%)"})),t.on("done",(function(){a[2].innerText="安装完成",util.query(s,".btn.installed").style.display="block",toast.show("插件 “"+e.name+"” 安装完成")})),t.on("error",(function(t){a[2].innerText="安装出错（"+t.msg+"）",util.query(s,".btn.install").style.display="block",toast.show("插件 “"+e.name+"” 安装出错（"+t.msg+"）")}))})),util.query(s,".btn.update").addEventListener("click",(function(){this.style.display="",a[2].innerText="正在更新...",i.update(o.id).then((()=>{a[2].innerText="更新完成",util.query(s,".btn.installed").style.display="block",toast.show("插件 “"+e.name+"” 更新完成")}))}))}util.query(s,'.l .item[data-p="1"]').addEventListener("click",(function(){u||(u=!0,g())})),i.on("uninstall",(function(e){if(e.marketId){var t=util.query(d,'li[data-id="'+e.marketId+'"]');t&&(util.query(t,".btn.install").style.display="block",util.query(t,".btn.installed").style.display="")}}));var p=util.query(s,".addon-search-box");function m(e){util.query(d,"li",!0).forEach((t=>{-1==util.query(t,".name span").innerText.indexOf(e)?t.style.display="none":t.style.display=""}))}util.query(p,"input").addEventListener("keydown",(function(e){"Enter"==e.key&&this.value.trim()&&m(this.value.trim())})),util.query(p,"input").addEventListener("input",(function(){this.value.trim()||util.query(d,"li",!0).forEach((e=>{e.style.display=""}))})),util.query(p,"button").addEventListener("click",(function(e){util.query(p,"input").value.trim()&&m(this.value.trim())}))}(),setTimeout((()=>{e.open()}),10)):alert("浏览器版本过低，无法使用插件功能！")},storage.checkIDB()){var e,t=window.isExt?"chrome-extension://"+window.extid+"/assets/def_addon.png":"./assets/def_addon.png",i=(()=>{var e,t=getEventHandle(),i=["浏览器不支持IndexedDB","安全模式下安装程序被禁止","确定是否安装此插件？"];function n(e,t){return new Promise(((i,n)=>{var s=new XMLHttpRequest;s.open("GET",e,!0),s.onreadystatechange=function(){4==s.readyState&&200==s.status&&i(s.responseText)},s.onerror=()=>{n(s.status)},s.onprogress=e=>{e.total?t&&t(e.loaded/e.total):t&&t(0)},s.send()}))}function s(e){if(0==(e=e.trim()).indexOf("/*QUIK_ADDON ")){var t=e.substring(13,e.indexOf(" */"));return"1"==(t=t.split("|"))[0]?{name:t[1],version_code:parseInt(t[2]),version:t[3],desc:t[4],author:t[5],icon:t[6],website:t[7],update:t[8],signature:t[9]}:{error:!0,msg:"un support meta version"}}return{error:!0,msg:"not QUIK addon"}}async function a(e,t,i){if("object"!=typeof t||t.error)return{msg:"插件格式错误:"+(t.msg||"META isn't an object"),error:!0};if(function(e){if(!e)return!1;for(var t=o.list(),i=0;i<t.length;i++)if(o.get(t[i]).signature==e)return!0}(t.signature))return{msg:"已安装相同插件",error:!0};var n=util.getRandomHashCache();for(var s in await new Promise((function(t){l.set(n,e,!0,t)})),t.id=n,i)void 0===t[s]&&(t[s]=i[s]);return o.set(n,t),await v(n),{id:n}}var o=storage("addon",{sync:!0,title:"插件",desc:"QUIK起始页插件数据",rewrite:(e,t,i)=>new Promise((function(n){if(0!=Object.keys(i).length){var s=new dialog({content:"<div>正在同步插件...[<span>0</span>/"+Object.keys(i).length+"]</div>",class:"dialog-addon-install",clickOtherToClose:!1});s.open();var a=s.getDialogDom(),l=0;for(var c in i){var d;i[c].url&&r(i[c].url)?u():(i[c].marketId?d=m(i[c].marketId):i[c].type?u():d=y(i[c].url),d.on("done",(()=>{u()})),d.on("error",(()=>{u(),alert("安装一个插件时失败")})),d.on("wait",(e=>e(!0))))}}else n();function u(){l++,util.query(a,"span").innerHTML=l,l==Object.keys(i).length&&(e[t]=o.getAll(),n())}}))}),l=storage("addonscript");function r(e){var t=o.getAll();for(var i in t)if(t[i].url==e)return t[i]}function c(e){return o.get(e)}var d=["初始化","获取插件信息","下载插件","等待确认","安装插件","安装成功"],u=["初始化失败","未找到插件信息","下载插件失败","插件解析错误","用户取消","安装失败"];function g(){this.statuCode=0,this.statuMsg=d[0],this.progress=0,this.errorCode=-1,this.errorMsg="",this.result=null,this.ev=getEventHandle(),this.on=this.ev.on,this.off=this.ev.off}function h(e){return function(i){i.error?e.setError(5,i.msg):(e.setStatu(5),e.setProgress(1),e.setDone(i),t.doevent("installnew",[i]))}}function m(t){var o=new g;function l(){if(e[t]){o.setProgress(.1),o.setStatu(2);var i=e[t].url;n(i,(e=>{o.setProgress(.1+.5*e)})).then((e=>{o.setProgress(.6),o.setStatu(3),a(e,s(e),{marketId:t}).then(h(o))})).catch((()=>{o.setError(2,i)}))}else o.setError(1,t)}return storage.checkIDB()||o.setError(0,i[0]),window.addon_&&o.setError(0,i[1]),e?l():f().then(l),o}function y(e){var t=new g;if(storage.checkIDB()||t.setError(0,i[0]),!window.addon_)return t.setProgress(.1),t.setStatu(2),n(e,(e=>{t.setProgress(.1+.5*e)})).catch((()=>{t.setError(2,e)})).then((n=>{t.setProgress(.6);var o=s(n);o.error?t.setError(3,o.msg):(t.setStatu(3),t.wait({meta:o,msg:i[2]},(i=>{i?a(n,o,{url:e}).then(h(t)):t.setError(4,"")})))})),t;t.setError(0,i[1])}async function v(e){var t,i=o.get(e),n=document.createElement("script");"dev"==i.type?await new Promise(((e,n)=>{util.requestByExt({url:i.url+"index.js",method:"get",responseType:"text",then(i){t=i.data,e()},catch(){alert("开发端口出错"),n()}})})):t=await new Promise((t=>l.get(e,!0,t))),n.innerHTML=`(()=>{\nfunction Session(id){this.id="ext_"+id;this.session_token="Hvm_session_token_eoi1j2j";this.isSession=true}\nvar addonData={session:new Session('${e}'),uninstall(fn){quik.addon._doonun(this.session,fn)}};\n(function(){${t}})();})()`,document.body.appendChild(n)}async function f(){return e||(e=await(await fetch("/addon_market/list.json")).json())}function b(){return o.list()}if(g.prototype={setProgress(e){this.progress=e,this.ev.doevent("progress",[e])},setStatu(e){this.statuCode=e,this.statuMsg=d[e],this.ev.doevent("statu",[{code:e,msg:d[e]}])},setError(e,t){this.errorCode=e,this.errorMsg=u[e]+" "+t,this.ev.doevent("error",[{code:e,msg:u[e]+" "+t}])},setDone(e){this.result=e,this.ev.doevent("done",[e])},wait(e,t){this.waiting=!0;var i=this;this.ev.doevent("wait",[function(n){i.waiting=!1,t(n),i._waitfn=t,i._waitd=e},e]),this._waitfn=t,this._waitd=e}},!window.addon_){var k=[];b().forEach((e=>{o.get(e).disabled||k.push(v(e))}));try{Promise.all(k).then((()=>{setTimeout((()=>{t.doevent("allrun",[])}),100)}))}catch(e){}}var w={};return{enable:function(e){var t=o.get(e);t.disabled=!1,o.set(e,t)},disable:function(e){var t=o.get(e);t.disabled=!0,o.set(e,t)},loadMarketData:f,installByOfficialMarket:m,installByUrl:y,installByLocal:function(e,t){if(t=new g,storage.checkIDB()||t.setError(0,i[0]),!window.addon_){t.setProgress(.1),t.setStatu(1);var n=s(e);return n.error?t.setError(3,n.msg):(t.setProgress(.5),t.setStatu(3),t.wait({meta:n,msg:i[2]},(i=>{i?a(e,n,{local:!0}).then(h(t)):t.setError(4,"")}))),t}t.setError(0,i[1])},installByDev:function(e){if(window.isExt){if(!window.addon_){var n=util.getRandomHashCache();return o.set(n,{name:"DEVPORT:"+e,url:e,type:"dev"}),t.doevent("installnew",{id:n}),v(n),n}p.setError(0,i[1])}else alert("请在浏览器扩展中安装开发端口")},uninstall:async function(e){var i=o.get(e);return!!i&&(o.remove(e),"dev"!=i.type&&await new Promise((t=>{l.remove(e,!0,t)})),t.doevent("uninstall",{id:e,marketId:i.marketId}),w[e]&&w[e](),!0)},runAddon:v,checkUpdate:async function(e){var t=o.get(e);if(!t)throw"not found addon";if(t.type)return!1;var i=t.update;if(!i)return!1;var n,s,a=await fetch((n=t.marketId?(await f())[t.marketId].url:t.url,s=i,n.substring(0,n.lastIndexOf("/"))+"/"+s));return a=await a.text(),(a=parseInt(a))>t.version_code},update:async function(e){var i=o.get(e);if(!i)return{error:!0,msg:"未找到插件"};if(i.url||i.marketId){i.marketId&&(i.url=(await f())[i.marketId].url);try{var a=await n(i.url)}catch(e){return{error:!0,msg:"代码请求失败",code:e}}var r=s(a);if(r.error)return{error:!0,msg:"META 解析失败:"+r.msg};if(r.signature!=i.signature)return{error:!0,msg:"签名校验失败"};if(r.version_code>=i.version_code){for(var c in r)i[c]=r[c];return await new Promise((t=>{l.set(e,a,!0,t)})),o.set(e,i),t.doevent("update",{id:e}),{ok:1,id:e,version_code:r.version_code}}return{error:!0,msg:"版本校验失败"}}return{error:!0,msg:"无法升级此插件"}},checkMarket:async function(t){for(var i in e||await f(),e)if(e[i].url==t){var n=JSON.parse(JSON.stringify(e[i]));return n.id=i,n}return!1},getAddonByUrl:r,getAddonBySessionId:c,getAddonById:c,getAddonByMarketId:function(e){var t=o.getAll();for(var i in t)if(t[i].marketId==e)return t[i]},getAddonList:b,getEnable:function(e){return!o.get(e).disabled},_doonun(e,t){util.checkSession(e)&&"function"==typeof t&&(w[e.id]=t)},on:t.on,off:t.off}})(),n=(()=>{function e(){var e=new dialog({content:'<div class="ma"><div class="sth"><img src="{deficon}" alt="图标"><p class="name">...</p><p class="version">版本：...</p></div><div class="progress"><div class="r"></div></div><div class="msg"></div><div class="btns"><div class="btn l">取消</div><div class="btn r">确定</div></div></div>'.replace("{deficon}",t),class:"addon_install_ui",clickOtherToClose:!1});this._d=e;var i=this._d.getDialogDom();util.query(i,".btns").style.display="none"}return e.prototype={bind(e){var t=this,i=this._d.getDialogDom();if(util.query(i,".msg").innerText=e.statuMsg+"...",util.query(i,".progress .r").style.width=100*e.progress+"%",-1!=e.errorCode&&(util.query(i,".msg").innerText=e.errorMsg,util.query(i,".progress").className="progress error",util.query(i,".btns").style.display="block",util.query(i,".btn.l").onclick=util.query(i,".btn.r").onclick=()=>{t.hide(),setTimeout((()=>{t.destroy()}),200)}),e.waiting){var n=e._waitfn,s=e._waitd;s.meta&&(util.query(i,".sth img").src=s.meta.icon,util.query(i,".sth .name").innerText=s.meta.name,util.query(i,".sth .version").innerText="版本："+s.meta.version),util.query(i,".msg").innerText=s.msg,util.query(i,".btns").style.display="block",util.query(i,".btn.l").onclick=()=>{n(!1)},util.query(i,".btn.r").onclick=()=>{n(!0)}}e.on("status",(function(e){util.query(i,".msg").innerText=e.msg})),e.on("progress",(function(e){util.query(i,".progress .r").style.width=100*e+"%"})),e.on("error",(function(e){util.query(i,".msg").innerText=e.msg,util.query(i,".progress").className="progress error",util.query(i,".btns").style.display="block",util.query(i,".btn.l").onclick=util.query(i,".btn.r").onclick=()=>{t.hide(),setTimeout((()=>{t.destroy()}),200)}})),e.on("wait",(function(e,t){t.meta&&(util.query(i,".sth img").src=t.meta.icon,util.query(i,".sth .name").innerText=t.meta.name,util.query(i,".sth .version").innerText="版本："+t.meta.version),util.query(i,".msg").innerText=t.msg,util.query(i,".btns").style.display="block",util.query(i,".btn.l").onclick=()=>{e(!1)},util.query(i,".btn.r").onclick=()=>{e(!0)}})),e.on("done",(function(){t.hide(),setTimeout((()=>{t.destroy()}),200)}))},ask(e,t,i={}){var n=this._d.getDialogDom();util.query(n,".sth img").src=i.img||"assets/def_addon.png",util.query(n,".sth .name").innerText=i.name||"-",util.query(n,".sth .version").innerText="版本："+i.version||"-",util.query(n,".msg").innerText=e,util.query(n,".btns").style.display="block",util.query(n,".btn.l").onclick=()=>{t(!1),util.query(n,".btns").style.display="none"},util.query(n,".btn.r").onclick=()=>{t(!0),util.query(n,".btns").style.display="none"}},show(){this._d.open()},hide(){this._d.close()},destroy(){this._d.destroy()}},e})();return window.addon_&&alert("已在安全模式下运行，插件功能已关闭！"),i.upinstallByOfficialMarket=e=>new Promise(((t,s)=>{if(i.getAddonByMarketId(e))s({code:-3,msg:"插件已安装"});else{var a=new n;a.show(),i.loadMarketData().then((n=>{n[e]?a.ask("要安装插件 “"+n[e].name+"” 吗？（该插件来自官方商店）",(n=>{if(n){var o=i.installByOfficialMarket(e);a.bind(o),o.on("done",(e=>{alert("安装成功"),t({code:0,result:e})})),o.on("error",(e=>{s({code:-2,msg:"安装错误",err:e})}))}else s({code:-1,msg:"用户取消"})}),{img:n[e].icon,name:n[e].name,version:n[e].version}):s({code:-2,msg:"插件ID不存在"})}))}})),i.upinstallByUrl=e=>new Promise(((t,s)=>{if(i.getAddonByUrl(e))s({code:-3,msg:"插件已安装"});else{var a=new n;a.show(),a.ask("要安装来自 "+e+" 的插件吗？",(n=>{if(n){var o=i.installByUrl(e);a.bind(o),o.on("done",(e=>{alert("安装成功"),t({code:0,result:e})})),o.on("error",(e=>{s({code:-2,msg:"安装错误",err:e})}))}else s({code:-1,msg:"用户取消"}),a.hide(),setTimeout((()=>{a.destroy()}),200)}))}})),i.upuninstall=function(e){return new Promise(((t,n)=>{i.getAddonBySessionId(e)?confirm("要卸载 "+i.getAddonBySessionId(e).name+" 吗？",(s=>{s?i.uninstall(e).then((e=>{e.error?(alert("卸载出现错误："+e.msg),n({code:-3,msg:"卸载出现错误",err:e})):(alert("卸载成功，刷新生效"),t({code:0,result:e}))})):n({code:-2,msg:"用户取消"})})):n({code:-1,msg:"没有该插件"})}))},i.upupdate=e=>new Promise(((t,n)=>{i.getAddonBySessionId(e)?confirm("要更新 "+i.getAddonBySessionId(e).name+" 吗？",(s=>{s?i.update(e).then((i=>{i.error?(alert("更新出现错误："+i.msg),n({code:-3,msg:"更新出现错误",err:i})):(alert("更新成功，刷新生效"),t({code:0,result:i}),xraddon(e))})):n({code:-2,msg:"用户取消"})})):n({code:-1,msg:"没有该插件"})})),i}})(),sync=(()=>{var{getJSON:e,setJSON:t}=(()=>{async function e(e){var t={};for(var i in e)if("string"==typeof e[i]&&"^"==e[i][0]){var n={"^_t":"db","^_k":e[i],"^_d":await localforage.getItem(e[i])};try{JSON.stringify(n),t[i]=n}catch(e){}}else t[i]=e[i];return t}async function t(e,t,i){for(var n in i)if("db"==i[n]["^_t"]&&i[n]["^_k"]){if(!quik.storage.checkIDB())throw new Error("Your browser is not support indexedDB,Please update your browser.");await localforage.setItem(i[n]["^_k"],i[n]["^_d"]),e[t][n]=i[n]["^_k"]}else e[t][n]=i[n]}return{getJSON:async function(t){for(var i=getStorageList(),n=getAllStorage(),s={},a=0;a<t.length;a++){var o=t[a];if(i[o]){s[o]={title:i[o].title||o,desc:i[o].desc||"",addon:i[o].addon,data:null};try{i[o]&&i[o].sync&&(i[o].get?s[o].data=await i[o].get():s[o].data=await e(n[o]))}catch(e){throw new Error("在获取 "+o+" 时遇到错误",e)}}}return s},setJSON:async function(e,i){v();var n=getStorageList(),s=getAllStorage(),a={};for(var o in e)if(i[o])if(n[o]){if(a[o]=s[o],"rewrite"==i[o])"function"==typeof n[o].rewrite?await n[o].rewrite(a,o,e[o].data):await t(a,o,e[o].data);else if("compare"==i[o]){if("function"!=typeof n[o].compare)throw new Error(o+" 不支持compare");await n[o].compare(a,o,e[o].data)}}else e[o].addon;var l=JSON.parse(localStorage.quik2);for(var o in a)l[o]=a[o];localStorage.quik2=JSON.stringify(l),alert("数据导入成功，请重新加载页面",(()=>{-1!=location.hash.indexOf(";")?location.hash=location.hash.split(";")[0]+";newnow":location.hash="#newnow",location.reload()}))}}})(),i=new SettingGroup({title:"数据",index:4}),n=new SettingItem({title:"导出数据",message:"导出数据到文件",type:"null",callback:s});function s(){c||(c=new dialog({content:`<div class="actionbar">\n        <h1>导出数据</h1>\n        <div class="closeBtn">${util.getGoogleIcon("e5cd")}</div>\n      </div>\n      <div class="exportslist">\n      </div>\n      <div class="btns">\n        <div class="btn cancel">取消</div>\n        <div class="btn ok">导出</div>\n      </div>`,class:"sync-dialog",mobileShowtype:dialog.SHOW_TYPE_FULLSCREEN}),u=c.getDialogDom(),util.query(u,".closeBtn").onclick=util.query(u,".cancel").onclick=()=>{c.close()},util.query(u,".ok").onclick=()=>{var t=[];util.query(u,".exportslist .item",!0).forEach((e=>{util.query(e,"input").checked&&t.push(e.dataset.key)})),e(t).then((e=>{var t,i,n;t=JSON.stringify(e),i="quik-2-exportdata.json",(n=document.createElement("a")).href=URL.createObjectURL(new Blob([t],{type:"application/json"})),n.download=i,n.click()})),c.close()});var t=getStorageList();for(var i in t)if(t[i]&&t[i].sync){var n=t[i],s=document.createElement("div");s.classList.add("item"),s.innerHTML=`<input type="checkbox"/><div class="message">\n        <div class="title">${n.title||i}</div>\n        <div class="desc">${n.desc||""}</div>\n      </div>`,s.dataset.key=i,util.query(u,".exportslist").appendChild(s),util.query(s,"input").checked=!0}setTimeout((()=>{c.open()}),10)}var a=new SettingItem({title:"导入数据",message:"从文件导入数据",type:"null",callback:o});function o(){showOpenFilePicker().then((e=>{var t=e[0];if(t)try{var i=new FileReader;i.onload=e=>{l(h=JSON.parse(e.target.result))},i.readAsText(t)}catch(e){alert("读取文件有误！")}}))}function l(e){h=e;var i=getStorageList();for(var n in d||(d=new dialog({content:`<div class="actionbar">\n        <h1>导入数据</h1>\n        <div class="closeBtn">${util.getGoogleIcon("e5cd")}</div>\n      </div>\n      <div class="importslist">\n      </div>\n      <div class="btns">\n        <div class="btn cancel">取消</div>\n        <div class="btn ok">导入</div>\n      </div>`,class:"sync-dialog",mobileShowtype:dialog.SHOW_TYPE_FULLSCREEN}),g=d.getDialogDom(),util.query(g,".closeBtn").onclick=util.query(g,".cancel").onclick=()=>{h=null,d.close()},util.query(g,".ok").onclick=()=>{var e={};util.query(g,".importslist .item",!0).forEach((t=>{util.query(t,"input").checked&&(util.query(t,"select")?e[t.dataset.key]=util.query(t,"select").value:e[t.dataset.key]="rewrite")})),t(h,e),d.close()}),e)r(e[n],n,i);setTimeout((()=>{d.open()}),10)}function r(e,t,i){var n=document.createElement("div");if(!i[t]&&e.addon&&!addon.getAddonByUrl(e.addon)){n.classList.add("item");var s=!1;return 0==e.addon.indexOf("market:")&&(s=!0),function(i){n.innerHTML=`<input type="checkbox" disabled/><div class="message">\n            <div class="title">${e.title||t}</div>\n            <div class="desc">需要安装插件以同步：${i}</div>\n          </div>\n          <div class="installbtn">安装</div>`;var a=n.querySelector(".installbtn");a.addEventListener("click",(function(){var i;this.classList.contains("ing")||(this.classList.contains("err")&&this.classList.remove("err"),this.innerHTML="安装中...",this.classList.add("ing"),(i=s?addon.installByOfficialMarket(e.addon.replace("market:","")):addon.installByUrl(e.addon)).on("error",(()=>{a.innerHTML="安装失败",a.classList.add("err")})),i.on("wait",(e=>{e(!0)})),i.on("done",(()=>{n.remove(),setTimeout((()=>{r(e,t,getStorageList())}),10)})))}))}(e.addon),n.dataset.key=t,void util.query(g,".importslist").appendChild(n)}i[t]&&(n.classList.add("item"),n.innerHTML=`<input type="checkbox"/><div class="message">\n      <div class="title">${e.title||t}</div>\n      <div class="desc">${e.desc||""}</div>\n    </div>`,i[t].compare&&(n.innerHTML+='<select>\n        <option value="compare">对比</option>\n        <option value="rewrite">覆盖</option>\n      </select>',util.query(n,"select").value="compare"),n.dataset.key=t,util.query(g,".importslist").appendChild(n),util.query(n,"input").checked=!0)}i.addNewItem(n),i.addNewItem(a),mainSetting.addNewGroup(i);var c,d,u,g,h=null;var{registerWebSync:p,unregister:m,isSync:y,abortSync:v}=(()=>{var t=storage("websync");t.get("wait")||t.set("wait",[]);var i,n,s=t.get("yesid");async function a(e){if(i=e,await i.isLogin()||await i.login(),function(){var e=location.hash.slice(1);-1!=e.indexOf(";")&&(e=e.split(";")[1]);if("newnow"==e)return location.hash=location.hash.replace("newnow",""),!0}())await r(),d();else{var s=await new Promise(((e,s)=>{i.getLastReq().then((a=>{if(a!=t.get("last_req")){var o=n.getDialogDom();if("no"==a)r();else{var c=new Date(a).toLocaleString()+"的更改";util.query(o,".last_req").innerText=c,util.query(o,".btn.ok").onclick=()=>{!async function(){var e=new dialog({content:"获取中。。。"});e.open();var t=await i.getAll();e.close(),l(t)}()},util.query(o,".btn.cancel").onclick=()=>{r().then(e).catch(s),n.close()},n||(n=new dialog({content:'<div>\n                <p>您的在线存档与本地存档存在冲突:</p>\n                <p class="last_req"></p>\n                <p>你要：</p>\n            </div>\n            <div class="btns">\n                <div class="btn ok">从在线同步</div>\n                <div class="btn cancel">本地覆盖在线</div>\n            </div>'})),setTimeout((()=>{n.open()}),10)}}else e("n")})).catch(s)}));s&&d()}}s&&c();var o=new iconc.icon({content:util.getGoogleIcon("eb5a"),offset:"br",important:!0});async function r(){o.show();var n=getStorageList(),s=await e(Object.keys(n).filter((e=>!!n[e]&&n[e].sync))),a=Date.now();await i.updateAll(s,a),t.set("last_req",a),t.set("wait",[]),o.hide()}function c(){storage.on("websync",(e=>{var n=Date.now();e.id=n,function(e){var n=t.get("wait");if(e.sp)n.push(e);else{for(var s=0;s<n.length;s++)if(n[s].key==e.key){n.splice(s,1);break}n.push({key:e.key,id:e.id})}t.set("wait",n),1==n.length&&i&&d()}(e)}))}function d(){if(o.show(),i){var e=t.get("wait"),n=e[0];n&&i.update(n,(i=>{i?(t.set("last_req",i),function(e){t.set("last_req",e);for(var i=t.get("wait"),n=0;n<i.length;n++)if(i[n].id==e){i.splice(n,1);break}t.set("wait",i),0==i.length&&o.hide()}(i),e=null,n=null,d()):new notice({title:"云同步",content:"数据（"+new Date(i).toLocaleString()+"的更改）同步失败了，是否重试？",btns:[{text:"确定",click(){d()}},{text:"取消",click(){}}]}).show()}))}}return o.hide(),addon.on("allrun",(()=>{setTimeout((()=>{s&&!i&&confirm("正在使用的云同步插件已被卸载或禁用，是否取消当前的云同步服务？",(e=>{e&&(t.remove("yesid"),t.remove("last_req"),location.reload())}))}),1e3)})),{registerWebSync:function(e,i,n){util.checkDetailsCorrect(e,["isLogin","login","getLastReq","getAll","update","updateAll"])?util.checkSession(i)?s!=i.id?confirm('插件 "'+addon.getAddonById(i.id)+'" 申请提供数据云同步功能，是否同意？',(o=>{o?(s=i.id,t.set("yesid",s),t.remove("last_req"),n({code:0,msg:"OK"}),c(),a(e)):n({code:-1,msg:"用户取消"})})):(n({code:0,msg:"OK"}),a(e).catch((e=>{new notice({title:"云同步",content:"云同步初始化失败，请检查网络连接后刷新"}).show()}))):n({code:-3,msg:"session不正确"}):n({code:-2,msg:"格式不正确"})},unregister:function(e){util.checkSession(e)?s==e.id&&(t.remove("yesid"),t.remove("last_req"),location.reload()):cb({code:-3,msg:"session不正确"})},isSync:function(){return!!s},abortSync:function(){i=null}}})(),f=(()=>{var e=new SettingItem({title:"QUIK 1",message:"从 QUIK 1 中导入数据",type:"null",callback:t});function t(){var e=new dialog({content:"正在加载模块..."});e.open();var t=util.element("script",{src:"./quik1.js"});document.body.append(t),window.quik1to2=t=>{window.quik1to2=null,t(l),e.close()}}return i.addNewItem(e),t})();return{getJSON:e,setJSON:t,openImport:o,openExport:s,registerWebSync:p,unregister:m,isSync:y,openQUIK1:f}})(),hotkey=void document.addEventListener("keydown",(function(e){"s"==e.key&&e.altKey?(e.preventDefault(),mainSetting.open()):"x"==e.key&&e.altKey?(e.preventDefault(),custom.setLite(!custom.isLite())):"g"==e.key&&e.altKey&&(e.preventDefault(),link.setShowCate(!link.isShowCate()))})),ignores=(()=>{var e=new SettingGroup({title:"关于",index:5});mainSetting.addNewGroup(e);var t=new SettingItem({type:"null",title:"关于QUIK起始页",index:1,callback(){c.open()}}),i=new SettingItem({type:"null",title:"更新日志",index:2,callback(){u?l.open():(!function(){l=new dialog({content:`<div class="actionbar">\n        <h1>更新日志</h1>\n        <div class="closeBtn">${util.getGoogleIcon("e5cd")}</div>\n      </div>\n      <div class="version_list"><div></div></div>`,mobileShowtype:dialog.SHOW_TYPE_FULLSCREEN,class:"update_dia"}),r=l.getDialogDom(),util.query(r,".version_list div").innerHTML="正在加载更新日志...",util.query(r,".closeBtn").onclick=()=>{l.close()},u=!0;var e=util.element("script",{src:"./updates.js"});document.body.append(e),window.connectUpdates=function(e){util.query(r,".version_list div").innerHTML=(()=>{var t="";for(var i in e)t+=g(i,e[i]);return t})(),window.connectUpdates=null},e.onload=()=>{e.remove()}}(),setTimeout((()=>{l.open()}),10))}}),n=new SettingItem({type:"null",title:"用户协议和隐私政策",index:3,callback(){h?h.open():(h=new dialog({content:` <div class="close">${util.getGoogleIcon("e5cd")}</div><div class="lic-con">${y()}</div>`,mobileShowtype:dialog.SHOW_TYPE_FULLSCREEN,class:"lic-dialog"}),util.query(h.getDialogDom(),".close").onclick=()=>{h.close()},setTimeout((()=>{h.open()}),10))}}),s=new SettingItem({type:"null",title:"特别鸣谢",index:4,callback(){var e;p?p.open():(e='<h1>特别鸣谢</h1><h2>感谢以下项目对QUIK的支持</h2><ul><li><a href="https://github.com/localForage/localForage" target="_blank">localforage</a> - 为indexedDB的管理提供一个方便的类似于localStorage的API</li><li><a href="https://github.com/siquan001/rem/" target="_blank">REM</a> - 简单的模块化工具（我做的）</li></ul><h2>感谢以下服务对QUIK的支持</h2><ul><li><a href="https://loliapi.com/" target="_blank">loliapi</a> - 双端自适应随机二次元图片API提供</li><li><a href="https://api.gumengya.com/" target="_blank">故梦API</a> - 随机风景图片API,随机一言API提供</li><li><a href="https://bing.com/" target="_blank">必应</a> | <a href="https://bing.shangzhenyang.com/" target="_blank">bing.shangzhenyang.com</a> - 每日必应壁纸API提供</li><li><a href="https://jinrishici.com/" target="_blank">jinrishici.com</a> - 随机诗词API提供</li><li><a href="https://baidu.com/" target="_blank">百度</a> - 搜索联想API提供</li><li><a href="https://github.com/" target="_blank">Github</a> - 静态网站托管服务提供</li></ul><h2>感谢所有QUIK用户和支持QUIK的人</h2><p style="padding-left: 20px;">没有你们，就没有现在的QUIK起始页。</p>',p=new dialog({content:`<div class="close">${util.getGoogleIcon("e5cd")}</div><div class="thank-con">${e}</div>`,class:"thank-dialog",mobileShowtype:dialog.SHOW_TYPE_FULLSCREEN}),util.query(p.getDialogDom(),".close").onclick=()=>{p.close()},setTimeout((()=>{p.open()}),10))}}),a=(s=new SettingItem({type:"null",title:"提供反馈",index:5,callback(){window.open("./feedback.html")}}),new SettingItem({type:"null",title:"加入官方QQ群",message:"在官方QQ群可以查看最新消息，也是处理建议最快的地方，更有机会参与新功能测试",index:5,callback:o}));function o(){window.open("https://qm.qq.com/q/6nOculioy4"),confirm("如果没有跳转至QQ，点击确定复制群号：971915865",(e=>{e&&util.copyText("971915865")}))}e.addNewItem(t),e.addNewItem(i),e.addNewItem(n),e.addNewItem(s),e.addNewItem(a),mainmenu.pushMenu({icon:util.getGoogleIcon("e88e"),title:"关于QUIK",click(){c.open()}},1),mainmenu.pushMenu({icon:util.getGoogleIcon("e0bf"),title:"加入官方QQ群",click:o},1),window.isExt||mainmenu.pushMenu({icon:util.getGoogleIcon("e87b"),title:"浏览器扩展",click(){alert("浏览器扩展尚处于测试中，只支持chromium内核的浏览器（chrome,edge,360浏览器等），暂未上传至扩展商店，请下载crx后手动安装。",(function(){-1!=location.href.indexOf("quik.web42.io")?window.open("/intro/#h"):window.open("/#h")}))}},1);var l,r,c=new dialog({content:'<div class="about-dialog"><div class="close">{{close-btn}}</div><div class="ab-logo"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 456 128"><circle cx="64" cy="64" r="40" stroke="black" stroke-width="3" fill="transparent"/><line x1="74" y1="74" x2="104" y2="104" style="stroke:rgb(0,0,0);stroke-width:3;"/><path d="M148 24L148 68Q148 104 180 104Q212 104 212 68L212 24" style="fill:transparent;stroke:rgb(0,0,0);stroke-width:3;"></path><path d="M276 24L306 24M291 24L291 104M276 104L306 104" style="fill:transparent;stroke:rgb(0,0,0);stroke-width:3;"></path><path d="M384 24L384 104M424 26L384 68M424 102L384 68" style="fill:transparent;stroke:rgb(0,0,0);stroke-width:3;"></path></svg></div><div class="t ver">当前版本: <span></span></div><div class="t intro">介绍: QUIK起始页是由前端爱好者<a href="https://siquan001.github.io/?ref=quik" target="_blank">陈思全</a>编写的一个简洁、实用的浏览器主页</div><div class="t license">版权声明: 本项目以GPL 3.0协议声明，版权归原作者所有。</div><div class="t thanks">感谢这些项目或可爱的人为QUIK起始页提供的支持: <a href="javascript:;">点击查看</a></div><div class="t feedback">反馈: chensiquan2023@qq.com</div></div>'.replace("{{close-btn}}",util.getGoogleIcon("e5cd")),mobileShowtype:dialog.SHOW_TYPE_FULLSCREEN}),d=c.getDialogDom();util.query(d,".close").onclick=()=>{c.close()},util.query(d,".t.thanks a").onclick=()=>{p.open()},setTimeout((()=>{util.query(d,".ver span").innerText=window.version.version}));var u=!1;function g(e,t){for(var i="",n={new:"新增",del:"删除",fix:"修复",change:"修改",thanks:"感谢"},s=t.updates,a=0;a<s.length;a++)i+='<div class="update_item"><div class="update_item_tag '+s[a].tag+'"><div>'+n[s[a].tag]+'</div></div><div class="update_item_content">'+s[a].content+"</div></div>";return'<div class="version_item"><div class="version_item_title">'+e+'</div><div class="version_item_update_time">发布时间：'+t.time+'</div><div class="version_update">'+i+"</div></div>"}var h,p,m='<h1>QUIK起始页用户协议与隐私政策</h1><p><b>请务必认真阅读！</b></p><h2>一、QUIK起始页简介</h2><p>QUIK起始页（以下简称本产品）是一个由个人开发者（<a href="https://siquan001.github.io/" target="_blank">陈思全</a>）编写的一个开源免费的纯前端项目，以GPL 3.0 license声明，版权归原作者所有</p><h2>二、用户使用须知</h2><p>1.使用本产品即代表您同意本条款的所有内容。</p><p>2.<b>下面的插件使用须知更重要</b></p><p>3.本产品中的大部分图标使用Google开源的Material Outlined图标。</p><p>4.本产品中一言的“随机一言”功能由hitokoto.cn提供，如若出现有关一言的“随机一言”的内容相关问题，请联系hitokoto.cn，本产品不负责任</p><p>5.本产品中一言的“今日诗词”功能由jinrishici.com提供，如若出现有关一言的“今日诗词”的内容相关问题，请联系jinrishici.com，本产品不负责任</p><p>6.本产品中的搜索联想功能由百度提供，如若出现有关搜索联想的内容相关问题，请联系百度，本产品不负责任</p><p>7.本产品中背景的“必应壁纸”功能由bing.shangzhenyang.com和必应提供，如若出现有关背景的“必应壁纸”的图片内容相关问题，请联系bing.shangzhenyang.com和必应，本产品不负责任</p><p>8.本产品中背景的“随机二次元壁纸”功能由loliapi.com提供，如若出现有关背景的“随机二次元壁纸”的图片内容相关问题，请联系loliapi.com，本产品不负责任</p><p>9.本产品中背景的“随机风景壁纸”功能由ltyuanfang.cn提供，如若出现有关背景的“随机风景壁纸”的图片内容相关问题，请联系ltyuanfang.cn，本产品不负责任</p><p>10.本产品中搜索框的“自动翻译”功能由api.gumengya.com和api.oioweb.cn提供，如若出现有关搜索框的“自动翻译”的内容相关问题，请联系api.gumengya.com，本产品不负责任</p><p>11.本产品的随机背景API均支持下载壁纸，但这些壁纸仅能用做壁纸，禁止商业化使用</p><h2>三、插件使用须知</h2><p>1.本产品提供插件拓展功能，使用本产品的插件拓展功能即代表您知晓并同意本条款的所有内容。</p><p>2.安装官方提供的插件需要您同意插件的用户协议与隐私政策，若与本协议存在出入，以本协议为准</p><p>3.安装来自第三方的不明插件是十分不安全的行为，同时请保证您的设备未被病毒程序感染，<b>否则本产品不能保证您的数据安全和使用安全！</b></p><h2>四、隐私政策</h2><p>1.本产品本身属于纯前端项目，不会收集您的任何信息，您的所有数据都会存在本地</p><p>2.如您安装了插件，插件可能会收集您的一些信息，详见插件的用户协议与隐私政策。</p><p>3.本产品中使用的一些API和站点服务提供者可能会收集您的IP地址、Cookie等信息用于数据分析和安全防护等</p>';function y(){return m}return{lic:m}})();(()=>{if(window.version_code=121,window.version={version:"2.5.3",version_code:window.version_code,updateTime:"2024/9/14",log:[{tag:"fix",content:"紧急修复背景蒙版设置为跟随主题时起始页崩溃的恶性BUG"},{tag:"new",content:"新增链接右键移动至其他分组的功能"}]},"serviceWorker"in navigator&&!window._dev){function e(){quik.util.xhr("./version",(e=>{var t=parseInt(e);t>version_code&&(quik.toast.show("发现新版本(版本序号："+t+")，正在更新"),registration.active.postMessage("update"))}),(()=>{}))}navigator.serviceWorker.ready.then((t=>{if(window.swReg=t,-1!=window.location.href.indexOf("://quik.42web.io/")){var i=util.element("iframe",{src:"./version"});document.body.appendChild(i);var n=0;i.onload=function(){++n>=2&&e()},setTimeout((()=>{e()}),4e3)}else e()})),navigator.serviceWorker.addEventListener("message",(e=>{"updated"==e.data&&quik.confirm("新版本已准备就绪，是否刷新页面",(e=>{e&&(localStorage.setItem("__q__s__","1"),location.reload())}))}))}var t=null;function i(e){for(var t="",i={new:"新增",del:"删除",fix:"修复",change:"修改",thanks:"感谢"},n=0;n<e.length;n++)t+='<div class="update_item"><div class="update_item_tag '+e[n].tag+'"><div>'+i[e[n].tag]+'</div></div><div class="update_item_content">'+e[n].content+"</div></div>";return t}localStorage.getItem("__q__s__")&&(t||(t=new dialog({content:`<h1>版本更新</h1><div class="version_item">\n<div class="version_item_title">版本号：${window.version.version}</div>\n<div class="version_item_update_time">发布时间：${window.version.updateTime}</div>\n<div class="version_update">${i(window.version.log)}</div>\n</div><div class="footer"><div class="btn ok">我知道了</div></div>`,class:"update_dialog"}),util.query(t.getDialogDom(),".btn.ok").onclick=()=>{t.close()}),setTimeout((()=>{t.open()})),localStorage.removeItem("__q__s__"))})(),(()=>{var e=storage("oobe");if(e.get("agree"))r();else{var t=ignores.lic,i=0,n='<div class="part a1">{{part1}}</div><div class="part a2">{{part2}}</div>',s=['<div class="lic-c">{{lic}}</div><div class="btns"><div class="btn cancel">不同意</div><div class="btn ok">同意</div></div>','<div class="imglogo"><svg xmlns="http://www.w3.org/2000/svg" style="stroke: #000;" version="1.1" viewBox="0 0 456 128"><circle cx="64" cy="64" r="40" stroke-width="3" fill="transparent"/><line x1="74" y1="74" x2="104" y2="104" style="stroke-width:3;"/><path d="M148 24L148 68Q148 104 180 104Q212 104 212 68L212 24" style="fill:transparent;stroke-width:3;"></path><path d="M276 24L306 24M291 24L291 104M276 104L306 104" style="fill:transparent;stroke-width:3;"></path><path d="M384 24L384 104M424 26L384 68M424 102L384 68" style="fill:transparent;stroke-width:3;"></path></svg></div><div class="biaoyu">2.0版本，焕新归来！</div><div class="clist"><div class="item a">开始使用</div><div class="item b">导入数据</div><div class="item c">从QUIK1.x还原</div></div>'];s.forEach(((e,t)=>{n=n.replace("{{part"+(t+1)+"}}",e)})),n=n.replace("{{lic}}",t);var a=new dialog({content:n,class:"oobedia",mobileShowtype:dialog.SHOW_TYPE_FULLSCREEN,clickOtherToClose:!1}),o=a.getDialogDom();function l(){if(i>0&&(util.query(o,".part.a"+i).classList.remove("show"),util.query(o,".part.a"+i).classList.add("n")),i==s.length)return a.close(),void r();i++,setTimeout((()=>{util.query(o,".part.a"+i).classList.add("show")}),200)}util.query(o,".part.a1 .btn.ok").onclick=()=>{e.set("agree",!0),l()},util.query(o,".part.a1 .btn.cancel").onclick=()=>{location.href="about:blank"},util.query(o,".part.a2 .item.a").onclick=()=>{l()},util.query(o,".part.a2 .item.b").onclick=()=>{l(),sync.openImport()},util.query(o,".part.a2 .item.c").onclick=()=>{l(),sync.openQUIK1()},l(),a.open()}function r(){e.get("guided")||guidecreator.create([{text:"点击左下角的"+util.getGoogleIcon("e8b8",{type:"fill"})+"就可以打开设置，你可以在设置里个性化你的QUIK起始页",offset:{bottom:40,left:0}},{text:"QUIK起始页提供插件来拓展QUIK起始页的功能，点击"+util.getGoogleIcon("e87b",{type:"fill"})+"看看插件市场里是否有中意的吧",offset:{top:40,right:40}}],(()=>{e.set("guided",!0)}))}})(),omnibox.on("beforeenter",(e=>{"rainbowcatXquik"==e&&(localStorage.__quik_egg__="1")})),setTimeout((()=>{window.eggnow__&&(setTimeout((()=>{var t=util.element("audio",{src:"./assets/nyan.mp3",loop:!0,preload:!0});function n(){var t;setTimeout((()=>{var e=0,i=["Nyan Cat","Artist:桃音モモ","From:网易云音乐"];document.querySelector(".loading-f p").innerHTML=i[e],t=setInterval((()=>{e=e==i.length-1?0:e+1,document.querySelector(".loading-f p").innerHTML=i[e]}),2e3)}),0),setTimeout((()=>{clearInterval(t);var e=0,i=["nya nya nya nya nya nya nya nya nya nya nya nya nyan","nay nya nya~ nay nya nya_ nya nya nya nya nya nya nyan?","nya nya nya_ nya nya nya nay nya nya nya nay nya nyan","nya nya nya nya nay nya nya_ nya nya~ nya nya nya nyan*","nya nya nya nya nya nya~ nya nya nya nya nya nya nyan","nya nya~ nya nya nya_ nya nya nay nya nya nya nya nyan!","nya nya nya nya nya nya nya nya_ nya nya nya nya nyan","nya nya nya nay nya nya_ nya nya nya nya nya nya nyan:","nya nya~ nya nya nya nya nya nya_ nya nya nya nya nyan..","nya nya nya nya nya nya nay nya nya nya nya_ nya nyan"];document.querySelector(".loading-f p").innerHTML=i[e],t=setInterval((()=>{e=e==i.length-1?0:e+1,document.querySelector(".loading-f p").innerHTML=i[e]}),250)}),8e3),setTimeout((()=>{clearInterval(t);var e=0,i=["","nya","nya!","nay","n_ay","n_ya","nya?","nya~","nya","nyanya","nyan","nyan:","nyan..","ny"];document.querySelector(".loading-f p").innerHTML=i[e],t=setInterval((()=>{e=e==i.length-1?0:e+1,document.querySelector(".loading-f p").innerHTML="QUIK 2.4.1 - 彩蛋 - RainbowCat"+i[e]}),250)}),35e3),setTimeout((()=>{clearInterval(t),t=setInterval((()=>{document.querySelector(".loading-f p").innerHTML=function(){e=6*Math.random()+17;var t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678!@#$%^&*()_+~`-=[];'\\,./{}:\"|<>/?",n=t.length,s="";for(i=0;i<e;i++)s+=t.charAt(Math.floor(Math.random()*n));return s}()}),100)}),48e3)}document.body.append(t),document.querySelector(".loading-f").innerHTML='<p>正在加载音频中...</p><img src="https://image.gumengya.com/i/2024/08/22/66c694973aba5.gif"/>',t.oncanplaythrough=function(){try{t.play()}catch(e){}t.paused||n(),document.querySelector(".loading-f p").innerHTML="CLICK TO PLAY 点击播放音乐",document.addEventListener("click",(function e(){t.play(),n(),document.removeEventListener("click",e)}))},document.querySelector(".loading-f").classList.add("rainbow")}),4e3),util.addStyle(`.loading-f.rainbow{background:#036}.loading-f p{font-size:20px;line-height:36px;width:100%;color:#fff;position:absolute;top:0;left:0;text-align:center;}.loading-f img{${window.innerWidth>window.innerHeight?"height":"width"}:100%;display:block;margin:0 auto}`))}),10);var _upaddon={},pbls=["runAddon","enable","disable","upupdate","upinstallByUrl","upinstallByOfficialMarket","upuninstall","installByLocal"];for(var k in addon)-1==pbls.indexOf(k)&&(_upaddon[k]=addon[k]);_upaddon.update=addon.upupdate,_upaddon.installByUrl=addon.upinstallByUrl,_upaddon.installByOfficialMarket=addon.upinstallByOfficialMarket,_upaddon.uninstall=addon.upuninstall,window.quik={searchEditor:searchEditor,guidecreator:guidecreator,fcard:fcard,custom:custom,sync:sync,addon:_upaddon,storage:storage,omnibox:omnibox,util:util,link:link,dialog:dialog,toast:toast,says:says,menu:menu,iconc:iconc,background:background,mainmenu:mainmenu,Setting:Setting,SettingGroup:SettingGroup,SettingItem:SettingItem,mainSetting:mainSetting,notice:notice,tyGroup:tyGroup,alert:alert,confirm:confirm,prompt:prompt,card:card,getEventHandle:getEventHandle},window.util=util,localStorage.__quik_egg__?(delete localStorage.__quik_egg__,window.eggnow__=!0,clearTimeout(loadingtimeout),document.querySelector(".loading-f").style.display="block"):(custom.waitdotheme((()=>{showmain()})),setTimeout((()=>{showmain()}),500));var isshowmain=!1;function showmain(){isshowmain||(clearTimeout(loadingtimeout),document.querySelector(".loading-f").classList.add("h"),document.querySelector(".loading-f").style.display="none",document.querySelector("main").style.display="block",document.querySelector("main").style.opacity="1",onshows_fns.forEach((e=>e())),link.cateWidthShiPei(),isshowmain=!0,setTimeout((()=>{document.querySelector("main").classList.add("sicon")}),360))}var f="@font-face {\n    font-family: 'Material Symbols Outlined';\n    font-style: normal;\n    font-weight: 100 700;\n    src: url($0) format('woff2');\n  }";window.isExt?util.addStyle(f.replace("$0","chrome-extension://"+window.extid+"/assets/google-icon.woff2")):util.addStyle(f.replace("$0","https://gstatic.loli.net/s/materialsymbolsoutlined/v164/kJEhBvYX7BgnkSrUwT8OhrdQw4oELdPIeeII9v6oFsI.woff2"))})();